<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>关于 GoldenDict JavaScript 提权漏洞</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="GoldenDict Professional,WebKit,JavaScript,Privilge Escalation,GoldenDict脚本提权漏洞"><meta name=description content="关于GoldenDict的JS提权漏洞的一点思考,Thinking on JavaScript Privilge Escalation of  GoldenDict"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"🌜"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>关于 GoldenDict JavaScript 提权漏洞的思考</span><span class=btRight><span title="Translator · 翻译" class=author><a href=https://autoptr.top/license/ style=color:red title="All rights reserved · 译文或原创内容·版权所有" target=_blank rel=nofollow>&copy;</a><a href=https://autoptr.top/gdocr/GoldenDict-OCR-Changelog/ style=color:#007cd5 title="GoldenDict++ Changelogs" target=_blank>&#128681;</a><a href=/gdocr/ title="Back to Topics · 回主题页">&#127793;</a></span></h1><div align=center class=gdocr_topic_head style=color:#444;background-color:transparent;margin-bottom:.3em><style type=text/css>.gdocr_topic_head a{text-decoration:none;color:darkred;display:inline-block;border:1px solid #4e57ef;box-shadow:3px 4px #aaaab7;padding:1px;margin:2px 1px}</style><a href=/gdocr/GoldenDict-OCR-Free-Dictionaries/ style=color:#7f0099;font-weight:700 title=对辞书分享社区的态度 target=_blank>辞书分享</a>
<a href=/gdocr/wiki/GoldenDict-DoubleClick-ScanPopup-Windows/ target=_blank>双击取词</a>
<a href=/gdocr/GoldenDict-OCR-Portable-Mode/ style=color:#7f0099;font-weight:700 target=_blank>便携模式</a>
<a href=/gdocr/en/GoldenDict-OCR-Audio-Players/ target=_blank>音频引擎</a>
<a href=/gdocr/cn/GoldenDict-OCR-Adobe-Flash-Plugin/ style=color:#7f0099 target=_blank>播放动画</a>
<a href=/gdocr/en/GoldenDict-OCR-Group-by-Folders/ style=color:#7f0099;font-weight:700 target=_blank>自动分组</a>
<a href=/gdocr/en/GoldenDict-OCR-Reading-Mode/ target=_blank>阅读模式</a>
<a href=/gdocr/en/GoldenDict-OCR-QA-Help/ style=color:#7f0099;font-weight:700 target=_blank>问题帮助</a>
<a href=/gdocr/GoldenDict-OCR-Language-Settings/ target=_blank>划词设置</a>
<a href=/gdocr/GoldenDict-OCR-Deployment/ style=color:blue;font-weight:700 target=_blank>升级下载</a></div><p><span style=margin-left:2em></span>GoldenDict中使用了<code>WebKit</code>处理HTML数据（渲染及互动），基于Qt的WebKit封装为<code>QtWebKit</code>。在C++的接口封装中，QtWebKit中的事件处理同样是基于<strong>QObject的信号槽</strong> &mdash; 这也是整个Qt库的核心部分。<br><span style=margin-left:2em></span>通过<code>QtWebKit</code>中封装的C++接口，Qt应用可以方便的对Web内容进行操作。反过来，Qt应用可以通过QtWebKit的方法为Web框架注入<code>QObject</code>的类实例（Web Content中的<code>JS对象</code>），以<strong>扩展应用程序框架下用户对Web Content数据的处理</strong>能力。在用户的HTML内容中，<strong>通过</strong>调用已注册的<strong>JS对象</strong>的方法（函数）的数据处理实际上<strong>跳转到了应用的Qt槽函数执行</strong>。应用程序中所有基于QObject的对象实例，都可以注册为QtWebKit中Web框架实例的JS对象，用户在其JS脚本中都可以调用已注册对象的公有方法 &mdash; 这为基于QtWebKit的应用程序提供了强大的自由扩展和处理Web数据的能力，这也是QtWebKit封装的优势所在，让用户可以<strong>间接的通过C++方法处理Web Content数据</strong>。<style>.autoptr-aspect-ratio{position:relative;width:100%;height:0;padding-bottom:60%}#biliplayer{position:absolute;width:100%;height:100%;left:0;top:0}@media only screen and (min-device-width:320px) and (max-device-width:480px){.aspect-ratio #biliplayer{width:100%;height:100%}}</style><div align=center class=autoptr-aspect-ratio><iframe id=biliplayer src="//player.bilibili.com/player.html?bvid=BV1X8411v7X5&page=1&high_quality=1&danmaku=0" scrolling=no border=0 frameborder=no framespacing=0 allowfullscreen loading=lazy></iframe></div><span style=margin-left:2em></span>回到GoldenDict（包括GoldenDict++的早期版本和所有基于GD官方代码的改版），在用户的Web Content中为处理用户浏览词典数据时当前词典的改变，JS脚本中调用了<strong>articleView</strong>的<strong>activeArticleChanged</strong>方法。其中的<code>articleView</code>对象可简单的理解为当前正在浏览的Web视图(标签页的子对象)，在新建标签页时即向其Web框架对象中注入了articleView实例，以此处理当用户通过鼠标点击Web页面内容时，如果是从一个词典的视图区域切换到了另一个词典的视图区域，来通知应用程序更新<code>查询结果导航面板</code>中的当前词典（为选中状态）。<br><span style=margin-left:2em></span>在GoldenDict当前的设计中，通过articleView对象开放给用户的接口除了必需的activeArticleChanged外，还有一些辅助接口 &mdash; 这些接口用于处理用户对GoldenDict应用的操作或响应数据更新，还有一些派生自QObject对象类的直接或间接的接口，都通过注册articleView对象实例的方式暴漏给了用户（Web Content）&mdash; 只要在词典查询的返回数据中含有articleView对象接口的不合理调用，就可能对GoldenDict的运行带来非用户期望的行为。</p><blockquote><p><a href=https://autoptr.lanzouo.com/irE7Lxth3pc>典型的垃圾词典中的恶意脚本或内容对用户的侵扰一例</a>（请学友们从安全可靠的源获取学习资料）。</p></blockquote><p><span style=margin-left:2em></span>使用<code>网站</code>型词典检测是否存在该漏洞(适用于<code>GoldenDict</code>及其衍生版本)：</p><blockquote><ol><li>点击<code>编辑</code>菜单下的<code>词典</code>项，在打开的对话框中添加<code>网站</code>型词典</li><li>填写<code>名称</code>为<code>gdissue01</code>, <code>地址</code>为<code>https://www.autoptr.top/service/gdissue01.html</code></li><li>勾选<code>已启用</code>和<code>作为链接</code>；继续添加<code>网站</code>型词典</li><li>填写<code>名称</code>为<code>gdissue02</code>, <code>地址</code>为<code>https://www.autoptr.top/service/gdissue02.html</code></li><li>勾选<code>已启用</code>和<code>作为链接</code>；继续添加<code>网站</code>型词典</li><li>填写<code>名称</code>为<code>gdissue03</code>, <code>地址</code>为<code>https://www.autoptr.top/service/gdissue03.html</code></li><li>只勾选<code>已启用</code>；点击对话框下面的<code>确定</code>或<code>OK</code>按钮使修改生效</li><li>单独使用<code>gdissue01</code>词典查询任意词汇，如果弹出<code>警告</code>对话框则检测到该漏洞</li><li>新建<code>Tab</code>页并单独使用<code>gdissue02</code>词典查询，如弹出<code>警告</code>对话框则检测到该漏洞</li><li>针对<code>WebEngine</code>版本，单独使用<code>gdissue03</code>查询，如弹出<code>警告</code>对话框则检测到该漏洞</li></ol></blockquote><p><span style=margin-left:2em></span>一份<a href=/gdocr/GoldenDict-OCR-Changelog/#2021117-2a445%E4%BF%AE%E6%AD%A3font-colordarkbluedark%E4%B8%BB%E9%A2%98%E6%96%87%E7%AB%A0%E6%BB%91%E5%8A%A8%E6%9D%A1%E9%85%8D%E8%89%B2font%E4%B8%8E%E5%BA%94%E7%94%A8%E4%B8%BB%E9%A2%98%E9%85%8D%E8%89%B2%E4%B8%8D%E6%90%AD%E7%9A%84%E9%97%AE%E9%A2%98font-colordarkred%E9%9A%94%E7%A6%BB%E6%96%87%E7%AB%A0%E8%A7%86%E5%9B%BE%E7%9A%84js%E5%AF%B9%E8%B1%A1%E6%96%B9%E6%B3%95%E4%BB%A5%E9%98%B2%E9%81%BF%E7%94%A8%E6%88%B7%E8%AF%8D%E5%85%B8%E4%B8%AD%E7%9A%84fontfont-colorred%E6%81%B6%E6%84%8F%E8%84%9A%E6%9C%ACfont%E5%AF%B9%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%B8%A6%E6%9D%A5%E7%9A%84font-colordarkred%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98font>测试用例</a>(未有覆盖全部接口)如下：</p><pre tabindex=0><code>echo &#34;本脚本中的内容仅用于测试，请勿用于其它用途！&lt;br /&gt;&#34;
echo.
echo &#34;&lt;script&gt;setTimeout(function() { articleview.setDisabled(true); articleview.statusBarMessage(&#39;测试setDisabled&#39;); },2000);&lt;/script&gt;&#34;
echo &#34;&lt;script&gt;setTimeout(function() { articleview.setHidden(true); articleview.statusBarMessage(&#39;测试setHidden(true)&#39;); },4000);&lt;/script&gt;&#34;
echo &#34;&lt;script&gt;setTimeout(function() { articleview.setHidden(false); articleview.statusBarMessage(&#39;测试setHidden(false)&#39;); },6000);&lt;/script&gt;&#34;
echo &#34;&lt;script&gt;setTimeout(function() { articleview.zoomOut(); articleview.statusBarMessage(&#39;测试zoomOut&#39;); },8000);&lt;/script&gt;&#34;
echo &#34;&lt;script&gt;setTimeout(function() { articleview.zoomOut(); articleview.statusBarMessage(&#39;测试zoomOut&#39;); },9000);&lt;/script&gt;&#34;
echo &#34;&lt;script&gt;setTimeout(function() { articleview.zoomIn(); articleview.statusBarMessage(&#39;测试zoomIn&#39;); },10000);&lt;/script&gt;&#34;
echo &#34;&lt;script&gt;setTimeout(function() { articleview.zoomIn(); articleview.statusBarMessage(&#39;测试zoomIn&#39;); },11000);&lt;/script&gt;&#34;
echo &#34;&lt;script&gt;setTimeout(function() { articleview.showDictsPane(); articleview.statusBarMessage(&#39;测试showDictsPane&#39;); },12000);&lt;/script&gt;&#34;
echo &#34;&lt;script&gt;setTimeout(function() { articleview.sendWordToHistory(&#39;测试测试sendWordToHistory历史记录&#39;); articleview.statusBarMessage(&#39;测试sendWordToHistory&#39;); },14000);&lt;/script&gt;&#34;
echo &#34;&lt;script&gt;setTimeout(function() { articleview.statusBarMessage(&#39;测试完成了&#39;); },16000);&lt;/script&gt;&#34;
echo &#34;&lt;script&gt;setTimeout(function() { articleview.back(); articleview.statusBarMessage(&#39;测试back&#39;); },18000);&lt;/script&gt;&#34;
echo &#39;test PageView issues.&#39;
exit 0
</code></pre><blockquote><p>简单一些的JS脚本如下：</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>&lt;</span>script<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setTimeout</span>(function() { articleview.<span style=color:#a6e22e>setDisabled</span>(<span style=color:#66d9ef>true</span>); articleview.<span style=color:#a6e22e>statusBarMessage</span>(<span style=color:#960050;background-color:#1e0010>&#39;</span>测试setDisabled<span style=color:#960050;background-color:#1e0010>&#39;</span>); },2000);
</span></span><span style=display:flex><span>  setTimeout(function() { articleview.<span style=color:#a6e22e>setHidden</span>(<span style=color:#66d9ef>true</span>); articleview.<span style=color:#a6e22e>statusBarMessage</span>(<span style=color:#960050;background-color:#1e0010>&#39;</span>测试setHidden<span style=color:#960050;background-color:#1e0010>&#39;</span>); },3000);
</span></span><span style=display:flex><span>  setTimeout(function() { articleview.<span style=color:#a6e22e>setHidden</span>(<span style=color:#66d9ef>false</span>); },5000);
</span></span><span style=display:flex><span>  setTimeout(function() { articleview.<span style=color:#a6e22e>zoomOut</span>(); articleview.<span style=color:#a6e22e>statusBarMessage</span>(<span style=color:#960050;background-color:#1e0010>&#39;</span>测试zoomOut<span style=color:#960050;background-color:#1e0010>&#39;</span>); },6000);
</span></span><span style=display:flex><span>  setTimeout(function() { articleview.<span style=color:#a6e22e>zoomIn</span>(); articleview.<span style=color:#a6e22e>statusBarMessage</span>(<span style=color:#960050;background-color:#1e0010>&#39;</span>测试zoomIn<span style=color:#960050;background-color:#1e0010>&#39;</span>); },7000);
</span></span><span style=display:flex><span>  setTimeout(function() { articleview.<span style=color:#a6e22e>showDictsPane</span>(); articleview.<span style=color:#a6e22e>statusBarMessage</span>(<span style=color:#960050;background-color:#1e0010>&#39;</span>测试showDictsPane<span style=color:#960050;background-color:#1e0010>&#39;</span>); },8000);
</span></span><span style=display:flex><span>  setTimeout(function() { articleview.<span style=color:#a6e22e>sendWordToHistory</span>(<span style=color:#960050;background-color:#1e0010>&#39;</span>测试历史记录<span style=color:#960050;background-color:#1e0010>&#39;</span>); articleview.<span style=color:#a6e22e>statusBarMessage</span>(<span style=color:#960050;background-color:#1e0010>&#39;</span>测试sendWordToHistory<span style=color:#960050;background-color:#1e0010>&#39;</span>); },9000);
</span></span><span style=display:flex><span>  setTimeout(function() { articleview.<span style=color:#a6e22e>statusBarMessage</span>(<span style=color:#960050;background-color:#1e0010>&#39;</span>测试完成了<span style=color:#960050;background-color:#1e0010>&#39;</span>); },9000);
</span></span><span style=display:flex><span>  setTimeout(function() { articleview.<span style=color:#a6e22e>back</span>(); articleview.<span style=color:#a6e22e>statusBarMessage</span>(<span style=color:#960050;background-color:#1e0010>&#39;</span>测试back<span style=color:#960050;background-color:#1e0010>&#39;</span>); },10000);
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/</span>script<span style=color:#f92672>&gt;</span> 
</span></span></code></pre></div><p><span style=margin-left:2em></span>上述JS脚本内容可以插入到任何使用了HTML技术的词典内容中去，如<code>mdx</code>、<code>zim</code>等格式词典文件。</p><p><span style=margin-left:2em></span>通常情况下，只需要将用户需要的接口通过QtWebKit的注册方法开放给用户即可，故我们可以只将将必要的接口以单独的QObject派生类来封装，然后将该类实例化并注册给Web框架即可很好的解决上述问题（<a href=/gdocr/GoldenDict-OCR-Changelog/#2021117-2a445%E4%BF%AE%E6%AD%A3font-colordarkbluedark%E4%B8%BB%E9%A2%98%E6%96%87%E7%AB%A0%E6%BB%91%E5%8A%A8%E6%9D%A1%E9%85%8D%E8%89%B2font%E4%B8%8E%E5%BA%94%E7%94%A8%E4%B8%BB%E9%A2%98%E9%85%8D%E8%89%B2%E4%B8%8D%E6%90%AD%E7%9A%84%E9%97%AE%E9%A2%98font-colordarkred%E9%9A%94%E7%A6%BB%E6%96%87%E7%AB%A0%E8%A7%86%E5%9B%BE%E7%9A%84js%E5%AF%B9%E8%B1%A1%E6%96%B9%E6%B3%95%E4%BB%A5%E9%98%B2%E9%81%BF%E7%94%A8%E6%88%B7%E8%AF%8D%E5%85%B8%E4%B8%AD%E7%9A%84fontfont-colorred%E6%81%B6%E6%84%8F%E8%84%9A%E6%9C%ACfont%E5%AF%B9%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%B8%A6%E6%9D%A5%E7%9A%84font-colordarkred%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98font>更新日志</a>）。</p><p><span style=margin-left:2em></span>上面讲的有些晦涩，也有点儿拗口，但并不影响这个问题的严重性，概括一下就是：</p><blockquote><p>维护：来一把剪刀，天线架上缠绕的的附着物多了，得剪一剪&mldr;<br>仓管：好吧，去仓库找工具箱<br>维护：嗯~ o(<em>￣▽￣</em>)o&mldr;🔧⚓&mldr;✂&mldr;找着了&mldr;<br>仓管：工具挺多的吧，都拎去，用完了再还回来<br>维护：好~ o(<em>￣▽￣</em>)o&mldr;✂🌼✂🐤✂🐛✂🐙✂🐸&mldr;<br>维护：..✂🌼✂🐤✂🐛✂🐙✂🐸&mldr;差不多了&mldr;<br>维护：喔噻，工具多了人不慌&mldr;&mldr;<br>维护：..咦，🪓~砍一砍&mldr; 🔧~转一转&mldr; 🔨~敲一敲&mldr;<br>仓管：停，停，停&mldr;&mldr;留着剪刀，其它的都还回来&mldr;&mldr;<br>&mldr;&mldr; 修正错误 &mldr;&mldr;<br>维护：天线架上缠绕的的附着物又多了，得剪一剪&mldr;<br>仓管：去物架上取剪刀&mldr;&mldr;</p></blockquote><p><span style=margin-left:2em></span>通过<strong>引入中间对象类对接口进行有效的隔离，很好的就解决了GoldenDict中的JS提权漏洞</strong> &mdash; 或者说，这不应该被称为漏洞，因为所有的接口都是有效的，都是被程序需要的，都是在特定的场景下为用户服务的，只是大部分接口都不能被用户直接使用而已。</p><p><span style=margin-left:2em></span>另一方面这也给我们一些启发，既然为Web框架注册QObject对象是QtWebKit的优点，我们就应该好好使用这一机制。</p><blockquote><p>GoldenDict不支持对HTML5音视频元素，不能播放视频嘛？<br>调用外部应用来播放不行吗？<br>对呀，暴风影音、PotrPlayer、MPC，我装了这么多，得用起来才对呀？<br>好吧，给你再加一方法，可以用来处理视频文件&mldr;&mldr;<br>&mldr;&mldr;&mldr;&mldr;&mldr;&mldr;&mldr;&mldr;</p></blockquote><p><span style=margin-left:2em></span>啧~啧~，给JS注册类加一个播放视频文件的公有接口&mldr;实现接口功能&mldr;&mldr;<br><span style=margin-left:2em></span>来吧，用起来，GoldenDic中也可以观看词典中的视频内容啦&mldr;<br><span style=margin-left:2em></span>看看，GoldenDict脱胎换骨啦，咱们用着爽快，连炸片咸鱼贩子都满腮帮哈喇子瞅着呢&mldr;&mldr;<br><span style=margin-left:2em></span>好吧，最后安利一下：强烈建议所有使用GD++的学友升级到最新版本&mldr;&mldr;</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top · 回顶部" rel=nofollow>&#127772;2021-11-16 </a><a href=https://autoptr.top/license/ title="All rights reserved · 原创内容·版权所有" target=_blank rel=nofollow>&copy;</a></span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2025 AuTopTr 版权所有</a><a href=https://autoptr.top/ title="Back to Home · 回首页">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>标签:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/JavaScript target=_blank>JavaScript</a></li><li><a class=link href=https://autoptr.top/tags/WebKit target=_blank>WebKit</a></li><span>&nbsp;&nbsp;</span>
<span>分类:</span><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li><li><a class=link href=https://autoptr.top/categories/GoldenDict target=_blank>GoldenDict</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>