<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>NSUndoManager</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="NSUndoManager,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="NSUndoManager,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"ğŸŒœ"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>NSUndoManager</span><span class=btRight><span title="Author Â· ä½œè€…" class=author>Delisa Mason</span> <span title="Translator Â· ç¿»è¯‘" class=author>Croath Liu</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post Â· å…³è”æˆ–è½¬è½½å¼•ç”¨çš„æ–‡ç« " target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics Â· å›ä¸»é¢˜é¡µ">&#127793;</a></span></h1><p>æ¯ä¸ªäººéƒ½ä¼šçŠ¯é”™è¯¯ã€‚å¤šäºäº† Foundation åº“æä¾›äº†æ¯”æ‹¼å†™é”™è¯¯æ›´å¼ºå¤§çš„åŠŸèƒ½æ¥è§£æ•‘æˆ‘ä»¬ã€‚Cocoa æœ‰ä¸€å¥—ç®€å•å¼ºå£®çš„ NSUndoManager API ç®¡ç†æ’¤é”€å’Œé‡åšã€‚</p><p>é»˜è®¤åœ°ï¼Œæ¯ä¸ªåº”ç”¨çš„ window éƒ½æœ‰ä¸€ä¸ª undo managerï¼Œæ¯ä¸€ä¸ªå“åº”é“¾æ¡ä¸­çš„å¯¹è±¡éƒ½å¯ä»¥ç®¡ç†ä¸€ä¸ªè‡ªå®šä¹‰çš„ undo manager æ¥ç®¡ç†å„è‡ªé¡µé¢ä¸Šæœ¬åœ°æ“ä½œçš„æ’¤é”€å’Œé‡åšæ“ä½œã€‚<code>UITextField</code> å’Œ <code>UITextView</code> ç”¨è¿™ä¸ªåŠŸèƒ½è‡ªåŠ¨æä¾›äº†æ–‡æœ¬ç¼–è¾‘çš„æ’¤é”€é‡åšæ”¯æŒã€‚ç„¶è€Œï¼Œæ ‡æ˜å“ªäº›åŠ¨ä½œå¯ä»¥è¢«æ’¤é”€æ˜¯ç•™ç»™åº”ç”¨å¼€å‘å·¥ç¨‹å¸ˆçš„å·¥ä½œã€‚</p><p>åˆ›å»ºä¸€ä¸ªå¯ä»¥æ’¤é”€çš„åŠ¨ä½œéœ€è¦ä¸‰æ­¥ï¼šåšå‡ºæ”¹å˜ï¼Œæ³¨å†Œä¸€ä¸ªå¯ä»¥é€†å‘çš„ &ldquo;æ’¤é”€æ“ä½œ&rdquo;ï¼Œå“åº”æ’¤é”€æ”¹å˜çš„åŠ¨ä½œã€‚</p><h2 id=æ’¤é”€æ“ä½œundo-operations>æ’¤é”€æ“ä½œ(undo operations)</h2><p>ä¸ºäº†æ ‡æ˜æŸä¸ªåŠ¨ä½œå¯ä»¥è¢«æ’¤é”€ï¼Œéœ€è¦åœ¨æ‰§è¡ŒåŠ¨ä½œçš„æ—¶å€™æ³¨å†Œä¸€ä¸ª &ldquo;æ’¤é”€æ“ä½œ&rdquo;ã€‚<a href=https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/UndoArchitecture/Articles/UndoManager.html#//apple_ref/doc/uid/20000205-CJBDJCCJ>æ’¤é”€æ¶æ„æ–‡æ¡£</a> ä¸­å®šä¹‰ &ldquo;undo operation&rdquo; ä¸ºï¼š</p><blockquote><p>å¯ä»¥å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œé€†å‘æ“ä½œçš„æ–¹æ³•ï¼Œå¹¶ä¸”éœ€è¦ä¼ é€’ç›¸åº”å¿…éœ€çš„å‚æ•°ã€‚</p></blockquote><p>å…·ä½“æŒ‡çš„æ˜¯ï¼š</p><ul><li>ç”¨äºæ¥æ”¶æ’¤é”€æ“ä½œä¿¡æ¯çš„å¯¹è±¡</li><li>éœ€è¦ä¼ é€’çš„ä¿¡æ¯</li><li>ä¿¡æ¯æ‰€æºå¸¦çš„å‚æ•°</li></ul><p>å¦‚æœè¢«æ’¤é”€æ“ä½œè°ƒç”¨çš„æ–¹æ³•ä¹Ÿæ³¨å†Œäº†ä¸€ä¸ªæ’¤é”€æ“ä½œï¼Œé‚£ä¹ˆæ’¤é”€ç®¡ç†å™¨ä¸éœ€è¦åšé¢å¤–çš„å·¥ä½œå°±å¯ä»¥æä¾›é‡åš(redo)æ”¯æŒï¼Œç›¸å½“äº &ldquo;æ’¤é”€æ’¤é”€çš„æ“ä½œ&rdquo;ã€‚</p><p>å…±æœ‰ä¸¤ç§æ’¤é”€æ“ä½œï¼Œç®€å•çš„ä»¥ selector ä¸ºåŸºç¡€çš„æ’¤é”€å’Œå¤æ‚çš„ä»¥ NSInvocation ä¸ºåŸºç¡€çš„æ’¤é”€ã€‚</p><h3 id=æ³¨å†Œä¸€ä¸ªç®€å•çš„æ’¤é”€æ“ä½œ>æ³¨å†Œä¸€ä¸ªç®€å•çš„æ’¤é”€æ“ä½œ</h3><ul><li>æ³¨å†Œä¸€ä¸ªç®€å•çš„æ’¤é”€æ“ä½œï¼Œå¦‚æœç›®æ ‡å¯è¿›è¡Œæ’¤é”€æ“ä½œï¼Œè°ƒç”¨å…¶ <code>NSUndoManger -registerUndoWithTarget:selector:object:</code> æ–¹æ³•å°±å¯ä»¥äº†ã€‚ç›®æ ‡ä¸å¿…æ˜¯é‚£ä¸ªè¢«æ”¹å˜çš„å¯¹è±¡ï¼Œé€šå¸¸æ˜¯ç®¡ç†å¯¹è±¡çŠ¶æ€çš„å·¥å…·æˆ–å®¹å™¨ã€‚åŒæ—¶è°ƒç”¨ <code>NSUndoManager -setActionName:</code> æŒ‡å®šæ’¤é”€æ“ä½œçš„åç§°ã€‚æ’¤é”€å¯¹è¯ä¼šå±•ç¤ºåŠ¨ä½œçš„åç§°ï¼Œæ‰€ä»¥åº”è¯¥è¿›è¡Œæœ¬åœ°åŒ–æ“ä½œã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>updateScore</span>(score: NSNumber) {
</span></span><span style=display:flex><span>    undoManager.registerUndoWithTarget(<span style=color:#66d9ef>self</span>, selector:Selector(<span style=color:#e6db74>&#34;updateScore:&#34;</span>), object:myMovie.score)
</span></span><span style=display:flex><span>    undoManager.setActionName(NSLocalizedString(<span style=color:#e6db74>&#34;actions.update&#34;</span>, comment: <span style=color:#e6db74>&#34;Update Score&#34;</span>))
</span></span><span style=display:flex><span>    myMovie.score = score
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>updateScore:</span>(NSNumber<span style=color:#f92672>*</span>)score {
</span></span><span style=display:flex><span>    [undoManager registerUndoWithTarget:self selector:<span style=color:#66d9ef>@selector</span>(updateScore:) object:myMovie.score];
</span></span><span style=display:flex><span>    [undoManager setActionName:NSLocalizedString(<span style=color:#e6db74>@&#34;actions.update&#34;</span>, <span style=color:#e6db74>@&#34;Update Score&#34;</span>)];
</span></span><span style=display:flex><span>    myMovie.score <span style=color:#f92672>=</span> score;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=ä½¿ç”¨-nsinvocation-æ³¨å†Œå¤æ‚çš„æ’¤é”€æ“ä½œ>ä½¿ç”¨ NSInvocation æ³¨å†Œå¤æ‚çš„æ’¤é”€æ“ä½œ</h3><p>ç®€å•çš„æ’¤é”€æ“ä½œåœ¨æŸäº›ä½¿ç”¨åœºæ™¯ä¸‹å¯èƒ½å¤ªç²—ç³™äº†ï¼Œæ¯”å¦‚è¯´æ’¤é”€æŸä¸ªåŠ¨ä½œéœ€è¦ä¸åªä¸€ä¸ªå‚æ•°ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>NSInvocation</code> æ¥è®°å½•æ‰€éœ€ selector å’Œç›¸åº”å‚æ•°ã€‚è°ƒç”¨ <code>prepareWithInvocationTarget:</code> è®°å½•å“ªäº›å¯¹è±¡ä¼šæ¥æ”¶å“ªäº›å‘ç”Ÿæ”¹å˜çš„æ¶ˆæ¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>movePiece</span>(piece: ChessPiece, row:UInt, column:UInt) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> undoController : ViewController = undoManager?.prepareWithInvocationTarget(<span style=color:#66d9ef>self</span>) <span style=color:#66d9ef>as</span> ViewController
</span></span><span style=display:flex><span>    undoController.movePiece(piece, row:piece.row, column:piece.column)
</span></span><span style=display:flex><span>    undoManager?.setActionName(NSLocalizedString(<span style=color:#e6db74>&#34;actions.move-piece&#34;</span>, <span style=color:#e6db74>&#34;Move Piece&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    piece.row = row
</span></span><span style=display:flex><span>    piece.column = column
</span></span><span style=display:flex><span>    updateChessboard()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>movePiece:</span>(ChessPiece<span style=color:#f92672>*</span>)piece <span style=color:#a6e22e>toRow:</span>(NSUInteger)row <span style=color:#a6e22e>column:</span>(NSUInteger)column {
</span></span><span style=display:flex><span>    [[undoManager prepareWithInvocationTarget:self] movePiece:piece ToRow:piece.row column:piece.column];
</span></span><span style=display:flex><span>    [undoManager setActionName:NSLocalizedString(<span style=color:#e6db74>@&#34;actions.move-piece&#34;</span>, <span style=color:#e6db74>@&#34;Move Piece&#34;</span>)];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    piece.row <span style=color:#f92672>=</span> row;
</span></span><span style=display:flex><span>    piece.column <span style=color:#f92672>=</span> column;
</span></span><span style=display:flex><span>    [self updateChessboard];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æœ€æœ‰é­”åŠ›çš„éƒ¨åˆ†æ˜¯ï¼š<code>NSUndoManager</code> å®ç°äº† <code>forwardInvocation:</code>ã€‚å½“æ’¤é”€ç®¡ç†å™¨æ”¶åˆ°æ¶ˆæ¯å»æ’¤é”€ <code>-movePiece:row:column:</code> æ—¶ï¼Œå› ä¸º <code>NSUndoManager</code> æ²¡æœ‰å®ç°é‚£ä¸ªæ–¹æ³•ï¼Œäºæ˜¯å®ƒå°†è¯¥æ¶ˆæ¯è½¬å‘è‡³ç›¸åº”å¯¹è±¡ã€‚</p><h2 id=å®ç°ä¸€æ¬¡æ’¤é”€>å®ç°ä¸€æ¬¡æ’¤é”€</h2><p>ä¸€æ—¦æ³¨å†Œäº†æ’¤é”€æ“ä½œï¼ŒåŠ¨ä½œå°±å¯ä»¥åœ¨éœ€è¦æ—¶è°ƒç”¨ <code>NSUndoManager -undo</code> å’Œ <code>NSUndoManager -redo</code>è¢«æ’¤é”€å’Œé‡åšã€‚</p><h3 id=å“åº”-ios-çš„æ‘‡æ™ƒæ‰‹åŠ¿>å“åº” iOS çš„æ‘‡æ™ƒæ‰‹åŠ¿</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨æˆ·é€šè¿‡æ‘‡æ™ƒè®¾å¤‡æ¥è§¦å‘æ’¤é”€æ“ä½œã€‚å¦‚æœä¸€ä¸ª view controller éœ€è¦å¤„ç†ä¸€ä¸ªæ’¤é”€è¯·æ±‚ï¼Œé‚£ä¹ˆè¿™ä¸ª view controller å¿…é¡»ï¼š</p><ol><li>èƒ½æˆä¸º first responder</li><li>ä¸€æ—¦é¡µé¢æ˜¾ç¤º(view appears)ï¼Œå³å˜æˆ first responder</li><li>ä¸€æ—¦é¡µé¢æ¶ˆå¤±(view disappears)ï¼Œå³æ”¾å¼ƒ first responder</li></ol><p>å½“ view controller æ¥æ”¶åˆ°è¿åŠ¨äº‹ä»¶ï¼Œå½“æ’¤é”€æˆ–é‡åšå¯ç”¨æ—¶ï¼Œç³»ç»Ÿä¼šå±•ç¤ºç»™ç”¨æˆ·ä¸€ä¸ªä¼šè¯ç•Œé¢ã€‚View controller çš„ <code>undoManager</code> å±æ€§ä¸éœ€è¦å…¶ä»–æ“ä½œå°±å¯ä»¥å“åº”ç”¨æˆ·çš„é€‰æ‹©ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ViewController</span>: UIViewController {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>viewDidAppear</span>(animated: Bool) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.viewDidAppear(animated)
</span></span><span style=display:flex><span>        becomeFirstResponder()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>viewWillDisappear</span>(animated: Bool) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.viewWillDisappear(animated)
</span></span><span style=display:flex><span>        resignFirstResponder()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>canBecomeFirstResponder</span>() -&gt; Bool {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#66d9ef>@implementation</span> <span style=color:#a6e22e>ViewController</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>viewDidAppear:</span>(<span style=color:#66d9ef>BOOL</span>)animated {
</span></span><span style=display:flex><span>    [super viewDidAppear:animated];
</span></span><span style=display:flex><span>    [self becomeFirstResponder];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>viewWillDisappear:</span>(<span style=color:#66d9ef>BOOL</span>)animated {
</span></span><span style=display:flex><span>    [super viewWillDisappear:animated];
</span></span><span style=display:flex><span>    [self resignFirstResponder];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- (<span style=color:#66d9ef>BOOL</span>)<span style=color:#a6e22e>canBecomeFirstResponder</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> YES;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@end</span>
</span></span></code></pre></div><h2 id=è‡ªå®šä¹‰æ’¤é”€æ ˆ>è‡ªå®šä¹‰æ’¤é”€æ ˆ</h2><h3 id=å°†åŠ¨ä½œç»„åˆåˆ°ä¸€èµ·>å°†åŠ¨ä½œç»„åˆåˆ°ä¸€èµ·</h3><p>åœ¨åŒä¸€ run loop ä¸­è¢«æ³¨å†Œçš„æ‰€æœ‰çš„æ’¤é”€æ“ä½œå¯ä»¥è¢«ä¸€åŒæ’¤é”€ï¼Œé™¤é &ldquo;æ’¤é”€ç»„åˆ(undo groups)&rdquo; è¢«å•ç‹¬æŒ‡å®šäº†ã€‚æ’¤é”€ç»„åˆå…è®¸åŒæ—¶è¿›è¡Œè®¸å¤šæ’¤é”€å’Œé‡åšæ“ä½œã€‚è™½ç„¶æ¯ä¸ªåŠ¨ä½œéƒ½å¯ä»¥å•ç‹¬è¢«æ‰§è¡Œå’Œæ’¤é”€ï¼Œä½†å¦‚æœç”¨æˆ·åŒæ—¶æ‰§è¡Œäº†ä¸¤ä¸ªåŠ¨ä½œï¼ŒåŒæ—¶æ’¤é”€ä»–ä»¬åˆ™éœ€è¦ä¿æŒä¸€è‡´çš„ç”¨æˆ·ä½“éªŒã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>readAndArchiveEmail</span>(email: Email) {
</span></span><span style=display:flex><span>    undoManager?.beginUndoGrouping()
</span></span><span style=display:flex><span>    markEmail(email, read: <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>    archiveEmail(email)
</span></span><span style=display:flex><span>    undoManager?.setActionName(NSLocalizedString(<span style=color:#e6db74>&#34;actions.read-archive&#34;</span>, comment:<span style=color:#e6db74>&#34;Mark as Read and Archive&#34;</span>))
</span></span><span style=display:flex><span>    undoManager?.endUndoGrouping()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>markEmail</span>(email: Email, read:Bool) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> undoController: ViewController = undoManager?.prepareWithInvocationTarget(<span style=color:#66d9ef>self</span>) <span style=color:#66d9ef>as</span> ViewController
</span></span><span style=display:flex><span>    undoController.markEmail(email, read:email.read)
</span></span><span style=display:flex><span>    undoManager?.setActionName(NSLocalizedString(<span style=color:#e6db74>&#34;actions.read&#34;</span>, comment:<span style=color:#e6db74>&#34;Mark as Read&#34;</span>))
</span></span><span style=display:flex><span>    email.read = read
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>archiveEmail</span>(email: Email) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> undoController: ViewController = undoManager?.prepareWithInvocationTarget(<span style=color:#66d9ef>self</span>) <span style=color:#66d9ef>as</span> ViewController
</span></span><span style=display:flex><span>    undoController.moveEmail(email, toFolder:<span style=color:#e6db74>&#34;Inbox&#34;</span>)
</span></span><span style=display:flex><span>    undoManager?.setActionName(NSLocalizedString(<span style=color:#e6db74>&#34;actions.archive&#34;</span>, comment:<span style=color:#e6db74>&#34;Archive&#34;</span>))
</span></span><span style=display:flex><span>    moveEmail(email, toFolder:<span style=color:#e6db74>&#34;All Mail&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>readAndArchiveEmail:</span>(Email<span style=color:#f92672>*</span>)email {
</span></span><span style=display:flex><span>    [undoManager beginUndoGrouping];
</span></span><span style=display:flex><span>    [self markEmail:email asRead:YES];
</span></span><span style=display:flex><span>    [self archiveEmail:email];
</span></span><span style=display:flex><span>    [undoManager setActionName:NSLocalizedString(<span style=color:#e6db74>@&#34;actions.read-archive&#34;</span>, <span style=color:#e6db74>@&#34;Mark as Read and Archive&#34;</span>)];
</span></span><span style=display:flex><span>    [undoManager endUndoGrouping];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>markEmail:</span>(Email<span style=color:#f92672>*</span>)email <span style=color:#a6e22e>asRead:</span>(<span style=color:#66d9ef>BOOL</span>)isRead {
</span></span><span style=display:flex><span>    [[undoManager prepareWithInvocationTarget:self] markEmail:email asRead:[email isRead]];
</span></span><span style=display:flex><span>    [undoManager setActionName:NSLocalizedString(<span style=color:#e6db74>@&#34;actions.read&#34;</span>, <span style=color:#e6db74>@&#34;Mark as Read&#34;</span>)];
</span></span><span style=display:flex><span>    email.read <span style=color:#f92672>=</span> isRead;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>archiveEmail:</span>(Email<span style=color:#f92672>*</span>)email {
</span></span><span style=display:flex><span>    [[undoManager prepareWithInvocationTarget:self] moveEmail:email toFolder:<span style=color:#e6db74>@&#34;Inbox&#34;</span>];
</span></span><span style=display:flex><span>    [undoManager setActionName:NSLocalizedString(<span style=color:#e6db74>@&#34;actions.archive&#34;</span>, <span style=color:#e6db74>@&#34;Archive&#34;</span>)];
</span></span><span style=display:flex><span>    [self moveEmail:email toFolder:<span style=color:#e6db74>@&#34;All Mail&#34;</span>];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=æ¸…ç©ºæ ˆ>æ¸…ç©ºæ ˆ</h3><p>æœ‰æ—¶æ’¤é”€ç®¡ç†å™¨çš„åŠ¨ä½œåˆ—è¡¨éœ€è¦è¢«æ¸…ç©ºæ¥é¿å…å¯¼è‡´æ„å¤–ç»“æœè¿·æƒ‘ç”¨æˆ·ã€‚é€šå¸¸æƒ…å†µä¸‹å½“ä¸Šä¸‹æ–‡å‘ç”Ÿæˆå‰§æ€§å˜åŒ–æ—¶ï¼Œæ¯”å¦‚è¯´ iOS ä¸Šæ”¹å˜äº†æ˜¾ç¤ºçš„ view controller æˆ–ä¸€ä¸ªæ‰“å¼€çš„æ–‡æ¡£å¤–éƒ¨å‘ç”Ÿäº†å˜åŒ–ã€‚æ­¤æ—¶ï¼Œæ’¤é”€ç®¡ç†å™¨çš„æ ˆå¯ä»¥é€šè¿‡ <code>NSUndoManager -removeAllActions</code> æ¥æ¸…ç©ºæˆ–ä½¿ç”¨ <code>NSUndoManager -removeAllActionsWithTarget:</code> åœ¨æ›´ç»†çš„åŠ›åº¦ä¸Šæ¸…ç©ºã€‚</p><h2 id=è­¦å‘Š>è­¦å‘Š</h2><p>å¦‚æœä¸€ä¸ªæ“ä½œçš„æ’¤é”€å’Œé‡åšæœ‰ä¸åŒçš„åå­—ï¼Œæ£€æŸ¥æ’¤é”€æ“ä½œæ˜¯å¦æ‰§è¡Œåœ¨è®¾ç½®æ“ä½œåç§°ä¹‹å‰æ¥ç¡®ä¿æ’¤é”€ä¼šè¯çš„æ ‡é¢˜èƒ½å¤Ÿæ­£ç¡®ååº”å“ªä¸ªåŠ¨ä½œå³å°†è¢«æ’¤é”€ã€‚ä¸€ä¸ªä¾‹å­å°±æ˜¯ä¸€å¯¹ç›¸åçš„æ“ä½œï¼Œæ¯”å¦‚æ·»åŠ å’Œåˆ é™¤å¯¹è±¡ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>addItem</span>(item: NSObject) {
</span></span><span style=display:flex><span>    undoManager?.registerUndoWithTarget(<span style=color:#66d9ef>self</span>, selector: Selector(<span style=color:#e6db74>&#34;removeItem:&#34;</span>), object:item)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> undoManager?.undoing == <span style=color:#66d9ef>false</span> {
</span></span><span style=display:flex><span>        undoManager?.setActionName(NSLocalizedString(<span style=color:#e6db74>&#34;action.add-item&#34;</span>, comment: <span style=color:#e6db74>&#34;Add Item&#34;</span>))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    myArray.append(item)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>removeItem</span>(item: NSObject) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> index = find(myArray, item) {
</span></span><span style=display:flex><span>        undoManager?.registerUndoWithTarget(<span style=color:#66d9ef>self</span>, selector: Selector(<span style=color:#e6db74>&#34;addItem:&#34;</span>), object:item)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> undoManager?.undoing == <span style=color:#66d9ef>false</span> {
</span></span><span style=display:flex><span>            undoManager?.setActionName(NSLocalizedString(<span style=color:#e6db74>&#34;action.remove-item&#34;</span>, comment: <span style=color:#e6db74>&#34;Remove Item&#34;</span>))
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        myArray.removeAtIndex(index)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>addItem:</span>(<span style=color:#66d9ef>id</span>)item {
</span></span><span style=display:flex><span>    [undoManager registerUndoWithTarget:self selector:<span style=color:#66d9ef>@selector</span>(removeItem:) object:item];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>[undoManager isUndoing]) {
</span></span><span style=display:flex><span>        [undoManager setActionName:NSLocalizedString(<span style=color:#e6db74>@&#34;actions.add-item&#34;</span>, <span style=color:#e6db74>@&#34;Add Item&#34;</span>)];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    [myArray addObject:item];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>removeItem:</span>(<span style=color:#66d9ef>id</span>)item {
</span></span><span style=display:flex><span>    [undoManager registerUndoWithTarget:self selector:<span style=color:#66d9ef>@selector</span>(addItem:) object:item];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>[undoManager isUndoing]) {
</span></span><span style=display:flex><span>        [undoManager setActionName:NSLocalizedString(<span style=color:#e6db74>@&#34;actions.remove-item&#34;</span>, <span style=color:#e6db74>@&#34;Remove Item&#34;</span>)];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    [myArray removeObject:item];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å¦‚æœä½ çš„æµ‹è¯•æ¡†æ¶(ä¾‹å¦‚ Kiwi)åœ¨åŒä¸€ä¸ª run loop ä¸­è¿è¡Œå¤šä¸ªæµ‹è¯•ï¼Œåœ¨ <code>teardown</code> ä¸­çš„å„ä¸ªæµ‹è¯•ä¸­é—´æ‰§è¡Œæƒ…å†µæ’¤é”€æ ˆçš„æ“ä½œã€‚å¦åˆ™å…¶ä»–æµ‹è¯•åœ¨è¿è¡Œä¸­è°ƒç”¨ <code>NSUndoManager -undo</code> æ—¶ä¼šå…±äº«åŒä¸€æ’¤é”€çŠ¶æ€ï¼Œå¯¼è‡´æ„å¤–çš„ç»“æœã€‚</p><hr><p>ç”¨ <code>NSUndoManager</code> è¿˜èƒ½æœ‰æ›´å¤šæ–¹å¼æç‚¼è®¸å¤šè¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯ä¸€äº›ç»„åˆæ“ä½œå’Œç®¡ç†é€‚ç”¨èŒƒå›´æ–¹é¢ã€‚è‹¹æœä¸ºåœ¨é€‚å½“åœºæ™¯ä¸‹åˆç†ä½¿ç”¨æ’¤é”€å’Œé‡åšæä¾›äº† <a href=https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/MobileHIG/UndoRedo.html>å¯ç”¨æ€§æŒ‡å—</a> ã€‚</p><p>æˆ‘ä»¬éƒ½å¸Œæœ›ç”Ÿæ´»ä¸­ä¸çŠ¯é”™ï¼Œä½† Cocoa ç»™äº†æˆ‘ä»¬ä¸€ä¸ªè®©æˆ‘ä»¬ç”Ÿæ´»æœ‰æ›´å°‘é—æ†¾çš„æœºä¼šï¼Œå¯ä»¥æ›´ç®€å•åœ°åšå‡ºä¸€äº›æ”¹å˜ã€‚</p><hr><p>é™¤é<a href=https://nshipster.cn/ target=_blank>å¦æœ‰å£°æ˜</a>ï¼Œæœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ã€Œ<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 3.0 ä¸­å›½å¤§é™†</a>ã€è®¸å¯åè®®æˆæƒã€‚</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top Â· å›é¡¶éƒ¨" rel=nofollow>&#127772;2014-12-15 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2026 Delisa Mason ç‰ˆæƒæ‰€æœ‰</a><a href=https://autoptr.top/ title="Back to Home Â· å›é¦–é¡µ">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>æ ‡ç­¾:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>åˆ†ç±»:</span><li><a class=link href=https://autoptr.top/categories/Cocoa target=_blank>Cocoa</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>