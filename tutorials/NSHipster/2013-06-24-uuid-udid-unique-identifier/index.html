<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>NSUUID / CFUUIDRef / UIDevice -uniqueIdentifier / -identifierForVendor</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="NSUUID / CFUUIDRef / UIDevice -uniqueIdentifier / -identifierForVendor,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="NSUUID / CFUUIDRef / UIDevice -uniqueIdentifier / -identifierForVendor,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"🌜"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>NSUUID / CFUUIDRef / UIDevice -uniqueIdentifier / -identifierForVendor</span><span class=btRight><span title="Author · 作者" class=author>Mattt</span> <span title="Translator · 翻译" class=author>April Peng</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post · 关联或转载引用的文章" target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics · 回主题页">&#127793;</a></span></h1><p>比方说，你正在做一个有版权的软件，就需要防止盗版。我的意思是，这再明显不过了 - <a href=http://www.fakeblock.com>已经有人在做这件事了</a>。而你正想成为 <em>那个</em> 人。</p><p>直到最近之前，应用程序，甚至是跨应用程序启动的时候，获得设备的唯一标识一直都是小菜一碟，简单的请求 UIDevice -uniqueIdentifier 就完事了。</p><p>然而，<code>UIDevice -uniqueIdentifier</code> 在 iOS 5 就被废弃了，以下是注释：</p><blockquote><p>可酌情使用 [<code>UIDevice</code>] 的 <code>identifierForVendor</code> 属性 或 <code>ASIdentifierManager</code> 类的 <code>advertisingIdentifier</code> 代替，或使用 <code>NSUUID</code> 类的 <code>UUID</code> 方法来创建一个 <code>UUID</code> 并写入到用户的默认数据库。</p></blockquote><p><a href="https://developer.apple.com/news/?id=3212013a">从 5 月 1 日起</a>，苹果公司开始强制所有新提交的应用程序不能再使用这个废弃的 API，即使是针对早期版本 iOS 的应用程序也一样。任何使用 <code>uniqueIdentifier</code> 的二进制文件都将立即被拒。</p><p>就像版权和盗版有语音和概念上的相似性一样，设备标识符，无论是 UUID / GUID，UDID，或其他方式都是相当容易混淆的：</p><ul><li><strong>UUID <em>（通用唯一标识符）</em></strong>：一个 128 位的序列，可以保证跨时间和空间的唯一性，由 <a href=http://www.ietf.org/rfc/rfc4122.txt>RFC4122</a> 定义。</li><li><strong>GUID <em>（全局唯一标识符）</em></strong>：微软实现的 UUID 规范；经常与 UUID 互换使用。</li><li><strong>UDID <em>（设备唯一标识符）</em></strong>：40 个十六进制字符，用来唯一标识 iOS 设备（可当做该设备的<a href=https://zh.wikipedia.org/wiki/%E7%A4%BE%E6%9C%83%E5%AE%89%E5%85%A8%E8%99%9F%E7%A2%BC>社会安全码</a>）。这个值可以<a href=http://whatsmyudid.com>从 iTunes 得到</a>，或使用 <code>UIDevice -uniqueIdentifier</code> 得到类似 <a href=https://en.wikipedia.org/wiki/MAC_address>MAC 地址</a> 这样的硬件详细信息。</li></ul><p>顺便说一句，所有在说明中列出的可以替代 <code>UIDevice -uniqueIdentifier</code> 的建议都会返回 UUID，不论是自动从 <code>UIDevice -identifierForVendor</code> 和 <code>ASIdentifierManager -advertisingIdentifier</code> 创建或从 <code>NSUUID</code> （或 <code>CFUUIDCreate</code>） 手动创建。</p><h2 id=供应商标识>供应商标识</h2><blockquote><p>对于同一设备上运行的相同运营商的应用程序来说，此属性返回的值都是相同的。同一台设备在不同运营商连接的情况下会返回给应用程序不同的值。而对于不同的设备来说，不管什么运营商，返回给应用程序的值都不一样。</p></blockquote><blockquote><p>只要应用程序（或同一运营商的另一个应用程序）安装在 iOS 设备上后，此属性的值都将保持不变。而当用户从设备删除所有该供应商的应用程序，并随后重新安装其中一个或多个应用程序时，该值将会改变。因此，如果你的应用程序在任何地方存储了这一属性的值，你需要正确处理标识符变化的这种情况。</p></blockquote><p>在很多情况下，这才应该是其正确使用方法。应用程序开发者现在仍然找办法来确认设备的唯一标识，即使是从出自同样开发者的其他应用程序，而不把这种任务交给设备的 UDID。</p><p>对于大多数应用来说，查找 <code>uniqueIdentifier</code> 并将其替换为 <code>identifierForVendor</code> 就足够了。</p><p>但是，对于广告网络来说，需要把来自多个开发人员的不同的应用程序制定一个一致的识别符，必需需要一个不同的方法：</p><h2 id=广告标识>广告标识</h2><blockquote><p>iOS 6 引入的广告标识，是一个非永久性的，非个人的设备标识符。广告网络将使用它来使你可以更好地通过跟踪方法控制广告投放。如果用户设置了限制广告追踪，使用广告标识的广告网络可能就不能再通过收集信息来提供针对性的广告了。在未来，所有的广告网络都将被要求使用广告标识符。然而，在广告网络过渡到使用广告标识之前，你可能还会收到来自其他网络的针对性的广告。</p></blockquote><p>作为 <a href=https://developer.apple.com/library/ios/#documentation/DeviceInformation/Reference/AdSupport_Framework/_index.html%23//apple_ref/doc/uid/TP40012658>Ad Support framework</a> 仅有的组件, <code>ASIdentifierManager</code> 的作案手法很明确：提供一种方法让广告网络通过不同的应用程序跟踪用户行为，但又不触犯隐私。</p><p>用户可以在 iOS 6.1 新加的设置页面来选择限制广告跟踪，位置在 <strong>设置 > 通用 > 关于本机 > 广告</strong> (在 iOS 9.2 上，这个设置的位置已经修改： 设置 > 隐私 > 广告 [译者注])：</p><p><img alt="Limit Ad Tracking" src=/media/NSHipster/ad-support-limit-ad-tracking.png></p><h2 id=nsuuid--cfuuidref>NSUUID & CFUUIDRef</h2><p>在 iOS 6 中被加到 Foundation 的 <code>NSUUID</code> 可以用来轻松地创建的 UUID。有多容易呢？</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> UUID = NSUUID.UUID().UUIDString
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSString <span style=color:#f92672>*</span>UUID <span style=color:#f92672>=</span> [[NSUUID UUID] UUIDString];
</span></span></code></pre></div><p>不过，如果你的应用针对 iOS 5 或更早的版本，你必须设置 Core Foundation 的 <code>CFUUIDRef</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> UUID = CFUUIDCreateString(<span style=color:#66d9ef>nil</span>, CFUUIDCreate(<span style=color:#66d9ef>nil</span>))
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>CFUUIDRef uuid <span style=color:#f92672>=</span> CFUUIDCreate(NULL);
</span></span><span style=display:flex><span>NSString <span style=color:#f92672>*</span>UUID <span style=color:#f92672>=</span> CFUUIDCreateString(NULL, uuid);
</span></span></code></pre></div><p>对那些基于基础 SDK 而没有使用运营商或广告标识 API 的应用程序来说，使用弃用说明里推荐的方法就可以达到类似的效果，使用 <a href=https://developer.apple.com/library/ios/#documentation/cocoa/reference/foundation/Classes/NSUserDefaults_Class/Reference/Reference.html><code>NSUserDefaults</code></a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>application</span>(application: UIApplication!, didFinishLaunchingWithOptions launchOptions: NSDictionary!) -&gt; Bool {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> userDefaults = NSUserDefaults.standardUserDefaults()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> userDefaults.objectForKey(<span style=color:#e6db74>&#34;ApplicationUniqueIdentifier&#34;</span>) == <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> UUID = NSUUID.UUID().UUIDString
</span></span><span style=display:flex><span>        userDefaults.setObject(UUID, forKey: <span style=color:#e6db74>&#34;ApplicationUniqueIdentifier&#34;</span>)
</span></span><span style=display:flex><span>        userDefaults.synchronize()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>- (<span style=color:#66d9ef>BOOL</span>)<span style=color:#a6e22e>application:</span>(UIApplication <span style=color:#f92672>*</span>)application
</span></span><span style=display:flex><span><span style=color:#a6e22e>didFinishLaunchingWithOptions:</span>(NSDictionary <span style=color:#f92672>*</span>)launchOptions
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    NSString <span style=color:#f92672>*</span>UUID <span style=color:#f92672>=</span> [[NSUserDefaults standardUserDefaults] objectForKey:kApplicationUUIDKey];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>UUID) {
</span></span><span style=display:flex><span>        CFUUIDRef uuid <span style=color:#f92672>=</span> CFUUIDCreate(NULL);
</span></span><span style=display:flex><span>        UUID <span style=color:#f92672>=</span> (<span style=color:#66d9ef>__bridge_transfer</span> NSString <span style=color:#f92672>*</span>)CFUUIDCreateString(NULL, uuid);
</span></span><span style=display:flex><span>        CFRelease(uuid);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        [[NSUserDefaults standardUserDefaults] setObject:UUID forKey:kApplicationUUIDKey];
</span></span><span style=display:flex><span>        [[NSUserDefaults standardUserDefaults] synchronize];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>以此方式，一个 UUID 会在应用程序启动的第一时间被生成，然后存储在 <code>NSUserDefaults</code> 以便随后每次应用程序的启动所调用。不同于广告或运营商标识的是，这些标识不会同其他应用程序共享，但对于大多数的意图和目的来说，这已经足够达到目的了。</p><hr><p>当然，UUID 还有许多其他用途：用于记录在分布式系统的主标识符，临时文件的名称，或甚至是一个散色生成器（把十六进制串成每组 6 个，一共 5 组的表示方式！）。但在 iOS 上，它主要还是用于跟踪，用于发现在网络和可能性的汪洋中遗失了什么。理解你有多独特是了解一切的第一步。</p><hr><p>除非<a href=https://nshipster.cn/ target=_blank>另有声明</a>，本文采用知识共享「<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>署名-非商业性使用 3.0 中国大陆</a>」许可协议授权。</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top · 回顶部" rel=nofollow>&#127772;2013-06-24 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2025 Mattt 版权所有</a><a href=https://autoptr.top/ title="Back to Home · 回首页">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>标签:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>分类:</span><li><a class=link href=https://autoptr.top/categories/Cocoa target=_blank>Cocoa</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>