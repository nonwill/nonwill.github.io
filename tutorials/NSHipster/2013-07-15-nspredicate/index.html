<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>NSPredicate</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="NSPredicate,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="NSPredicate,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"🌜"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>NSPredicate</span><span class=btRight><span title="Author · 作者" class=author>Mattt</span> <span title="Translator · 翻译" class=author>Zihan Xu</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post · 关联或转载引用的文章" target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics · 回主题页">&#127793;</a></span></h1><p><code>NSPredicate</code>是一个Foundation类，它指定数据被获取或者过滤的方式。它的查询语言就像SQL的<code>WHERE</code>和正则表达式的交叉一样，提供了具有表现力的，自然语言界面来定义一个集合被搜寻的逻辑条件。</p><p>相比较抽象的谈论它，展示<code>NSPredicate</code>的使用方法更加容易，所以我们来重新审视<a href=https://nshipster.com/nssortdescriptor/><code>NSSortDescriptor</code></a>中使用的示例数据集吧：</p><table><thead><tr><th><tt>索引</tt></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><td><tt>名</tt></td><td>Alice</td><td>Bob</td><td>Charlie</td><td>Quentin</td></tr><tr><td><tt>姓</tt></td><td>Smith</td><td>Jones</td><td>Smith</td><td>Alberts</td></tr><tr><td><tt>年龄</tt></td><td>24</td><td>27</td><td>33</td><td>31</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#66d9ef>@interface</span> <span style=color:#a6e22e>Person</span> : <span style=color:#a6e22e>NSObject</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@property</span> NSString <span style=color:#f92672>*</span>firstName;
</span></span><span style=display:flex><span><span style=color:#66d9ef>@property</span> NSString <span style=color:#f92672>*</span>lastName;
</span></span><span style=display:flex><span><span style=color:#66d9ef>@property</span> NSNumber <span style=color:#f92672>*</span>age;
</span></span><span style=display:flex><span><span style=color:#66d9ef>@end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@implementation</span> <span style=color:#a6e22e>Person</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- (NSString <span style=color:#f92672>*</span>)<span style=color:#a6e22e>description</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [NSString stringWithFormat:<span style=color:#e6db74>@&#34;%@ %@&#34;</span>, self.firstName, self.lastName];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#pragma mark -
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>NSArray <span style=color:#f92672>*</span>firstNames <span style=color:#f92672>=</span> <span style=color:#ae81ff>@[</span> <span style=color:#e6db74>@&#34;Alice&#34;</span>, <span style=color:#e6db74>@&#34;Bob&#34;</span>, <span style=color:#e6db74>@&#34;Charlie&#34;</span>, <span style=color:#e6db74>@&#34;Quentin&#34;</span> <span style=color:#ae81ff>]</span>;
</span></span><span style=display:flex><span>NSArray <span style=color:#f92672>*</span>lastNames <span style=color:#f92672>=</span> <span style=color:#ae81ff>@[</span> <span style=color:#e6db74>@&#34;Smith&#34;</span>, <span style=color:#e6db74>@&#34;Jones&#34;</span>, <span style=color:#e6db74>@&#34;Smith&#34;</span>, <span style=color:#e6db74>@&#34;Alberts&#34;</span> <span style=color:#ae81ff>]</span>;
</span></span><span style=display:flex><span>NSArray <span style=color:#f92672>*</span>ages <span style=color:#f92672>=</span> <span style=color:#ae81ff>@[</span> <span style=color:#ae81ff>@24</span>, <span style=color:#ae81ff>@27</span>, <span style=color:#ae81ff>@33</span>, <span style=color:#ae81ff>@31</span> <span style=color:#ae81ff>]</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSMutableArray <span style=color:#f92672>*</span>people <span style=color:#f92672>=</span> [NSMutableArray array];
</span></span><span style=display:flex><span>[firstNames enumerateObjectsUsingBlock:<span style=color:#f92672>^</span>(<span style=color:#66d9ef>id</span> obj, NSUInteger idx, <span style=color:#66d9ef>BOOL</span> <span style=color:#f92672>*</span>stop) {
</span></span><span style=display:flex><span>    Person <span style=color:#f92672>*</span>person <span style=color:#f92672>=</span> [[Person alloc] init];
</span></span><span style=display:flex><span>    person.firstName <span style=color:#f92672>=</span> firstNames[idx];
</span></span><span style=display:flex><span>    person.lastName <span style=color:#f92672>=</span> lastNames[idx];
</span></span><span style=display:flex><span>    person.age <span style=color:#f92672>=</span> ages[idx];
</span></span><span style=display:flex><span>    [people addObject:person];
</span></span><span style=display:flex><span>}];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSPredicate <span style=color:#f92672>*</span>bobPredicate <span style=color:#f92672>=</span> [NSPredicate predicateWithFormat:<span style=color:#e6db74>@&#34;firstName = &#39;Bob&#39;&#34;</span>];
</span></span><span style=display:flex><span>NSPredicate <span style=color:#f92672>*</span>smithPredicate <span style=color:#f92672>=</span> [NSPredicate predicateWithFormat:<span style=color:#e6db74>@&#34;lastName = %@&#34;</span>, <span style=color:#e6db74>@&#34;Smith&#34;</span>];
</span></span><span style=display:flex><span>NSPredicate <span style=color:#f92672>*</span>thirtiesPredicate <span style=color:#f92672>=</span> [NSPredicate predicateWithFormat:<span style=color:#e6db74>@&#34;age &gt;= 30&#34;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// [&#34;Bob Jones&#34;]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>NSLog(<span style=color:#e6db74>@&#34;Bobs: %@&#34;</span>, [people filteredArrayUsingPredicate:bobPredicate]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// [&#34;Alice Smith&#34;, &#34;Charlie Smith&#34;]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>NSLog(<span style=color:#e6db74>@&#34;Smiths: %@&#34;</span>, [people filteredArrayUsingPredicate:smithPredicate]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// [&#34;Charlie Smith&#34;, &#34;Quentin Alberts&#34;]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>NSLog(<span style=color:#e6db74>@&#34;30&#39;s: %@&#34;</span>, [people filteredArrayUsingPredicate:thirtiesPredicate]);
</span></span></code></pre></div><h2 id=集合中使用nspredicate>集合中使用<code>NSPredicate</code></h2><p>Foundation提供使用谓词（predicate）来过滤<code>NSArray</code>／<code>NSMutableArray</code>&<code>NSSet</code>／<code>NSMutableSet</code>的方法。</p><p>不可变的集合，<code>NSArray</code>&<code>NSSet</code>，有可以通过评估接收到的predicate来返回一个不可变集合的方法<code>filteredArrayUsingPredicate:</code>和<code>filteredSetUsingPredicate:</code>。</p><p>可变集合，<code>NSMutableArray</code>&<code>NSMutableSet</code>，可以使用方法<code>filterUsingPredicate:</code>，它可以通过运行接收到的谓词来移除评估结果为<code>FALSE</code>的对象。</p><p><code>NSDictionary</code>可以用谓词来过滤它的键和值（两者都为<code>NSArray</code>对象）。<code>NSOrderedSet</code>可以由过滤的<code>NSArray</code>或<code>NSSet</code>生成一个新的有序的集，或者<code>NSMutableSet</code>可以简单的<code>removeObjectsInArray:</code>，来传递通过_否定_predicate过滤的对象。</p><h2 id=core-data中使用nspredicate>Core Data中使用<code>NSPredicate</code></h2><p><code>NSFetchRequest</code>有一个<code>predicate</code>属性，它可以指定管理对象应该被获取的逻辑条件。谓词的使用规则在这里同样适用，唯一的区别在于，在管理对象环境中，谓词由持久化存储助理（persistent store coordinator）评估，而不像集合那样在内存中被过滤。</p><h2 id=谓词语法>谓词语法</h2><h3 id=替换>替换</h3><blockquote><ul><li><code>%@</code>是对值为字符串，数字或者日期的对象的替换值。</li><li><code>%K</code>是key path的替换值。</li></ul></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSPredicate <span style=color:#f92672>*</span>ageIs33Predicate <span style=color:#f92672>=</span> [NSPredicate predicateWithFormat:<span style=color:#e6db74>@&#34;%K = %@&#34;</span>, <span style=color:#e6db74>@&#34;age&#34;</span>, <span style=color:#ae81ff>@33</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// [&#34;Charlie Smith&#34;]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>NSLog(<span style=color:#e6db74>@&#34;Age 33: %@&#34;</span>, [people filteredArrayUsingPredicate:ageIs33Predicate]);
</span></span></code></pre></div><blockquote><ul><li><code>$VARIABLE_NAME</code>是可以被<code>NSPredicate -predicateWithSubstitutionVariables:</code>替换的值。</li></ul></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSPredicate <span style=color:#f92672>*</span>namesBeginningWithLetterPredicate <span style=color:#f92672>=</span> [NSPredicate predicateWithFormat:<span style=color:#e6db74>@&#34;(firstName BEGINSWITH[cd] $letter) OR (lastName BEGINSWITH[cd] $letter)&#34;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// [&#34;Alice Smith&#34;, &#34;Quentin Alberts&#34;]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>NSLog(<span style=color:#e6db74>@&#34;&#39;A&#39; Names: %@&#34;</span>, [people filteredArrayUsingPredicate:[namesBeginningWithLetterPredicate predicateWithSubstitutionVariables:<span style=color:#ae81ff>@{</span><span style=color:#e6db74>@&#34;letter&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>@&#34;A&#34;</span><span style=color:#ae81ff>}</span>]]);
</span></span></code></pre></div><h3 id=基本比较>基本比较</h3><blockquote><ul><li><code>=</code>, <code>==</code>：左边的表达式和右边的表达式相等。</li><li><code>>=</code>, <code>=></code>：左边的表达式大于或者等于右边的表达式。</li><li><code>&lt;=</code>, <code>=&lt;</code>：左边的表达式小于等于右边的表达式。</li><li><code>></code>：左边的表达式大于右边的表达式。</li><li><code>&lt;</code>：左边的表达式小于右边的表达式。</li><li><code>!=</code>, <code>&lt;></code>：左边的表达式不等于右边的表达式。</li><li><code>BETWEEN</code>：左边的表达式等于右边的表达式的值或者介于它们之间。右边是一个有两个指定上限和下限的数值的数列（指定顺序的数列）。比如，<code>1 BETWEEN { 0 , 33 }</code>，或者<code>$INPUT BETWEEN { $LOWER, $UPPER }</code>。</li></ul></blockquote><h3 id=基本复合谓词>基本复合谓词</h3><blockquote><ul><li><code>AND</code>, <code>&&</code>：逻辑<code>与</code>.</li><li><code>OR</code>, <code>||</code>：逻辑<code>或</code>.</li><li><code>NOT</code>, <code>!</code>：逻辑<code>非</code>.</li></ul></blockquote><h3 id=字符串比较>字符串比较</h3><blockquote><p>字符串比较在默认的情况下是区分大小写和音调的。你可以在方括号中用关键字符c和d来修改操作符以相应的指定不区分大小写和变音符号，比如firstname BEGINSWITH[cd] $FIRST_NAME。</p></blockquote><blockquote><ul><li><code>BEGINSWITH</code>：左边的表达式以右边的表达式作为开始。</li><li><code>CONTAINS</code>：左边的表达式包含右边的表达式。</li><li><code>ENDSWITH</code>：左边的表达式以右边的表达式作为结束。</li><li><code>LIKE</code>：左边的表达式等于右边的表达式：<code>?</code>和<code>*</code>可作为通配符，其中<code>?</code>匹配1个字符，<code>*</code>匹配0个或者多个字符。</li><li><code>MATCHES</code>：左边的表达式根据ICU v3（更多内容请查看<a href=http://userguide.icu-project.org/strings/regexp>ICU User Guide for Regular Expressions</a>）的regex风格比较，等于右边的表达式。</li></ul></blockquote><h3 id=合计操作>合计操作</h3><h4 id=关系操作>关系操作</h4><blockquote><ul><li><code>ANY</code>，<code>SOME</code>：指定下列表达式中的任意元素。比如，<code>ANY children.age &lt; 18</code>。</li><li><code>ALL</code>：指定下列表达式中的所有元素。比如，<code>ALL children.age &lt; 18</code>。</li><li><code>NONE</code>：指定下列表达式中没有的元素。比如，<code>NONE children.age &lt; 18</code>。它在逻辑上等于<code>NOT (ANY ...)</code>。</li><li><code>IN</code>：等于SQL的<code>IN</code>操作，左边的表达必须出现在右边指定的集合中。比如，<code>name IN { 'Ben', 'Melissa', 'Nick' }</code>。</li></ul></blockquote><h4 id=数组操作>数组操作</h4><blockquote><ul><li><code>array[index]</code>：指定<code>数组</code>中特定索引处的元素。</li><li><code>array[FIRST]</code>：指定<code>数组</code>中的第一个元素。</li><li><code>array[LAST]</code>：指定<code>数组</code>中的最后一个元素。</li><li><code>array[SIZE]</code>：指定<code>数组</code>的大小。</li></ul></blockquote><h3 id=布尔值谓词>布尔值谓词</h3><blockquote><ul><li><code>TRUEPREDICATE</code>：结果始终为<code>真</code>的谓词。</li><li><code>FALSEPREDICATE</code>：结果始终为<code>假</code>的谓词。</li></ul></blockquote><h2 id=nscompoundpredicate><code>NSCompoundPredicate</code></h2><p>我们见过<code>与</code>&<code>或</code>被用在谓词格式字符串中以创建复合谓词。然而，我们也可以用<code>NSCompoundPredicate</code>来完成同样的工作。</p><p>例如，下列谓词是相等的：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>[NSCompoundPredicate andPredicateWithSubpredicates:<span style=color:#ae81ff>@[</span>[NSPredicate predicateWithFormat:<span style=color:#e6db74>@&#34;age &gt; 25&#34;</span>], [NSPredicate predicateWithFormat:<span style=color:#e6db74>@&#34;firstName = %@&#34;</span>, <span style=color:#e6db74>@&#34;Quentin&#34;</span>]<span style=color:#ae81ff>]</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[NSPredicate predicateWithFormat:<span style=color:#e6db74>@&#34;(age &gt; 25) AND (firstName = %@)&#34;</span>, <span style=color:#e6db74>@&#34;Quentin&#34;</span>];
</span></span></code></pre></div><p>虽然语法字符串文字更加容易输入，但是在有的时候，你需要结合现有的谓词。在那些情况下，你可以使用<code>NSCompoundPredicate -andPredicateWithSubpredicates:</code>&<code>-orPredicateWithSubpredicates:</code>。</p><h2 id=nscomparisonpredicate><code>NSComparisonPredicate</code></h2><p>同样的，如果你在读过<a href=https://nshipster.com/nsexpression/>上周的文章</a>之后发现你使用了太多的<code>NSExpression</code>的话，<code>NSComparisonPredicate</code>可以帮助你解决这个问题。</p><p>就像<code>NSCompoundPredicate</code>一样，<code>NSComparisonPredicate</code>从子部件构建了一个<code>NSPredicate</code>－－在这种情况下，左侧和右侧都是<code>NSExpression</code>。
分析它的类的构造函数可以让我们一窥<code>NSPredicate</code>的格式字符串是如何解析的：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>+ (NSPredicate <span style=color:#f92672>*</span>)<span style=color:#a6e22e>predicateWithLeftExpression:</span>(NSExpression <span style=color:#f92672>*</span>)lhs
</span></span><span style=display:flex><span>							 <span style=color:#a6e22e>rightExpression:</span>(NSExpression <span style=color:#f92672>*</span>)rhs
</span></span><span style=display:flex><span>									<span style=color:#a6e22e>modifier:</span>(NSComparisonPredicateModifier)modifier
</span></span><span style=display:flex><span>										<span style=color:#a6e22e>type:</span>(NSPredicateOperatorType)type
</span></span><span style=display:flex><span>									 <span style=color:#a6e22e>options:</span>(NSUInteger)options
</span></span></code></pre></div><h4 id=参数>参数</h4><blockquote><ul><li><code>lhs</code>：左边的表达式。</li><li><code>rhs</code>：右边的表达式。</li><li><code>modifier</code>：应用的修改符。（<code>ANY</code>或者<code>ALL</code>）</li><li><code>type</code>：谓词运算符类型。</li><li><code>options</code>：要应用的选项。没有选项的话则为<code>0</code>。</li></ul></blockquote><h3 id=nscomparisonpredicate类型><code>NSComparisonPredicate</code>类型</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#66d9ef>enum</span> {
</span></span><span style=display:flex><span>   NSLessThanPredicateOperatorType <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>   NSLessThanOrEqualToPredicateOperatorType,
</span></span><span style=display:flex><span>   NSGreaterThanPredicateOperatorType,
</span></span><span style=display:flex><span>   NSGreaterThanOrEqualToPredicateOperatorType,
</span></span><span style=display:flex><span>   NSEqualToPredicateOperatorType,
</span></span><span style=display:flex><span>   NSNotEqualToPredicateOperatorType,
</span></span><span style=display:flex><span>   NSMatchesPredicateOperatorType,
</span></span><span style=display:flex><span>   NSLikePredicateOperatorType,
</span></span><span style=display:flex><span>   NSBeginsWithPredicateOperatorType,
</span></span><span style=display:flex><span>   NSEndsWithPredicateOperatorType,
</span></span><span style=display:flex><span>   NSInPredicateOperatorType,
</span></span><span style=display:flex><span>   NSCustomSelectorPredicateOperatorType,
</span></span><span style=display:flex><span>   NSContainsPredicateOperatorType,
</span></span><span style=display:flex><span>   NSBetweenPredicateOperatorType
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#66d9ef>typedef</span> NSUInteger NSPredicateOperatorType;
</span></span></code></pre></div><h3 id=nscomparisonpredicate选项><code>NSComparisonPredicate</code>选项</h3><blockquote><ul><li><code>NSCaseInsensitivePredicateOption</code>：不区分大小写的谓词。你通过在谓词格式字符串中加入后面带有[c]的字符串操作（比如，&ldquo;NeXT&rdquo; like[c] &ldquo;next&rdquo;）来表达这一选项。</li><li><code>NSDiacriticInsensitivePredicateOption</code>：忽视发音符号的谓词。你通过在谓词格式字符串中加入后面带有[d]的字符串操作（比如，&ldquo;naïve&rdquo; like[d] &ldquo;naive&rdquo;）来表达这一选项。</li><li><code>NSNormalizedPredicateOption</code>：表示待比较的字符串已经被预处理了。这一选项取代了NSCaseInsensitivePredicateOption和NSDiacriticInsensitivePredicateOption，旨在用作性能优化的选项。你可以通过在谓词格式字符串中加入后面带有[n]的字符串（比如，&ldquo;WXYZlan&rdquo; matches[n] &ldquo;.lan&rdquo;）来表达这一选项。</li><li><code>NSLocaleSensitivePredicateOption</code>：表明要使用<code>&lt;</code>，<code>&lt;=</code>，<code>=</code>，<code>=></code>，<code>></code> 作为比较的字符串应该使用区域识别的方式处理。你可以通过在<code>&lt;</code>，<code>&lt;=</code>，<code>=</code>，<code>=></code>，<code>></code>其中之一的操作符后加入[l]（比如，&ldquo;straße&rdquo; >[l] &ldquo;strasse&rdquo;）以便在谓词格式字符串表达这一选项。</li></ul></blockquote><h2 id=block谓词>Block谓词</h2><p>最后，如果你实在不愿意学习<code>NSPredicate</code>的格式语法，你也可以学学<code>NSPredicate +predicateWithBlock:</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSPredicate <span style=color:#f92672>*</span>shortNamePredicate <span style=color:#f92672>=</span> [NSPredicate predicateWithBlock:<span style=color:#f92672>^</span><span style=color:#66d9ef>BOOL</span>(<span style=color:#66d9ef>id</span> evaluatedObject, NSDictionary <span style=color:#f92672>*</span>bindings) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> [[evaluatedObject firstName] length] <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>        }];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// [&#34;Alice Smith&#34;, &#34;Bob Jones&#34;]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>NSLog(<span style=color:#e6db74>@&#34;Short Names: %@&#34;</span>, [people filteredArrayUsingPredicate:shortNamePredicate]);
</span></span></code></pre></div><p>&mldr;好吧，虽然使用<code>predicateWithBlock:</code>是懒人的做法，但它也并不是一无是处。</p><p>事实上，因为block可以封装任意的计算，所以有一个查询类是无法以<code>NSPredicate</code>格式字符串形式来表达的（比如对运行时被动态计算的值的评估）。而且当同一件事情可以用<code>NSExpression</code>结合自定义选择器来完成时，block为完成工作提供了一个方便的接口。</p><p>重要提示：<strong>由<code>predicateWithBlock:</code>生成的<code>NSPredicate</code>不能用于由<code>SQLite</code>存储库支持的Core Data数据的提取要求。</strong></p><hr><p>我知道我已经说过很多次了，可是<code>NSPredicate</code>真的是Cocoa的优势之一。其他语言的第三方库如果能有它一半的能力就已经很幸运了－－更别提标准库了。对于我们这些应用和框架开发者来说，有它作为标准组件使得我们在处理数据时有了很大的优势。</p><p>和<code>NSExpression</code>一样，<code>NSPredicate</code>一直在提醒我们Foundation有多么好：它不仅仅十分有用，它精致的构架和设计也是我们写代码时灵感的来源。</p><hr><p>除非<a href=https://nshipster.cn/ target=_blank>另有声明</a>，本文采用知识共享「<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>署名-非商业性使用 3.0 中国大陆</a>」许可协议授权。</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top · 回顶部" rel=nofollow>&#127772;2013-07-15 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2025 Mattt 版权所有</a><a href=https://autoptr.top/ title="Back to Home · 回首页">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>标签:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>分类:</span><li><a class=link href=https://autoptr.top/categories/Cocoa target=_blank>Cocoa</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>