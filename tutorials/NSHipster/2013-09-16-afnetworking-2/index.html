<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>AFNetworking 2.0</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="AFNetworking 2.0,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="AFNetworking 2.0,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"ğŸŒœ"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>AFNetworking 2.0</span><span class=btRight><span title="Author Â· ä½œè€…" class=author>Mattt</span> <span title="Translator Â· ç¿»è¯‘" class=author>Zihan Xu</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post Â· å…³è”æˆ–è½¬è½½å¼•ç”¨çš„æ–‡ç« " target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics Â· å›ä¸»é¢˜é¡µ">&#127793;</a></span></h1><p><a href=http://afnetworking.com>AFNetworking</a> æ˜¯å½“å‰ iOS å’Œ OS X
å¼€å‘ä¸­æœ€å¹¿æ³›ä½¿ç”¨çš„å¼€æºé¡¹ç›®ä¹‹ä¸€ã€‚å®ƒå¸®åŠ©äº†æˆåƒä¸Šä¸‡å«å¥½åˆå«åº§çš„åº”ç”¨ï¼Œä¹Ÿä¸ºå…¶å®ƒå‡ºè‰²çš„å¼€æºåº“æä¾›äº†åŸºç¡€ã€‚è¿™ä¸ªé¡¹ç›®æ˜¯ç¤¾åŒºé‡Œæœ€æ´»è·ƒã€æœ€æœ‰å½±å“åŠ›çš„é¡¹ç›®ä¹‹ä¸€ï¼Œæ‹¥æœ‰ 8700 ä¸ª starã€2200 ä¸ª fork å’Œ 130 åè´¡çŒ®è€…ã€‚</p><p>ä»å„æ–¹é¢æ¥çœ‹ï¼ŒAFNetworking å‡ ä¹å·²ç»æˆä¸ºä¸»æµã€‚</p><p><em>ä½†ä½ æœ‰æ²¡æœ‰å¬è¯´è¿‡å®ƒçš„æ–°ç‰ˆå‘¢ï¼Ÿ</em>
<a href=https://github.com/AFNetworking/AFNetworking/>AFNetworking 2.0</a>ã€‚</p><p>è¿™ä¸€å‘¨çš„ NSHipsterï¼šç‹¬å®¶æ­æ™“ AFNetworking çš„æœªæ¥ã€‚</p><blockquote><p>å£°æ˜ï¼šNSHipster ç”± <a href=https://twitter.com/mattt>AFNetworking çš„ä½œè€…</a> æ’°å†™ï¼Œæ‰€ä»¥è¿™å¹¶ä¸æ˜¯å¯¹ AFNetworking åŠå®ƒçš„ä¼˜ç‚¹çš„å®¢è§‚çœ‹æ³•ã€‚ä½ èƒ½çœ‹åˆ°çš„æ˜¯ä¸ªäººå…³äº AFNetworking ç›®å‰åŠæœªæ¥ç‰ˆæœ¬çš„çœŸå®çœ‹æ³•ã€‚</p></blockquote><h2 id=afnetworking-çš„å¤§ä½“æ€è·¯>AFNetworking çš„å¤§ä½“æ€è·¯</h2><p>å§‹äº 2011 å¹´ 5 æœˆï¼ŒAFNetworking ä½œä¸ºä¸€ä¸ª<a href=https://en.wikipedia.org/wiki/Gowalla>å·²æ­»çš„ LBS é¡¹ç›®</a>ä¸­å¯¹ <a href=https://developer.apple.com/library/ios/samplecode/mvcnetworking/Introduction/Intro.html>Apple èŒƒä¾‹ä»£ç </a>çš„å»¶ä¼¸ï¼Œå®ƒçš„æˆåŠŸæ›´æ˜¯ç”±äºæ—¶æœºã€‚å½¼æ—¶ <a href=https://github.com/pokeb/asi-http-request>ASIHTTPRequest</a> æ˜¯ç½‘ç»œæ–¹é¢çš„ä¸»æµæ–¹æ¡ˆï¼ŒAFNetworking çš„æ ¸å¿ƒæ€è·¯ä½¿å®ƒæ­£å¥½æˆä¸ºå¼€å‘è€…æ¸´æ±‚çš„æ›´ç°ä»£çš„æ–¹æ¡ˆã€‚</p><h3 id=nsurlconnection--nsoperation>NSURLConnection + NSOperation</h3><p><code>NSURLConnection</code> æ˜¯ Foundation URL åŠ è½½ç³»ç»Ÿçš„åŸºçŸ³ã€‚ä¸€ä¸ª <code>NSURLConnection</code> å¼‚æ­¥åœ°åŠ è½½ä¸€ä¸ª <code>NSURLRequest</code> å¯¹è±¡ï¼Œè°ƒç”¨ delegate çš„ <code>NSURLResponse</code> / <code>NSHTTPURLResponse</code> æ–¹æ³•ï¼Œå…¶ <code>NSData</code> è¢«å‘é€åˆ°æœåŠ¡å™¨æˆ–ä»æœåŠ¡å™¨è¯»å–ï¼›delegate è¿˜å¯ç”¨æ¥å¤„ç† <code>NSURLAuthenticationChallenge</code>ã€é‡å®šå‘å“åº”ã€æˆ–æ˜¯å†³å®š <code>NSCachedURLResponse</code> å¦‚ä½•å­˜å‚¨åœ¨å…±äº«çš„ <code>NSURLCache</code> ä¸Šã€‚</p><p><a href=https://nshipster.com/nsoperation><code>NSOperation</code></a> æ˜¯æŠ½è±¡ç±»ï¼Œæ¨¡æ‹Ÿå•ä¸ªè®¡ç®—å•å…ƒï¼Œæœ‰çŠ¶æ€ã€ä¼˜å…ˆçº§ã€ä¾èµ–ç­‰åŠŸèƒ½ï¼Œå¯ä»¥å–æ¶ˆã€‚</p><p>AFNetworking çš„ç¬¬ä¸€ä¸ªé‡å¤§çªç ´å°±æ˜¯å°†ä¸¤è€…ç»“åˆã€‚<code>AFURLConnectionOperation</code> ä½œä¸º <code>NSOperation</code> çš„å­ç±»ï¼Œéµå¾ª <code>NSURLConnectionDelegate</code> çš„æ–¹æ³•ï¼Œå¯ä»¥ä»å¤´åˆ°å°¾ç›‘è§†è¯·æ±‚çš„çŠ¶æ€ï¼Œå¹¶å‚¨å­˜è¯·æ±‚ã€å“åº”ã€å“åº”æ•°æ®ç­‰ä¸­é—´çŠ¶æ€ã€‚</p><h3 id=blocks>Blocks</h3><p>iOS 4 å¼•å…¥çš„ block å’Œ Grand Central Dispatch ä»æ ¹æœ¬ä¸Šæ”¹å–„äº†åº”ç”¨ç¨‹åºçš„å¼€å‘è¿‡ç¨‹ã€‚ç›¸æ¯”äºåœ¨åº”ç”¨ä¸­ç”¨ delegate ä¹±ä¸ƒå…«ç³Ÿåœ°å®ç°é€»è¾‘ï¼Œå¼€å‘è€…ä»¬å¯ä»¥ç”¨ block å°†ç›¸å…³çš„åŠŸèƒ½æ”¾åœ¨ä¸€èµ·ã€‚GCD èƒ½å¤Ÿè½»æ˜“æ¥å›è°ƒåº¦å·¥ä½œï¼Œä¸ç”¨é¢å¯¹ä¹±ä¸ƒå…«ç³Ÿçš„çº¿ç¨‹ã€è°ƒç”¨å’Œæ“ä½œé˜Ÿåˆ—ã€‚</p><p>æ›´é‡è¦çš„æ˜¯ï¼Œå¯¹äºæ¯ä¸ª request operationï¼Œå¯ä»¥é€šè¿‡ block è‡ªå®šä¹‰ <code>NSURLConnectionDelegate</code> çš„æ–¹æ³•ï¼ˆæ¯”å¦‚ï¼Œé€šè¿‡ <code>setWillSendRequestForAuthenticationChallengeBlock:</code> å¯ä»¥è¦†ç›–é»˜è®¤çš„ <code>connection:willSendRequestForAuthenticationChallenge:</code> æ–¹æ³•ï¼‰ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»º <code>AFURLConnectionOperation</code> å¹¶æŠŠå®ƒå®‰æ’è¿› <code>NSOperationQueue</code>ï¼Œé€šè¿‡è®¾ç½® <code>NSOperation</code> çš„æ–°å±æ€§ <code>completionBlock</code>ï¼ŒæŒ‡å®šæ“ä½œå®Œæˆæ—¶å¦‚ä½•å¤„ç† response å’Œ response dataï¼ˆæˆ–æ˜¯è¯·æ±‚è¿‡ç¨‹ä¸­é‡åˆ°çš„é”™è¯¯ï¼‰ã€‚</p><h3 id=åºåˆ—åŒ–--éªŒè¯>åºåˆ—åŒ– & éªŒè¯</h3><p>æ›´æ·±å…¥ä¸€äº›ï¼Œrequest operation æ“ä½œä¹Ÿå¯ä»¥è´Ÿè´£éªŒè¯ HTTP çŠ¶æ€ç å’ŒæœåŠ¡å™¨å“åº”çš„å†…å®¹ç±»å‹ï¼Œæ¯”å¦‚ï¼Œå¯¹äº <code>application/json</code> MIME ç±»å‹çš„å“åº”ï¼Œå¯ä»¥å°† NSData åºåˆ—åŒ–ä¸º JSON å¯¹è±¡ã€‚</p><p>ä»æœåŠ¡å™¨åŠ è½½ JSONã€XMLã€property list æˆ–è€…å›¾åƒå¯ä»¥æŠ½è±¡å¹¶ç±»æ¯”æˆæ½œåœ¨çš„æ–‡ä»¶åŠ è½½æ“ä½œï¼Œè¿™æ ·å¼€å‘è€…å¯ä»¥å°†è¿™ä¸ªè¿‡ç¨‹æƒ³è±¡æˆä¸€ä¸ª promise è€Œä¸æ˜¯å¼‚æ­¥ç½‘ç»œè¿æ¥ã€‚</p><h2 id=ä»‹ç»-afnetworking-20>ä»‹ç» AFNetworking 2.0</h2><p>AFNetworking èƒœåœ¨æ˜“äºä½¿ç”¨å’Œå¯æ‰©å±•ä¹‹é—´å–å¾—çš„å¹³è¡¡ï¼Œä½†ä¹Ÿå¹¶ä¸æ˜¯æ²¡æœ‰æå‡çš„ç©ºé—´ã€‚</p><p>åœ¨ç¬¬äºŒä¸ªå¤§ç‰ˆæœ¬ä¸­ï¼ŒAFNetworking æ—¨åœ¨æ¶ˆé™¤åŸæœ‰è®¾è®¡çš„æ€ªå¼‚ä¹‹å¤„ï¼ŒåŒæ—¶ä¸ºä¸‹ä¸€ä»£ iOS å’Œ OS X åº”ç”¨ç¨‹åºå¢åŠ ä¸€äº›å¼ºå¤§çš„æ–°æ¶æ„ã€‚</p><h3 id=åŠ¨æœº>åŠ¨æœº</h3><ul><li><p><strong>å…¼å®¹ NSURLSession</strong> - <code>NSURLSession</code> æ˜¯ iOS 7 æ–°å¼•å…¥çš„ç”¨äºæ›¿ä»£ <code>NSURLConnection</code> çš„ç±»ã€‚<code>NSURLConnection</code> å¹¶æ²¡æœ‰è¢«å¼ƒç”¨ï¼Œä»Šåä¸€æ®µæ—¶é—´åº”è¯¥ä¹Ÿä¸ä¼šï¼Œä½†æ˜¯ <code>NSURLSession</code> æ˜¯ Foundation ä¸­ç½‘ç»œçš„æœªæ¥ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªç¾å¥½çš„æœªæ¥ï¼Œå› ä¸ºå®ƒæ”¹è¿›äº†ä¹‹å‰çš„å¾ˆå¤šç¼ºç‚¹ã€‚ï¼ˆå‚è€ƒ WWDC 2013 Session 705 â€œWhatâ€™s New in Foundation Networkingâ€ï¼Œä¸€ä¸ªå¾ˆå¥½çš„æ¦‚è¿°ï¼‰ã€‚èµ·åˆæœ‰äººæ¨æµ‹ï¼Œ<code>NSURLSession</code> çš„å‡ºç°å°†ä½¿ AFNetworking ä¸å†æœ‰ç”¨ã€‚ä½†å®é™…ä¸Šï¼Œè™½ç„¶å®ƒä»¬æœ‰ä¸€äº›é‡å ï¼ŒAFNetworking è¿˜æ˜¯å¯ä»¥æä¾›æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ã€‚<strong>AFNetworking 2.0 ä¸ä»…åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Œè¿˜å€ŸåŠ©å¹¶æ‰©å±• <code>NSURLSession</code> æ¥é“ºå¹³é“è·¯ä¸Šçš„å‘æ´¼ï¼Œå¹¶æœ€å¤§ç¨‹åº¦æ‰©å±•äº†å®ƒçš„å®ç”¨æ€§ã€‚</strong></p></li><li><p><strong>æ¨¡å—åŒ–</strong> - å¯¹äº AFNetworking çš„ä¸»è¦æ‰¹è¯„ä¹‹ä¸€æ˜¯ç¬¨é‡ã€‚è™½ç„¶å®ƒçš„æ„æ¶ä½¿åœ¨ç±»çš„å±‚é¢ä¸Šæ˜¯æ¨¡å—åŒ–çš„ï¼Œä½†å®ƒçš„åŒ…è£…å¹¶ä¸å…è®¸é€‰æ‹©ç‹¬ç«‹çš„ä¸€äº›åŠŸèƒ½ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œ<code>AFHTTPClient</code> å°¤å…¶å˜å¾—ä¸å ªé‡è´Ÿï¼ˆå…¶ä»»åŠ¡åŒ…æ‹¬åˆ›å»ºè¯·æ±‚ã€åºåˆ—åŒ– query string å‚æ•°ã€ç¡®å®šå“åº”è§£æè¡Œä¸ºã€ç”Ÿæˆå’Œç®¡ç† operationã€ç›‘è§†ç½‘ç»œå¯è¾¾æ€§ï¼‰ã€‚ <strong>åœ¨ AFNetworking 2.0 ä¸­ï¼Œä½ å¯ä»¥æŒ‘é€‰å¹¶é€šè¿‡ <a href=https://github.com/CocoaPods/CocoaPods/wiki/The-podspec-format#subspecs>CocoaPods subspecs</a> é€‰æ‹©ä½ æ‰€éœ€è¦çš„ç»„ä»¶ã€‚</strong></p></li></ul><h3 id=æ¼”å‘˜é˜µå®¹>æ¼”å‘˜é˜µå®¹</h3><h4 id=nsurlconnection-ç»„ä»¶-_ios-6--7_><code>NSURLConnection</code> ç»„ä»¶ <em>(iOS 6 & 7)</em></h4><ul><li><code>AFURLConnectionOperation</code> - <code>NSOperation</code> çš„å­ç±»ï¼Œè´Ÿè´£ç®¡ç† <code>NSURLConnection</code> å¹¶ä¸”å®ç°å…¶ delegate æ–¹æ³•ã€‚</li><li><code>AFHTTPRequestOperation</code> - <code>AFURLConnectionOperation</code> çš„å­ç±»ï¼Œç”¨äºç”Ÿæˆ HTTP è¯·æ±‚ï¼Œå¯ä»¥åŒºåˆ«å¯æ¥å—çš„å’Œä¸å¯æ¥å—çš„çŠ¶æ€ç åŠå†…å®¹ç±»å‹ã€‚2.0 ç‰ˆæœ¬ä¸­çš„æœ€å¤§åŒºåˆ«æ˜¯ï¼Œ<strong>ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»ï¼Œè€Œä¸ç”¨ç»§æ‰¿å®ƒ</strong>ï¼ŒåŸå› å¯ä»¥åœ¨â€œåºåˆ—åŒ–â€ä¸€èŠ‚ä¸­æ‰¾åˆ°ã€‚</li><li><code>AFHTTPRequestOperationManager</code> - åŒ…è£…å¸¸è§ HTTP web æœåŠ¡æ“ä½œçš„ç±»ï¼Œé€šè¿‡ <code>AFHTTPRequestOperation</code> ç”± <code>NSURLConnection</code> æ”¯æŒã€‚</li></ul><h4 id=nsurlsession-ç»„ä»¶-_ios-7_><code>NSURLSession</code> ç»„ä»¶ <em>(iOS 7)</em></h4><ul><li><code>AFURLSessionManager</code> - åˆ›å»ºã€ç®¡ç†åŸºäº <code>NSURLSessionConfiguration</code> å¯¹è±¡çš„ <code>NSURLSession</code> å¯¹è±¡çš„ç±»ï¼Œä¹Ÿå¯ä»¥ç®¡ç† session çš„æ•°æ®ã€ä¸‹è½½/ä¸Šä¼ ä»»åŠ¡ï¼Œå®ç° session å’Œå…¶ç›¸å…³è”çš„ä»»åŠ¡çš„ delegate æ–¹æ³•ã€‚å› ä¸º <code>NSURLSession</code> API è®¾è®¡ä¸­å¥‡æ€ªçš„ç©ºç¼ºï¼Œ<strong>ä»»ä½•å’Œ <code>NSURLSession</code> ç›¸å…³çš„ä»£ç éƒ½å¯ä»¥ç”¨ <code>AFURLSessionManager</code> æ”¹å–„</strong>ã€‚</li><li><code>AFHTTPSessionManager</code> - <code>AFURLSessionManager</code> çš„å­ç±»ï¼ŒåŒ…è£…å¸¸è§çš„ HTTP web æœåŠ¡æ“ä½œï¼Œé€šè¿‡ <code>AFURLSessionManager</code> ç”± <code>NSURLSession</code> æ”¯æŒã€‚</li></ul><hr><blockquote><p><strong>æ€»çš„æ¥è¯´</strong>ï¼šä¸ºäº†æ”¯æŒæ–°çš„ <code>NSURLSession</code> API ä»¥åŠæ—§çš„æœªå¼ƒç”¨ä¸”è¿˜æœ‰ç”¨çš„ <code>NSURLConnection</code>ï¼ŒAFNetworking 2.0 çš„æ ¸å¿ƒç»„ä»¶åˆ†æˆäº† request operation å’Œ session ä»»åŠ¡ã€‚<code>AFHTTPRequestOperationManager</code> å’Œ <code>AFHTTPSessionManager</code> æä¾›ç±»ä¼¼çš„åŠŸèƒ½ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ï¼ˆæ¯”å¦‚åœ¨ iOS 6 å’Œ 7 ä¹‹é—´è½¬æ¢ï¼‰ï¼Œå®ƒä»¬çš„æ¥å£å¯ä»¥ç›¸å¯¹å®¹æ˜“çš„äº’æ¢ã€‚</p></blockquote><blockquote><p>ä¹‹å‰æ‰€æœ‰ç»‘å®šåœ¨ <code>AFHTTPClient</code>çš„åŠŸèƒ½ï¼Œæ¯”å¦‚åºåˆ—åŒ–ã€å®‰å…¨æ€§ã€å¯è¾¾æ€§ï¼Œè¢«æ‹†åˆ†æˆå‡ ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼Œå¯è¢«åŸºäº <code>NSURLSession</code> å’Œ <code>NSURLConnection</code> çš„ API ä½¿ç”¨ã€‚</p></blockquote><hr><h4 id=åºåˆ—åŒ–>åºåˆ—åŒ–</h4><p>AFNetworking 2.0 æ–°æ„æ¶çš„çªç ´ä¹‹ä¸€æ˜¯ä½¿ç”¨åºåˆ—åŒ–æ¥åˆ›å»ºè¯·æ±‚ã€è§£æå“åº”ã€‚å¯ä»¥é€šè¿‡åºåˆ—åŒ–çš„çµæ´»è®¾è®¡å°†æ›´å¤šä¸šåŠ¡é€»è¾‘è½¬ç§»åˆ°ç½‘ç»œå±‚ï¼Œå¹¶æ›´å®¹æ˜“å®šåˆ¶ä¹‹å‰å†…ç½®çš„é»˜è®¤è¡Œä¸ºã€‚</p><ul><li><p><code>&lt;AFURLRequestSerializer></code> - ç¬¦åˆè¿™ä¸ªåè®®çš„å¯¹è±¡ç”¨äºå¤„ç†è¯·æ±‚ï¼Œå®ƒå°†è¯·æ±‚å‚æ•°è½¬æ¢ä¸º query string æˆ–æ˜¯ entity body çš„å½¢å¼ï¼Œå¹¶è®¾ç½®å¿…è¦çš„ headerã€‚é‚£äº›ä¸å–œæ¬¢ <code>AFHTTPClient</code> ä½¿ç”¨ query string ç¼–ç å‚æ•°çš„å®¶ä¼™ï¼Œä½ ä»¬ä¸€å®šå–œæ¬¢è¿™ä¸ªã€‚</p></li><li><p><code>&lt;AFURLResponseSerializer></code> - ç¬¦åˆè¿™ä¸ªåè®®çš„å¯¹è±¡ç”¨äºéªŒè¯ã€åºåˆ—åŒ–å“åº”åŠç›¸å…³æ•°æ®ï¼Œè½¬æ¢ä¸ºæœ‰ç”¨çš„å½¢å¼ï¼Œæ¯”å¦‚ JSON å¯¹è±¡ã€å›¾åƒã€ç”šè‡³åŸºäº <a href=https://github.com/blog/1299-mantle-a-model-framework-for-objective-c>Mantle</a> çš„æ¨¡å‹å¯¹è±¡ã€‚ç›¸æ¯”æ²¡å®Œæ²¡äº†åœ°ç»§æ‰¿ <code>AFHTTPClient</code>ï¼Œç°åœ¨ <code>AFHTTPRequestOperation</code> æœ‰ä¸€ä¸ª <code>responseSerializer</code> å±æ€§ï¼Œç”¨äºè®¾ç½®åˆé€‚çš„ handlerã€‚åŒæ ·çš„ï¼Œå†ä¹Ÿæ²¡æœ‰<a href=http://cocoadocs.org/docsets/AFNetworking/1.3.1/Classes/AFHTTPClient.html#//api/name/registerHTTPOperationClass:>æ²¡ç”¨çš„å— <code>NSURLProtocol</code> å¯å‘çš„ request operation ç±»æ³¨å†Œ</a>ï¼Œå–è€Œä»£ä¹‹çš„è¿˜æ˜¯å¾ˆæ£’çš„ <code>responseSerializer</code> å±æ€§ã€‚è°¢å¤©è°¢åœ°ã€‚</p></li></ul><h4 id=å®‰å…¨æ€§>å®‰å…¨æ€§</h4><p>æ„Ÿè°¢ <a href=https://github.com/dstnbrkr>Dustin Barker</a>ã€<a href=https://github.com/OliverLetterer>Oliver Letterer</a>ã€<a href=https://github.com/kcharwood>Kevin Harwood</a> ç­‰äººåšå‡ºçš„è´¡çŒ®ï¼ŒAFNetworking ç°åœ¨å¸¦æœ‰å†…ç½®çš„ <a href=http://blog.lumberlabs.com/2012/04/why-app-developers-should-care-about.html>SSL pinning</a> æ”¯æŒï¼Œè¿™å¯¹äºå¤„ç†æ•æ„Ÿä¿¡æ¯çš„åº”ç”¨æ˜¯ååˆ†é‡è¦çš„ã€‚</p><ul><li><code>AFSecurityPolicy</code> - è¯„ä¼°æœåŠ¡å™¨å¯¹å®‰å…¨è¿æ¥é’ˆå¯¹æŒ‡å®šçš„å›ºå®šè¯ä¹¦æˆ–å…¬å…±å¯†é’¥çš„ä¿¡ä»»ã€‚tl;dr å°†ä½ çš„æœåŠ¡å™¨è¯ä¹¦æ·»åŠ åˆ° app bundleï¼Œä»¥å¸®åŠ©é˜²æ­¢ <a href=https://en.wikipedia.org/wiki/Man-in-the-middle_attack>ä¸­é—´äººæ”»å‡»</a>ã€‚</li></ul><h4 id=å¯è¾¾æ€§>å¯è¾¾æ€§</h4><p>ä» <code>AFHTTPClient</code> è§£è—•çš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯ç½‘ç»œå¯è¾¾æ€§ã€‚ç°åœ¨ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒï¼Œæˆ–è€…ä½¿ç”¨ <code>AFHTTPRequestOperationManager</code> / <code>AFHTTPSessionManager</code> çš„å±æ€§ã€‚</p><ul><li><code>AFNetworkReachabilityManager</code> - è¿™ä¸ªç±»ç›‘æ§å½“å‰ç½‘ç»œçš„å¯è¾¾æ€§ï¼Œæä¾›å›è°ƒ block å’Œ notificaitonï¼Œåœ¨å¯è¾¾æ€§å˜åŒ–æ—¶è°ƒç”¨ã€‚</li></ul><h4 id=å®æ—¶æ€§>å®æ—¶æ€§</h4><ul><li><code>AFEventSource</code> - <a href=https://en.wikipedia.org/wiki/Server-sent_events><code>EventSource</code> DOM API</a> çš„ Objective-C å®ç°ã€‚å»ºç«‹ä¸€ä¸ªåˆ°æŸä¸»æœºçš„æŒä¹… HTTP è¿æ¥ï¼Œå¯ä»¥å°†äº‹ä»¶ä¼ è¾“åˆ°äº‹ä»¶æºå¹¶æ´¾å‘åˆ°å¬ä¼—ã€‚ä¼ è¾“åˆ°äº‹ä»¶æºçš„æ¶ˆæ¯çš„æ ¼å¼ä¸º <a href=http://tools.ietf.org/html/rfc6902>JSON Patch</a> æ–‡ä»¶ï¼Œå¹¶è¢«ç¿»è¯‘æˆ <code>AFJSONPatchOperation</code> å¯¹è±¡çš„æ•°ç»„ã€‚å¯ä»¥å°†è¿™äº› patch operation åº”ç”¨åˆ°ä¹‹å‰ä»æœåŠ¡å™¨è·å–çš„æŒä¹…æ€§æ•°æ®é›†ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSURL <span style=color:#f92672>*</span>URL <span style=color:#f92672>=</span> [NSURL URLWithString:<span style=color:#e6db74>@&#34;http://example.com&#34;</span>];
</span></span><span style=display:flex><span>AFHTTPSessionManager <span style=color:#f92672>*</span>manager <span style=color:#f92672>=</span> [[AFHTTPSessionManager alloc] initWithBaseURL:URL];
</span></span><span style=display:flex><span>[manager GET:<span style=color:#e6db74>@&#34;/resources&#34;</span> parameters:nil success:<span style=color:#f92672>^</span>(NSURLSessionDataTask <span style=color:#f92672>*</span>task, <span style=color:#66d9ef>id</span> responseObject) {
</span></span><span style=display:flex><span>    [resources addObjectsFromArray:responseObject[<span style=color:#e6db74>@&#34;resources&#34;</span>]];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    [manager SUBSCRIBE:<span style=color:#e6db74>@&#34;/resources&#34;</span> usingBlock:<span style=color:#f92672>^</span>(NSArray <span style=color:#f92672>*</span>operations, NSError <span style=color:#f92672>*</span>error) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (AFJSONPatchOperation <span style=color:#f92672>*</span>operation <span style=color:#66d9ef>in</span> operations) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>switch</span> (operation.type) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> AFJSONAddOperationType:
</span></span><span style=display:flex><span>                    [resources addObject:operation.value];
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    } error:nil];
</span></span><span style=display:flex><span>} failure:nil];
</span></span></code></pre></div><h4 id=uikit-æ‰©å±•>UIKit æ‰©å±•</h4><p>ä¹‹å‰ AFNetworking ä¸­çš„æ‰€æœ‰ UIKit category éƒ½è¢«ä¿ç•™å¹¶å¢å¼ºï¼Œè¿˜å¢åŠ äº†ä¸€äº›æ–°çš„ categoryã€‚</p><ul><li><code>AFNetworkActivityIndicatorManager</code>ï¼šåœ¨è¯·æ±‚æ“ä½œå¼€å§‹ã€åœæ­¢åŠ è½½æ—¶ï¼Œè‡ªåŠ¨å¼€å§‹ã€åœæ­¢çŠ¶æ€æ ä¸Šçš„ç½‘ç»œæ´»åŠ¨æŒ‡ç¤ºå›¾æ ‡ã€‚</li><li><code>UIImageView+AFNetworking</code>ï¼šå¢åŠ äº† <code>imageResponseSerializer</code> å±æ€§ï¼Œå¯ä»¥è½»æ¾åœ°è®©è¿œç¨‹åŠ è½½åˆ° image view ä¸Šçš„å›¾åƒè‡ªåŠ¨è°ƒæ•´å¤§å°æˆ–åº”ç”¨æ»¤é•œã€‚æ¯”å¦‚ï¼Œ<a href=https://github.com/AFNetworking/AFCoreImageSerializer><code>AFCoreImageSerializer</code></a> å¯ä»¥åœ¨ response çš„å›¾åƒæ˜¾ç¤ºä¹‹å‰åº”ç”¨ Core Image filterã€‚</li><li><code>UIButton+AFNetworking</code> <em>(æ–°)</em>ï¼šä¸ <code>UIImageView+AFNetworking</code> ç±»ä¼¼ï¼Œä»è¿œç¨‹èµ„æºåŠ è½½ <code>image</code> å’Œ <code>backgroundImage</code>ã€‚</li><li><code>UIActivityIndicatorView+AFNetworking</code> <em>(æ–°)</em>ï¼šæ ¹æ®æŒ‡å®šçš„è¯·æ±‚æ“ä½œå’Œä¼šè¯ä»»åŠ¡çš„çŠ¶æ€è‡ªåŠ¨å¼€å§‹ã€åœæ­¢ <code>UIActivityIndicatorView</code>ã€‚</li><li><code>UIProgressView+AFNetworking</code> <em>(æ–°)</em>ï¼šè‡ªåŠ¨è·Ÿè¸ªæŸä¸ªè¯·æ±‚æˆ–ä¼šè¯ä»»åŠ¡çš„ä¸Šä¼ /ä¸‹è½½è¿›åº¦ã€‚</li><li><code>UIWebView+AFNetworking</code> <em>(æ–°)</em>: ä¸ºåŠ è½½ URL è¯·æ±‚æä¾›äº†æ›´å¼ºå¤§çš„ APIï¼Œæ”¯æŒè¿›åº¦å›è°ƒå’Œå†…å®¹è½¬æ¢ã€‚</li></ul><hr><p>äºæ˜¯ç»ˆäºè¦ç»“æŸ AFNetworking æ—‹é£ä¹‹æ—…äº†ã€‚ä¸ºä¸‹ä¸€ä»£åº”ç”¨è®¾è®¡çš„æ–°åŠŸèƒ½ï¼Œç»“åˆä¸ºå·²æœ‰åŠŸèƒ½è®¾è®¡çš„å…¨æ–°æ¶æ„ï¼Œæœ‰å¾ˆå¤šä¸œè¥¿å€¼å¾—å…´å¥‹ã€‚</p><h3 id=æ——å¼€å¾—èƒœ>æ——å¼€å¾—èƒœ</h3><p>å°†ä¸‹åˆ—ä»£ç åŠ å…¥ <a href=http://cocoapods.org><code>Podfile</code></a> å°±å¯ä»¥å¼€å§‹æŠŠç© AFNetworking 2.0 äº†ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span>platform <span style=color:#e6db74>:ios</span>, <span style=color:#e6db74>&#39;7.0&#39;</span>
</span></span><span style=display:flex><span>pod <span style=color:#e6db74>&#34;AFNetworking&#34;</span>, <span style=color:#e6db74>&#34;2.0.0&#34;</span>
</span></span></code></pre></div><p>For anyone coming over to AFNetworking from the current 1.x release, you may find <a href=https://github.com/AFNetworking/AFNetworking/wiki/AFNetworking-2.0-Migration-Guide>the AFNetworking 2.0 Migration Guide</a> especially useful.</p><p>å¯¹äºç”± AFNetworking 1.x ç‰ˆæœ¬è½¬ç§»åˆ°æ–°ç‰ˆæœ¬çš„ç”¨æˆ·ï¼Œä½ å¯ä»¥æ‰¾åˆ° <a href=https://github.com/AFNetworking/AFNetworking/wiki/AFNetworking-2.0-Migration-Guide>AFNetworking 2.0 è¿ç§»æŒ‡å—</a>ã€‚</p><p>å¦‚æœä½ é‡åˆ° bug æˆ–è€…å…¶å®ƒçš„å¥‡æ€ªçš„åœ°æ–¹ï¼Œè¯·é€šè¿‡<a href="https://github.com/afnetworking/afnetworking/issues?state=open">åœ¨ GitHub å¼€å¯ä¸€ä¸ªé—®é¢˜</a>æ¥å¸®åŠ©æˆ‘ä»¬æ”¹è¿›ã€‚éå¸¸æ„Ÿè°¢æ‚¨çš„å¸®åŠ©ã€‚</p><p>å¯¹äºä¸€èˆ¬çš„ä½¿ç”¨é—®é¢˜ï¼Œè¯·éšæ—¶ tweet æˆ‘ <a href=https://twitter.com/AFNetworking>@AFNetworking</a>ï¼Œæˆ–è€…ç»™æˆ‘å‘é‚®ä»¶ã€‚</p><hr><p>é™¤é<a href=https://nshipster.cn/ target=_blank>å¦æœ‰å£°æ˜</a>ï¼Œæœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ã€Œ<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 3.0 ä¸­å›½å¤§é™†</a>ã€è®¸å¯åè®®æˆæƒã€‚</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top Â· å›é¡¶éƒ¨" rel=nofollow>&#127772;2013-09-16 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2026 Mattt ç‰ˆæƒæ‰€æœ‰</a><a href=https://autoptr.top/ title="Back to Home Â· å›é¦–é¡µ">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>æ ‡ç­¾:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>åˆ†ç±»:</span><li><a class=link href=https://autoptr.top/categories/Open%20Source target=_blank>Open Source</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>