<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>JavaScriptCore</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="JavaScriptCore,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="JavaScriptCore,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"ğŸŒœ"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>JavaScriptCore</span><span class=btRight><span title="Author Â· ä½œè€…" class=author>Nate Cook</span> <span title="Translator Â· ç¿»è¯‘" class=author>April Peng</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post Â· å…³è”æˆ–è½¬è½½å¼•ç”¨çš„æ–‡ç« " target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics Â· å›ä¸»é¢˜é¡µ">&#127793;</a></span></h1><p><a href=http://redmonk.com/sogrady/category/programming-languages/>è¿™ä¸ªæ˜ŸæœŸ</a>æµè¡Œç¼–ç¨‹è¯­è¨€çš„æœ€æ–°æ’åç»“æœæ˜¯ï¼ŒSwift è¿…é€Ÿä»ç¬¬ 68 ä½è·ƒå‡åˆ° 22 ä½ï¼Œè€Œ Objective-C ä»ç„¶ç¨³å›ºçš„å æ®åœ¨ç¬¬ 10 ä½ã€‚ä½†æ˜¯ï¼Œè¯´åˆ°å…è®¸åœ¨ iOS ä¸Šè¿è¡Œçš„å…¶ä»–è¯­è¨€ ä¸Šï¼Œè¿™ä¸¤ä¸ªéƒ½è¢«ç”©çš„å¾ˆè¿œï¼šå½“å‰çš„å† å†›æ˜¯ JavaScriptã€‚</p><p>OS X Mavericks å’Œ iOS 7 å¼•å…¥äº† JavaScriptCore åº“ï¼Œå®ƒæŠŠ WebKit çš„ JavaScript å¼•æ“ç”¨ Objective-C å°è£…ï¼Œæä¾›äº†ç®€å•ï¼Œå¿«é€Ÿä»¥åŠå®‰å…¨çš„æ–¹å¼æ¥å…¥ä¸–ç•Œä¸Šæœ€æµè¡Œçš„è¯­è¨€ã€‚ä¸ç®¡ä½ çˆ±å®ƒè¿˜æ˜¯æ¨å®ƒï¼ŒJavaScript çš„æ™®éå­˜åœ¨ä½¿å¾—ç¨‹åºå‘˜ã€å·¥å…·ä»¥åŠèåˆåˆ° OS X å’Œ iOS é‡Œè¿™æ ·è¶…å¿«çš„è™šæ‹Ÿæœºä¸­èµ„æºçš„ä½¿ç”¨éƒ½å¤§å¹…å¢é•¿ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œå…ˆæŠ›å¼€åŠ¨æ€å’Œç±»å‹å®‰å…¨çš„ç—›è‹¦è¾©è®ºï¼Œè®©æˆ‘å¸¦ä½ ä¸€èµ·æ¥åšä¸€ä¸ª <em>JavaScriptCore çš„è§‚å…‰ã€‚</em></p><hr><h3 id=jscontext--jsvalue><code>JSContext</code> / <code>JSValue</code></h3><p><code>JSContext</code> æ˜¯è¿è¡Œ JavaScript ä»£ç çš„ç¯å¢ƒã€‚ä¸€ä¸ª <code>JSContext</code> æ˜¯ä¸€ä¸ªå…¨å±€ç¯å¢ƒçš„å®ä¾‹ï¼Œå¦‚æœä½ å†™è¿‡ä¸€ä¸ªåœ¨æµè§ˆå™¨å†…è¿è¡Œçš„ JavaScriptï¼Œ<code>JSContext</code> ç±»ä¼¼äº <code>window</code>ã€‚åˆ›å»ºä¸€ä¸ª <code>JSContext</code> åï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°è¿è¡Œ JavaScript ä»£ç æ¥åˆ›å»ºå˜é‡ï¼Œåšè®¡ç®—ï¼Œç”šè‡³å®šä¹‰æ–¹æ³•ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> context = JSContext()
</span></span><span style=display:flex><span>context.evaluateScript(<span style=color:#e6db74>&#34;var num = 5 + 5&#34;</span>)
</span></span><span style=display:flex><span>context.evaluateScript(<span style=color:#e6db74>&#34;var names = [&#39;Grace&#39;, &#39;Ada&#39;, &#39;Margaret&#39;]&#34;</span>)
</span></span><span style=display:flex><span>context.evaluateScript(<span style=color:#e6db74>&#34;var triple = function(value) { return value * 3 }&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> tripleNum: JSValue = context.evaluateScript(<span style=color:#e6db74>&#34;triple(num)&#34;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>JSContext <span style=color:#f92672>*</span>context <span style=color:#f92672>=</span> [[JSContext alloc] init];
</span></span><span style=display:flex><span>[context evaluateScript:<span style=color:#e6db74>@&#34;var num = 5 + 5&#34;</span>];
</span></span><span style=display:flex><span>[context evaluateScript:<span style=color:#e6db74>@&#34;var names = [&#39;Grace&#39;, &#39;Ada&#39;, &#39;Margaret&#39;]&#34;</span>];
</span></span><span style=display:flex><span>[context evaluateScript:<span style=color:#e6db74>@&#34;var triple = function(value) { return value * 3 }&#34;</span>];
</span></span><span style=display:flex><span>JSValue <span style=color:#f92672>*</span>tripleNum <span style=color:#f92672>=</span> [context evaluateScript:<span style=color:#e6db74>@&#34;triple(num)&#34;</span>];
</span></span></code></pre></div><p>ä»£ç çš„æœ€åä¸€è¡Œï¼Œä»»ä½•<em>å‡ºè‡ª</em> <code>JSContext</code> çš„å€¼éƒ½è¢«åŒ…è£¹åœ¨ä¸€ä¸ª <code>JSValue</code> å¯¹è±¡ä¸­ã€‚åƒ JavaScript è¿™æ ·çš„åŠ¨æ€è¯­è¨€éœ€è¦ä¸€ä¸ªåŠ¨æ€ç±»å‹ï¼Œæ‰€ä»¥ <code>JSValue</code> åŒ…è£…äº†æ¯ä¸€ä¸ªå¯èƒ½çš„ JavaScript å€¼ï¼šå­—ç¬¦ä¸²å’Œæ•°å­—ï¼›æ•°ç»„ã€å¯¹è±¡å’Œæ–¹æ³•ï¼›ç”šè‡³é”™è¯¯å’Œç‰¹æ®Šçš„ JavaScript å€¼è¯¸å¦‚ <code>null</code> å’Œ <code>undefined</code>ã€‚</p><p><code>JSValue</code> åŒ…æ‹¬ä¸€ç³»åˆ—æ–¹æ³•ç”¨äºè®¿é—®å…¶å¯èƒ½çš„å€¼ä»¥ä¿è¯æœ‰æ­£ç¡®çš„ Foundation ç±»å‹ï¼ŒåŒ…æ‹¬ï¼š</p><table><thead><tr><th>JavaScript Type</th><th><code>JSValue</code> method</th><th>Objective-C Type</th><th>Swift Type</th></tr></thead><tbody><tr><td>string</td><td><code>toString</code></td><td><code>NSString</code></td><td><code>String!</code></td></tr><tr><td>boolean</td><td><code>toBool</code></td><td><code>BOOL</code></td><td><code>Bool</code></td></tr><tr><td>number</td><td><code>toNumber</code><br><code>toDouble</code><br><code>toInt32</code><br><code>toUInt32</code></td><td><code>NSNumber</code><br><code>double</code><br><code>int32_t</code><br><code>uint32_t</code></td><td><code>NSNumber!</code><br><code>Double</code><br><code>Int32</code><br><code>UInt32</code></td></tr><tr><td>Date</td><td><code>toDate</code></td><td><code>NSDate</code></td><td><code>NSDate!</code></td></tr><tr><td>Array</td><td><code>toArray</code></td><td><code>NSArray</code></td><td><code>[AnyObject]!</code></td></tr><tr><td>Object</td><td><code>toDictionary</code></td><td><code>NSDictionary</code></td><td><code>[NSObject : AnyObject]!</code></td></tr><tr><td>Object</td><td><code>toObject</code><br><code>toObjectOfClass:</code></td><td><em>custom type</em></td><td><em>custom type</em></td></tr></tbody></table><p>ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¾—åˆ° <code>tripleNum</code> çš„å€¼ï¼Œåªéœ€ä½¿ç”¨é€‚å½“çš„æ–¹æ³•ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>println(<span style=color:#e6db74>&#34;Tripled: </span><span style=color:#e6db74>\(</span>tripleNum.toInt32<span style=color:#e6db74>())</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// Tripled: 30</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSLog(<span style=color:#e6db74>@&#34;Tripled: %d&#34;</span>, [tripleNum toInt32]);
</span></span><span style=display:flex><span><span style=color:#75715e>// Tripled: 30
</span></span></span></code></pre></div><h3 id=ä¸‹æ ‡å€¼>ä¸‹æ ‡å€¼</h3><p>å¯¹ <code>JSContext</code> å’Œ <code>JSValue</code> å®ä¾‹ä½¿ç”¨ä¸‹æ ‡çš„æ–¹å¼æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°è®¿é—®æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ <code>context</code> çš„ä»»ä½•å€¼ã€‚<code>JSContext</code> éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸‹æ ‡ï¼Œè€Œ <code>JSValue</code> å…è®¸ä½¿ç”¨å­—ç¬¦ä¸²æˆ–æ•´æ•°æ ‡æ¥å¾—åˆ°é‡Œé¢çš„å¯¹è±¡å’Œæ•°ç»„ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> names = context.objectForKeyedSubscript(<span style=color:#e6db74>&#34;names&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> initialName = names.objectAtIndexedSubscript(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>println(<span style=color:#e6db74>&#34;The first name: </span><span style=color:#e6db74>\(</span>initialName.toString<span style=color:#e6db74>())</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// The first name: Grace</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>JSValue <span style=color:#f92672>*</span>names <span style=color:#f92672>=</span> context[<span style=color:#e6db74>@&#34;names&#34;</span>];
</span></span><span style=display:flex><span>JSValue <span style=color:#f92672>*</span>initialName <span style=color:#f92672>=</span> names[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>NSLog(<span style=color:#e6db74>@&#34;The first name: %@&#34;</span>, [initialName toString]);
</span></span><span style=display:flex><span><span style=color:#75715e>// The first name: Grace
</span></span></span></code></pre></div><blockquote><p>Swift å±•ç¤ºäº†å®ƒçš„é’æ¶©ï¼Œåœ¨è¿™é‡Œï¼ŒObjective-C ä»£ç å¯ä»¥åˆ©ç”¨ä¸‹æ ‡è¡¨ç¤ºæ³•ï¼ŒSwift ç›®å‰åªå…¬å¼€<a href=/object-subscripting/>åŸå§‹æ–¹æ³•</a>æ¥è®©ä¸‹æ ‡æˆä¸ºå¯èƒ½ï¼š<code>objectAtKeyedSubscript()</code> å’Œ <code>objectAtIndexedSubscript()</code>ã€‚</p></blockquote><h3 id=è°ƒç”¨æ–¹æ³•>è°ƒç”¨æ–¹æ³•</h3><p><code>JSValue</code> åŒ…è£…äº†ä¸€ä¸ª JavaScript å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä» Objective-C / Swift ä»£ç ä¸­ä½¿ç”¨ Foundation ç±»å‹ä½œä¸ºå‚æ•°æ¥ç›´æ¥è°ƒç”¨è¯¥å‡½æ•°ã€‚å†æ¬¡ï¼ŒJavaScriptCore å¾ˆè½»æ¾çš„å¤„ç†äº†è¿™ä¸ªæ¡¥æ¥ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> tripleFunction = context.objectForKeyedSubscript(<span style=color:#e6db74>&#34;triple&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> result = tripleFunction.callWithArguments([<span style=color:#ae81ff>5</span>])
</span></span><span style=display:flex><span>println(<span style=color:#e6db74>&#34;Five tripled: </span><span style=color:#e6db74>\(</span>result.toInt32<span style=color:#e6db74>())</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>JSValue <span style=color:#f92672>*</span>tripleFunction <span style=color:#f92672>=</span> context[<span style=color:#e6db74>@&#34;triple&#34;</span>];
</span></span><span style=display:flex><span>JSValue <span style=color:#f92672>*</span>result <span style=color:#f92672>=</span> [tripleFunction callWithArguments:<span style=color:#ae81ff>@[</span><span style=color:#ae81ff>@5</span><span style=color:#ae81ff>]</span> ];
</span></span><span style=display:flex><span>NSLog(<span style=color:#e6db74>@&#34;Five tripled: %d&#34;</span>, [result toInt32]);
</span></span></code></pre></div><h3 id=é”™è¯¯å¤„ç†>é”™è¯¯å¤„ç†</h3><p><code>JSContext</code> è¿˜æœ‰å¦å¤–ä¸€ä¸ªæœ‰ç”¨çš„æ‹›æ•°ï¼šé€šè¿‡è®¾ç½®ä¸Šä¸‹æ–‡çš„ <code>exceptionHandler</code> å±æ€§ï¼Œä½ å¯ä»¥è§‚å¯Ÿå’Œè®°å½•è¯­æ³•ï¼Œç±»å‹ä»¥åŠè¿è¡Œæ—¶é”™è¯¯ã€‚ <code>exceptionHandler</code> æ˜¯ä¸€ä¸ªæ¥æ”¶ä¸€ä¸ª <code>JSContext</code> å¼•ç”¨å’Œå¼‚å¸¸æœ¬èº«çš„å›è°ƒå¤„ç†ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>context.exceptionHandler = { context, exception <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>    println(<span style=color:#e6db74>&#34;JS Error: </span><span style=color:#e6db74>\(</span>exception<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>context.evaluateScript(<span style=color:#e6db74>&#34;function multiply(value1, value2) { return value1 * value2 &#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// JS Error: SyntaxError: Unexpected end of script</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>context.exceptionHandler <span style=color:#f92672>=</span> <span style=color:#f92672>^</span>(JSContext <span style=color:#f92672>*</span>context, JSValue <span style=color:#f92672>*</span>exception) {
</span></span><span style=display:flex><span>   NSLog(<span style=color:#e6db74>@&#34;JS Error: %@&#34;</span>, exception);
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[context evaluateScript:<span style=color:#e6db74>@&#34;function multiply(value1, value2) { return value1 * value2 &#34;</span>];
</span></span><span style=display:flex><span><span style=color:#75715e>// JS Error: SyntaxError: Unexpected end of script
</span></span></span></code></pre></div><h2 id=javascript-è°ƒç”¨>JavaScript è°ƒç”¨</h2><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•ä» JavaScript ç¯å¢ƒä¸­æå–å€¼ä»¥åŠå¦‚ä½•è°ƒç”¨å…¶ä¸­å®šä¹‰çš„å‡½æ•°ã€‚é‚£ä¹ˆåå‘å‘¢ï¼Ÿæˆ‘ä»¬æ€æ ·æ‰èƒ½ä» JavaScript è®¿é—®æˆ‘ä»¬åœ¨ Objective-C æˆ– Swift å®šä¹‰çš„å¯¹è±¡å’Œæ–¹æ³•ï¼Ÿ</p><p>è®© <code>JSContext</code> è®¿é—®æˆ‘ä»¬çš„æœ¬åœ°å®¢æˆ·ç«¯ä»£ç çš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼šblock å’Œ <code>JSExport</code> åè®®ã€‚</p><h3 id=blocks>Blocks</h3><p>å½“ä¸€ä¸ª Objective-C block
è¢«èµ‹ç»™ <code>JSContext</code> é‡Œçš„ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼ŒJavaScriptCore ä¼šè‡ªåŠ¨çš„æŠŠ block å°è£…åœ¨ JavaScript å‡½æ•°é‡Œã€‚è¿™ä½¿å¾—åœ¨ JavaScript ä¸­å¯ä»¥ç®€å•çš„ä½¿ç”¨ Foundation å’Œ Cocoa ç±»ï¼Œæ‰€æœ‰çš„æ¡¥æ¥éƒ½ä¸ºä½ åšå¥½äº†ã€‚è§è¯äº† <code>CFStringTransform</code> çš„å¼ºå¤§å¨åŠ›ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ JavaScriptï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> simplifyString: @objc_block String -&gt; String = { input <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> mutableString = NSMutableString(string: input) <span style=color:#66d9ef>as</span> CFMutableStringRef
</span></span><span style=display:flex><span>    CFStringTransform(mutableString, <span style=color:#66d9ef>nil</span>, kCFStringTransformToLatin, Boolean(<span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>    CFStringTransform(mutableString, <span style=color:#66d9ef>nil</span>, kCFStringTransformStripCombiningMarks, Boolean(<span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> mutableString
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>context.setObject(unsafeBitCast(simplifyString, AnyObject.<span style=color:#66d9ef>self</span>), forKeyedSubscript: <span style=color:#e6db74>&#34;simplifyString&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>println(context.evaluateScript(<span style=color:#e6db74>&#34;simplifyString(&#39;ì•ˆë…•í•˜ìƒˆìš”!&#39;)&#34;</span>))
</span></span><span style=display:flex><span><span style=color:#75715e>// annyeonghasaeyo!</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>context[<span style=color:#e6db74>@&#34;simplifyString&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#f92672>^</span>(NSString <span style=color:#f92672>*</span>input) {
</span></span><span style=display:flex><span>   NSMutableString <span style=color:#f92672>*</span>mutableString <span style=color:#f92672>=</span> [input mutableCopy];
</span></span><span style=display:flex><span>   CFStringTransform((<span style=color:#66d9ef>__bridge</span> CFMutableStringRef)mutableString, NULL, kCFStringTransformToLatin, NO);
</span></span><span style=display:flex><span>   CFStringTransform((<span style=color:#66d9ef>__bridge</span> CFMutableStringRef)mutableString, NULL, kCFStringTransformStripCombiningMarks, NO);
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>return</span> mutableString;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSLog(<span style=color:#e6db74>@&#34;%@&#34;</span>, [context evaluateScript:<span style=color:#e6db74>@&#34;simplifyString(&#39;ì•ˆë…•í•˜ìƒˆìš”!&#39;)&#34;</span>]);
</span></span></code></pre></div><blockquote><p>åœ¨è¿™å„¿ï¼ŒSwfit è¿˜æœ‰ä¸€ä¸ªå‘ï¼Œè¯·æ³¨æ„ï¼Œè¿™ä»…é€‚ç”¨äº <em>Objective-C çš„ block</em>ï¼Œè€Œä¸æ˜¯ Swift çš„é—­åŒ…ã€‚è¦åœ¨ <code>JSContext</code> ä¸­ä½¿ç”¨ Swift é—­åŒ…ï¼Œå®ƒéœ€è¦ï¼ˆaï¼‰ä¸ <code>@ objc_block</code> å±æ€§ä¸€èµ·å£°æ˜ï¼Œä»¥åŠï¼ˆbï¼‰ä½¿ç”¨ Swift é‚£ä¸ªä»¤äººææƒ§çš„ <code>unsafeBitCast()</code> å‡½æ•°è½¬æ¢ä¸º <code>AnyObject</code> ã€‚</p></blockquote><h4 id=å†…å­˜ç®¡ç†>å†…å­˜ç®¡ç†</h4><p>ç”±äº block å¯ä»¥ä¿æœ‰å˜é‡å¼•ç”¨ï¼Œè€Œä¸” <code>JSContext</code> ä¹Ÿå¼ºå¼•ç”¨å®ƒæ‰€æœ‰çš„å˜é‡ï¼Œä¸ºäº†é¿å…å¼ºå¼•ç”¨å¾ªç¯éœ€è¦ç‰¹åˆ«å°å¿ƒã€‚é¿å…ä¿æœ‰ä½ çš„ <code>JSContext</code> æˆ–ä¸€ä¸ª block é‡Œçš„ä»»ä½• <code>JSValue</code>ã€‚ç›¸åï¼Œä½¿ç”¨ <code>[JSContext currentContext]</code> å¾—åˆ°å½“å‰ä¸Šä¸‹æ–‡ï¼Œå¹¶æŠŠä½ éœ€è¦çš„ä»»ä½•å€¼ç”¨å‚æ•°ä¼ é€’ã€‚</p><h3 id=jsexport-åè®®><code>JSExport</code> åè®®</h3><p>å¦ä¸€ç§åœ¨ JavaScript ä»£ç ä¸­ä½¿ç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰å¯¹è±¡çš„æ–¹æ³•æ˜¯æ·»åŠ  <code>JSExport</code> åè®®ã€‚æ— è®ºæˆ‘ä»¬åœ¨ <code>JSExport</code> é‡Œå£°æ˜çš„å±æ€§ï¼Œå®ä¾‹æ–¹æ³•è¿˜æ˜¯ç±»æ–¹æ³•ï¼Œç»§æ‰¿çš„åè®®éƒ½ä¼š<em>è‡ªåŠ¨çš„</em>æä¾›ç»™ä»»ä½• JavaScript ä»£ç ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚çœ‹åˆ°ã€‚</p><h2 id=javascriptcore-å®æˆ˜>JavaScriptCore å®æˆ˜</h2><p>è®©æˆ‘ä»¬åšä¸€ä¸ªä½¿ç”¨äº†æ‰€æœ‰è¿™äº›ä¸åŒçš„æŠ€æœ¯çš„ç¤ºä¾‹ - æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ª <code>Person</code> æ¨¡å‹ç¬¦åˆ <code>JSExport</code> å­åè®® <code>PersonJSExports</code> çš„ä¾‹å­ï¼Œç„¶åä½¿ç”¨ JavaScript ä» JSON æ–‡ä»¶ä¸­åˆ›å»ºå¹¶å¡«å……å®ä¾‹ã€‚éƒ½æœ‰ä¸€ä¸ªå®Œæ•´çš„ JVM åœ¨é‚£å„¿äº†ï¼Œè°è¿˜éœ€è¦ <code>NSJSONSerialization</code>ï¼Ÿ</p><h3 id=1-personjsexports-å’Œ-person>1) <code>PersonJSExports</code> å’Œ <code>Person</code></h3><p>æˆ‘ä»¬çš„ <code>Person</code> ç±»å®ç°äº† <code>PersonJSExports</code> åè®®ï¼Œè¯¥åè®®è§„å®šå“ªäº›å±æ€§åœ¨ JavaScript ä¸­å¯ç”¨ã€‚</p><blockquote><p>ç”±äº JavaScriptCore <em>æ²¡æœ‰</em>åˆå§‹åŒ–ï¼Œæ‰€ä»¥ <code>create...</code> ç±»æ–¹æ³•æ˜¯å¿…è¦çš„ï¼Œæˆ‘ä»¬ä¸èƒ½åƒåŸç”Ÿçš„ JavaScript ç±»å‹é‚£æ ·ç®€å•åœ°ç”¨ <code>var person = new Person()</code>ã€‚</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// Custom protocol must be declared with `@objc`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@objc</span> <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>PersonJSExports</span> : JSExport {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> firstName: String { <span style=color:#66d9ef>get</span> <span style=color:#66d9ef>set</span> }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> lastName: String { <span style=color:#66d9ef>get</span> <span style=color:#66d9ef>set</span> }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> birthYear: NSNumber? { <span style=color:#66d9ef>get</span> <span style=color:#66d9ef>set</span> }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getFullName</span>() -&gt; String
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/// create and return a new Person instance with `firstName` and `lastName`</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>func</span> createWithFirstName(firstName: String, lastName: String) -&gt; Person
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Custom class must inherit from `NSObject`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@objc</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Person</span> : NSObject, PersonJSExports {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// properties must be declared as `dynamic`</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>dynamic</span> <span style=color:#66d9ef>var</span> firstName: String
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>dynamic</span> <span style=color:#66d9ef>var</span> lastName: String
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>dynamic</span> <span style=color:#66d9ef>var</span> birthYear: NSNumber?
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>init</span>(firstName: String, lastName: String) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.firstName = firstName
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.lastName = lastName
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>func</span> createWithFirstName(firstName: String, lastName: String) -&gt; Person {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Person(firstName: firstName, lastName: lastName)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getFullName</span>() -&gt; String {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>\(</span>firstName<span style=color:#e6db74>)</span><span style=color:#e6db74> </span><span style=color:#e6db74>\(</span>lastName<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#75715e>// in Person.h -----------------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>@class</span> <span style=color:#a6e22e>Person</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@protocol</span> <span style=color:#a6e22e>PersonJSExports</span> <span style=color:#f92672>&lt;</span>JSExport<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>copy</span>) NSString <span style=color:#f92672>*</span>firstName;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>copy</span>) NSString <span style=color:#f92672>*</span>lastName;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>@property</span> NSInteger ageToday;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>-</span> (NSString <span style=color:#f92672>*</span>)getFullName;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// create and return a new Person instance with `firstName` and `lastName`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>+</span> (<span style=color:#66d9ef>instancetype</span>)createWithFirstName:(NSString <span style=color:#f92672>*</span>)firstName lastName:(NSString <span style=color:#f92672>*</span>)lastName;
</span></span><span style=display:flex><span><span style=color:#66d9ef>@end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@interface</span> <span style=color:#a6e22e>Person</span> : <span style=color:#a6e22e>NSObject</span> <span style=color:#f92672>&lt;</span>PersonJSExports<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>copy</span>) NSString <span style=color:#f92672>*</span>firstName;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>copy</span>) NSString <span style=color:#f92672>*</span>lastName;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>@property</span> NSInteger ageToday;
</span></span><span style=display:flex><span><span style=color:#66d9ef>@end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// in Person.m -----------------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>@implementation</span> <span style=color:#a6e22e>Person</span>
</span></span><span style=display:flex><span>- (NSString <span style=color:#f92672>*</span>)<span style=color:#a6e22e>getFullName</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [NSString stringWithFormat:<span style=color:#e6db74>@&#34;%@ %@&#34;</span>, self.firstName, self.lastName];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>+ (<span style=color:#66d9ef>instancetype</span>) <span style=color:#a6e22e>createWithFirstName:</span>(NSString <span style=color:#f92672>*</span>)firstName <span style=color:#a6e22e>lastName:</span>(NSString <span style=color:#f92672>*</span>)lastName {
</span></span><span style=display:flex><span>    Person <span style=color:#f92672>*</span>person <span style=color:#f92672>=</span> [[Person alloc] init];
</span></span><span style=display:flex><span>    person.firstName <span style=color:#f92672>=</span> firstName;
</span></span><span style=display:flex><span>    person.lastName <span style=color:#f92672>=</span> lastName;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> person;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>@end</span>
</span></span></code></pre></div><h3 id=2-jscontext-é…ç½®>2) <code>JSContext</code> é…ç½®</h3><p>ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æˆ‘ä»¬å·²ç»åˆ›å»ºçš„ <code>Person</code> ç±»ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å¯¼å‡ºåˆ° JavaScript ç¯å¢ƒã€‚æˆ‘ä»¬ä¹Ÿå°†å€Ÿæ­¤å¯¼å…¥ <a href=http://mustache.github.io/>Mustache JS library</a>ï¼Œæˆ‘ä»¬å°†åº”ç”¨æ¨¡æ¿åˆ°æˆ‘ä»¬çš„ <code>Person</code> å¯¹è±¡ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// export Person class</span>
</span></span><span style=display:flex><span>context.setObject(Person.<span style=color:#66d9ef>self</span>, forKeyedSubscript: <span style=color:#e6db74>&#34;Person&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// load Mustache.js</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> mustacheJSString = String(contentsOfFile:..., encoding:NSUTF8StringEncoding, error:<span style=color:#66d9ef>nil</span>) {
</span></span><span style=display:flex><span>    context.evaluateScript(mustacheJSString)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#75715e>// export Person class
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>context[<span style=color:#e6db74>@&#34;Person&#34;</span>] <span style=color:#f92672>=</span> [Person <span style=color:#66d9ef>class</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// load Mustache.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>NSString <span style=color:#f92672>*</span>mustacheJSString <span style=color:#f92672>=</span> [NSString stringWithContentsOfFile:... encoding:NSUTF8StringEncoding error:nil];
</span></span><span style=display:flex><span>[context evaluateScript:mustacheJSString];
</span></span></code></pre></div><h3 id=3-javascript-æ•°æ®å’Œè¿›ç¨‹>3) JavaScript æ•°æ®å’Œè¿›ç¨‹</h3><p>ä¸‹é¢å°±æ¥çœ‹çœ‹æˆ‘ä»¬ç®€å•çš„ JSON ä¾‹å­ï¼Œè¿™æ®µä»£ç å°†åˆ›å»ºæ–°çš„ <code>Person</code> å®ä¾‹ã€‚</p><blockquote><p>æ³¨æ„ï¼šJavaScriptCore è½¬æ¢çš„ Objective-C / Swift æ–¹æ³•åæ˜¯ JavaScript å…¼å®¹çš„ã€‚ç”±äº JavaScript æ²¡æœ‰å‚æ•° åç§°ï¼Œä»»ä½•å¤–éƒ¨å‚æ•°åç§°éƒ½ä¼šè¢«è½¬æ¢ä¸ºé©¼å³°å½¢å¼å¹¶ä¸”é™„åŠ åˆ°å‡½æ•°ååã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒObjective-C çš„æ–¹æ³• <code>createWithFirstName:lastName:</code> å˜æˆäº†åœ¨JavaScriptä¸­çš„ <code>createWithFirstNameLastName()</code>ã€‚</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JavaScript data-lang=JavaScript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>loadPeopleFromJSON</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>jsonString</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>jsonString</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>people</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>person</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Person</span>.<span style=color:#a6e22e>createWithFirstNameLastName</span>(<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>first</span>, <span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>last</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>person</span>.<span style=color:#a6e22e>birthYear</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>year</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>people</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>person</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>people</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JSON data-lang=JSON><span style=display:flex><span>[
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;first&#34;</span>: <span style=color:#e6db74>&#34;Grace&#34;</span>,     <span style=color:#f92672>&#34;last&#34;</span>: <span style=color:#e6db74>&#34;Hopper&#34;</span>,   <span style=color:#f92672>&#34;year&#34;</span>: <span style=color:#ae81ff>1906</span> },
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;first&#34;</span>: <span style=color:#e6db74>&#34;Ada&#34;</span>,       <span style=color:#f92672>&#34;last&#34;</span>: <span style=color:#e6db74>&#34;Lovelace&#34;</span>, <span style=color:#f92672>&#34;year&#34;</span>: <span style=color:#ae81ff>1815</span> },
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;first&#34;</span>: <span style=color:#e6db74>&#34;Margaret&#34;</span>,  <span style=color:#f92672>&#34;last&#34;</span>: <span style=color:#e6db74>&#34;Hamilton&#34;</span>, <span style=color:#f92672>&#34;year&#34;</span>: <span style=color:#ae81ff>1936</span> }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><h3 id=4-åŠ åˆ°ä¸€èµ·>4) åŠ åˆ°ä¸€èµ·</h3><p>å‰©ä¸‹çš„å°±æ˜¯åŠ è½½ JSON æ•°æ®ï¼Œè°ƒç”¨ <code>JSContext</code> å°†æ•°æ®è§£ææˆ <code>Person</code> å¯¹è±¡çš„æ•°ç»„ï¼Œå¹¶ç”¨ Mustache æ¨¡æ¿å‘ˆç°æ¯ä¸ª <code>Person</code>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// get JSON string</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> peopleJSON = NSString(contentsOfFile:..., encoding: NSUTF8StringEncoding, error: <span style=color:#66d9ef>nil</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// get load function</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> load = context.objectForKeyedSubscript(<span style=color:#e6db74>&#34;loadPeopleFromJSON&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// call with JSON and convert to an array of `Person`</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> people = load.callWithArguments([peopleJSON]).toArray() <span style=color:#66d9ef>as</span>? [Person] {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// get rendering function and create template</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> mustacheRender = context.objectForKeyedSubscript(<span style=color:#e6db74>&#34;Mustache&#34;</span>).objectForKeyedSubscript(<span style=color:#e6db74>&#34;render&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> template = <span style=color:#e6db74>&#34;fullName, born birthYear&#34;</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>        <span style=color:#75715e>// loop through people and render Person object as string</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> person <span style=color:#66d9ef>in</span> people {
</span></span><span style=display:flex><span>            println(mustacheRender.callWithArguments([template, person]))
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Output:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Grace Hopper, born 1906</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Ada Lovelace, born 1815</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Margaret Hamilton, born 1936</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#75715e>// get JSON string
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>NSString <span style=color:#f92672>*</span>peopleJSON <span style=color:#f92672>=</span> [NSString stringWithContentsOfFile:... encoding:NSUTF8StringEncoding error:nil];
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#75715e>// get load function
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>JSValue <span style=color:#f92672>*</span>load <span style=color:#f92672>=</span> context[<span style=color:#e6db74>@&#34;loadPeopleFromJSON&#34;</span>];
</span></span><span style=display:flex><span><span style=color:#75715e>// call with JSON and convert to an NSArray
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>JSValue <span style=color:#f92672>*</span>loadResult <span style=color:#f92672>=</span> [load callWithArguments:<span style=color:#ae81ff>@[</span>peopleJSON<span style=color:#ae81ff>]</span>];
</span></span><span style=display:flex><span>NSArray <span style=color:#f92672>*</span>people <span style=color:#f92672>=</span> [loadResult toArray];
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#75715e>// get rendering function and create template
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>JSValue <span style=color:#f92672>*</span>mustacheRender <span style=color:#f92672>=</span> context[<span style=color:#e6db74>@&#34;Mustache&#34;</span>][<span style=color:#e6db74>@&#34;render&#34;</span>];
</span></span><span style=display:flex><span>NSString <span style=color:#f92672>*</span>template <span style=color:#f92672>=</span> <span style=color:#e6db74>@&#34;ullName, born birthYear&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// loop through people and render Person object as string
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>for</span> (Person <span style=color:#f92672>*</span>person <span style=color:#66d9ef>in</span> people) {
</span></span><span style=display:flex><span>   NSLog(<span style=color:#e6db74>@&#34;%@&#34;</span>, [mustacheRender callWithArguments:<span style=color:#ae81ff>@[</span>template, person<span style=color:#ae81ff>]</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Output:
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Grace Hopper, born 1906
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Ada Lovelace, born 1815
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Margaret Hamilton, born 1936
</span></span></span></code></pre></div><hr><p>åœ¨ä½ çš„åº”ç”¨ç¨‹åºå¦‚ä½•ä½¿ç”¨ JavaScriptï¼ŸJavaScript ä»£ç æ®µå¯èƒ½æ˜¯é™„å¸¦åº”ç”¨ä¸€èµ·å‘å¸ƒçš„åŸºæœ¬çš„ç”¨æˆ·å®šä¹‰çš„æ’ä»¶ã€‚å¦‚æœä½ çš„äº§å“å¼€å§‹åœ¨ web ä¸Šå‘å¸ƒï¼Œä½ å¯èƒ½å°†ç°æœ‰çš„ä»£ç ç¨åŠ æ”¹åŠ¨å³å¯é€‚åº”éœ€æ±‚ã€‚æˆ–è€…ï¼Œå¦‚æœ<em>ä½ </em>å¼€å§‹æˆä¸ºä¸€ä¸ª web ç¨‹åºå‘˜ï¼Œä½ å¯èƒ½ä¼šäº«å—è¿½æº¯è„šæœ¬æ ¹æºçš„æœºä¼šã€‚æ— è®ºæ˜¯å“ªç§æƒ…å†µï¼ŒJavaScriptCore éƒ½æ˜¯ç²¾å¿ƒæ‰“é€ å’Œå¼ºå¤§çš„ï¼Œä¸å®¹å¿½è§†ã€‚</p><hr><p>é™¤é<a href=https://nshipster.cn/ target=_blank>å¦æœ‰å£°æ˜</a>ï¼Œæœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ã€Œ<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 3.0 ä¸­å›½å¤§é™†</a>ã€è®¸å¯åè®®æˆæƒã€‚</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top Â· å›é¡¶éƒ¨" rel=nofollow>&#127772;2015-01-19 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2026 Nate Cook ç‰ˆæƒæ‰€æœ‰</a><a href=https://autoptr.top/ title="Back to Home Â· å›é¦–é¡µ">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>æ ‡ç­¾:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>åˆ†ç±»:</span><li><a class=link href=https://autoptr.top/categories/Cocoa target=_blank>Cocoa</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>