<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>NSValue</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="NSValue,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="NSValue,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"🌜"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>NSValue</span><span class=btRight><span title="Author · 作者" class=author>Mattt</span> <span title="Translator · 翻译" class=author>Ricky Tan</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post · 关联或转载引用的文章" target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics · 回主题页">&#127793;</a></span></h1><p>在电影 <a href=http://www.imdb.com/title/tt0443272/>eponymous 2012 biopic</a> 中出演亚伯拉罕·林肯一角时，丹尼尔·戴 - 刘易斯坚决要求每次进出剧组时要通过一个标有“时间机器”字样的冷库箱子。<del markdown=1><a href=http://filmdrunk.uproxx.com/2012/10/daniel-day-lewis-method-acting-lincoln-ny-times-profile>真实的故事</a></del>.</p><p>当戴 - 刘易斯先生要进行方法演技时那当然会不择手段，人们对用一个神奇的硬纸板箱连接了现代世界和历史世界这件荒唐的事无不感到惊讶。</p><p>然而，为作一个 Objective-C 的程序员，这 <em>正好</em> 是我们正在做的。</p><p>……好吧，不是 <em>正好</em> ，但这里也需要有一个箱子。</p><p>就像在 NSHipster 中 <a href=https://nshipster.cn/ns_enum-ns_options/>一而再</a> <a href=https://nshipster.cn/nil/>再而三</a> 地提到的那样，是什么让 Objective-C 如此的神奇？正是将过时的，面向过程的 C 的世界与受 Smalltalk 影响的现代的面向对象的世界兼并的方法。如果能恰到好处地兼并，两个世界的对立关系就可以被用来熟练地开发语义上丰富的软件，而不牺牲性能。但是在新与旧的鸿沟之间架桥的却是乌烟瘴气的强制类型转换、无缝转换和包装。</p><p>打包就是用面向对象的容器来封装标量（<code>int</code>，<code>double</code>，<code>BOOL</code> 等）和值类型（<code>struct</code>，<code>enum</code>）的过程，主要用于将那些值保存到面向对象的集合中——如数组和字典。</p><p><code>NSNumber</code> 常用于包装标量，但是在基础类库中，轻量级的包装冠军是 <code>NSValue</code>。</p><hr><p><code>NSValue</code> 是用于承载单一的 C 或 Objective-C 数据值的容器。它能承载标量和值类型，也能用于指针和对象 ID。</p><p>如何打包固然是个枯燥无味的主题，但仍有两个方法尤其值得注意：<code>+valueWithBytes:objCType:</code>，使用 <code>NSValue</code> 的入门级方法；<code>+valueWithNonretainedObject:</code>，相对较少人知道却十分有用的方法。</p><h2 id=valuewithbytesobjctype><code>valueWithBytes:objCType:</code></h2><blockquote><p><code>+valueWithBytes:objCType:</code>
创建并返回一个包含给定值的 NSValue 对象，该值会被解释为一个给定的 Objective-C 类型。</p><ul><li><code>value</code>: <code>NSValue</code> 对象的值。</li><li><code>type</code>: 给定值的对应的 Objective-C 类型。<code>type</code> 需要用 Objective-C 的编译器指令 <code>@encode()</code> 来创建，而不应该用硬编码的 C 语言字符串。</li></ul></blockquote><p><code>@encode</code> 在文章 <a href=https://nshipster.cn/at-compiler-directives/>无数个 <code>@</code> 编译器指令的摘要</a> 中有讨论过：</p><blockquote><p><code>@encode()</code>: 返回一种类型的<a href=https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html>类型编码</a>。这个类型值能用做 <code>NSCoder -encodeValueOfObjCType:at</code> 的第一个参数。</p></blockquote><p>关于类型编码的主题可以写<a href=https://nshipster.com/type-encodings/>一篇很好的文章</a>，但其主要内容是它用于将一种类型的结构转换为精练的，可读的表示。例如，</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> example {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>id</span>   anObject;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>aString;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span>  anInt;
</span></span><span style=display:flex><span>} Example;
</span></span></code></pre></div><p>有如下编码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>{example<span style=color:#f92672>=</span>@<span style=color:#f92672>*</span>i}
</span></span></code></pre></div><p><code>NSValue</code> 用类型编码创建必要的数据结构以在内部表示这些值。整洁！</p><h2 id=valuewithnonretainedobject><code>valueWithNonretainedObject:</code></h2><blockquote><p><code>+valueWithNonretainedObject:</code>
创建并返回一个包含给定对象的 NSValue。</p><p><code>anObject</code>: 新对象的值。</p></blockquote><p>如果你已经知道 <code>valueWithNonretainedObject</code>，你应该会微笑点头。如果你不知道，你可能会目瞪口呆，即使没有也快了。</p><p>简要地说，<code>valueWithNonretainedObject:</code> 允许一个对象添加到集合中去，而不需要服从 <code>&lt;NSCopying></code> 协议。</p><p>偶尔会出现一些情况需要用到无法直接添加到 <code>NSArray</code> 或 <code>NSDictonary</code> 中的对象。如果不知道 <code>valueWithNonretainedObject:</code>，这会让你全盘皆输————特别是你又是个 Objective-C 新手的话。</p><p>但现在你知道了。你不会在行人注目之下感到窒息。你不再需要摸索着从 <a href=https://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSPointerArray_Class/Introduction/Introduction.html><code>NSPointerArray</code></a> 或 <a href=https://developer.apple.com/library/mac/#documentation/Cocoa/Reference/NSMapTable_class/Reference/NSMapTable.html%23//apple_ref/occ/cl/NSMapTable><code>NSMapTable</code></a> 寻找答案。今天会是全新的一天。</p><hr><h2 id=在打开了-nsvalue-的所有智慧之后现在你可以从容应对面向过程和面向对象c-与-smalltalk-之间的残酷划分了因为一个神奇的箱子所有事情都变得简单>在打开了 <code>NSValue</code> 的所有智慧之后，现在你可以从容应对面向过程和面向对象、C 与 Smalltalk 之间的残酷划分了。因为一个神奇的箱子，所有事情都变得简单。</h2><p>除非<a href=https://nshipster.cn/ target=_blank>另有声明</a>，本文采用知识共享「<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>署名-非商业性使用 3.0 中国大陆</a>」许可协议授权。</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top · 回顶部" rel=nofollow>&#127772;2013-01-28 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2025 Mattt 版权所有</a><a href=https://autoptr.top/ title="Back to Home · 回首页">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>标签:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>分类:</span><li><a class=link href=https://autoptr.top/categories/Cocoa target=_blank>Cocoa</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>