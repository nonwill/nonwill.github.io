<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>UIPrintInteractionController</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="UIPrintInteractionController,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="UIPrintInteractionController,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"ğŸŒœ"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>UIPrintInteractionController</span><span class=btRight><span title="Author Â· ä½œè€…" class=author>Nate Cook</span> <span title="Translator Â· ç¿»è¯‘" class=author>April Peng</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post Â· å…³è”æˆ–è½¬è½½å¼•ç”¨çš„æ–‡ç« " target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics Â· å›ä¸»é¢˜é¡µ">&#127793;</a></span></h1><p>éšç€å„ç§ä¸åŒæ–¹å¼çš„è¯„è®ºã€æ ‡è®°ã€ä¿å­˜ã€åˆ†äº«éƒ½é€šè¿‡æŒ‡å°–çš„æ“ä½œå®Œæˆï¼Œçº¸è´¨å°åˆ·å“çš„ä»·å€¼å¾ˆå®¹æ˜“è¢«äººå¿½è§†ã€‚</p><p>UIKit å¯ä»¥å¾ˆå®¹æ˜“çš„æŠŠç”¨æˆ·è®¾å¤‡é‡Œå­˜å‚¨çš„å®šåˆ¶è®¾è®¡ç›´æ¥æ‰“å°å‡ºæ¥ï¼Œå¹¶ä¸”å¯ä»¥å…¼å®¹å†…å®¹å’Œçº¸å¼ å¤§å°ã€‚æœ¬æ–‡å°†é¦–å…ˆæ¦‚è¿°å¦‚ä½•æ ¼å¼åŒ–ä½ çš„å†…å®¹ä»¥ä¾¿æ‰“å°ï¼Œç„¶åè¯¦ç»†ä»‹ç»å‘ˆç°ï¼ˆæˆ–ä¸ç”¨å‘ˆç°ï¼ï¼‰æ‰“å°ç•Œé¢çš„ä¸åŒæ–¹å¼ã€‚</p><hr><blockquote><p>è¿™ç¯‡æ–‡ç« çš„â€œæ‰“å°â€å›¾åƒéƒ½æ¥è‡ªè‹¹æœçš„ <em>æ‰“å°æœºæ¨¡æ‹Ÿå™¨</em>ã€‚ï¼ˆé»„è‰²è¾¹è¡¨ç¤ºçº¸å¼ çš„éæ‰“å°è¾¹è·ï¼‰</p></blockquote><blockquote><p>åœ¨ Xcode 6 ä¸Šï¼Œæ‰“å°æœºæ¨¡æ‹Ÿå™¨å¿…é¡»ä¸‹è½½ï¼Œå®ƒæ˜¯*<a href="https://developer.apple.com/downloads/index.action?name=hardware%20io%20tools">Xcode çš„ç¡¬ä»¶ IO å·¥å…·</a>*çš„ä¸€éƒ¨åˆ†ã€‚</p></blockquote><p><img alt="ä»è‹¹æœå¼€å‘è€…ç½‘ç«™ä¸‹è½½ç¡¬ä»¶ I/O å·¥å…·" src=/media/NSHipster/uiprintinteractioncontroller-hardware-io-tools-download.png></p><p><img alt="PrintSimulator åº”ç”¨ä¿¡æ¯" src=/media/NSHipster/uiprintinteractioncontroller-printer-simulator-app.png></p><p><img alt="PrintSimulator åº”ç”¨åŠ è½½è¯´æ˜" src=/media/NSHipster/uiprintinteractioncontroller-printersimulator-load-paper.png></p><hr><p><a href=https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/Printing/Printing.html#//apple_ref/doc/uid/TP40010156-CH12-SW3>UIKit æ‰“å° APIs</a> çš„æ ¸å¿ƒæ˜¯ <code>UIPrintInteractionController</code>ã€‚è¿™ä¸ªç±»çš„ä¸€ä¸ªå…±äº«å®ä¾‹ç®¡ç†ç€æ‰“å°å·¥ä½œçš„ç»†èŠ‚å’Œé…ç½®ä»»ä½•å°†è¦å‘ˆç°ç»™ç”¨æˆ·çš„ UIã€‚å®ƒè¿˜ä¸ºä½ çš„å†…å®¹çš„æ ¼å¼æä¾›äº†ä¸‰ä¸ªçº§åˆ«çš„æ§åˆ¶ã€‚</p><h2 id=æ‰“å°ä¸€ä¸ªä»»åŠ¡>æ‰“å°ä¸€ä¸ªä»»åŠ¡</h2><p>åœ¨æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ ¼å¼åŒ–æ‰“å°çš„å®é™…å†…å®¹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹é…ç½®æ‰“å°ä»»åŠ¡çš„é€‰é¡¹å’Œå‘ˆç°ç»™ç”¨æˆ·çš„æ‰“å°é€‰é¡¹ã€‚</p><h3 id=uiprintinfo>UIPrintInfo</h3><p>æ‰“å°ä»»åŠ¡ç»†èŠ‚åœ¨ <code>UIPrintInfo</code> å®ä¾‹ä¸­è®¾ç½®ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å±æ€§ï¼š</p><blockquote><ul><li><code>jobName</code> <em><code>String</code></em>ï¼šæ­¤æ‰“å°ä»»åŠ¡çš„åç§°ã€‚è¿™ä¸ªåå­—å°†è¢«æ˜¾ç¤ºåœ¨è®¾å¤‡çš„æ‰“å°ä¸­å¿ƒï¼Œå¯¹äºæœ‰äº›æ‰“å°æœºåˆ™æ˜¾ç¤ºåœ¨æ¶²æ™¶å±ä¸Šã€‚</li><li><code>orientation</code> <em><code>UIPrintInfoOrientation</code></em>ï¼š<code>.Portrait</code> ï¼ˆé»˜è®¤å€¼ï¼‰æˆ– <code>.Landscape</code>ï¼Œå¦‚æœä½ æ‰“å°çš„å†…å®¹æœ‰ä¸€ä¸ªå†…ç½®çš„æ–¹å‘å€¼ï¼Œå¦‚ PDFï¼Œè¿™ä¸ªå±æ€§å°†è¢«å¿½ç•¥ã€‚</li><li><code>duplex</code> <em><code>UIPrintInfoDuplex</code></em>ï¼š<code>.None</code>ã€<code>.ShortEdge</code> æˆ– <code>.LongEdâ€‹â€‹ge</code>ã€‚short- å’Œ long- çš„è¾¹ç•Œè®¾ç½®æŒ‡ç¤ºå¦‚ä½•è£…è®¢åŒé¢é¡µé¢ï¼Œè€Œ <code>.None</code> ä¸æ”¯æŒåŒé¢æ‰“å°ï¼ˆè¿™é‡Œä¸æ˜¯ UI åˆ‡æ¢ä¸ºåŒé¢æ‰“å°ï¼Œä»¤äººå›°æƒ‘ï¼‰ã€‚</li><li><code>outputType</code> <em><code>UIPrintInfoOutputType</code></em>ï¼šç»™ UIKit æä¾›è¦æ‰“å°å†…å®¹çš„ç±»å‹æç¤ºã€‚å¯ä»¥æ˜¯ä»¥ä¸‹ä»»æ„ä¸€ä¸ªï¼š<ul><li><code>.General</code>ï¼ˆé»˜è®¤ï¼‰ï¼šæ–‡æœ¬å’Œå›¾å½¢æ··åˆç±»å‹ï¼›å…è®¸åŒé¢æ‰“å°ã€‚</li><li><code>.Grayscale</code>ï¼šå¦‚æœä½ çš„å†…å®¹åªåŒ…æ‹¬é»‘è‰²æ–‡æœ¬ï¼Œé‚£ä¹ˆè¯¥ç±»å‹æ¯” <code>.General</code> æ›´å¥½ã€‚</li><li><code>.Photo</code>ï¼šå½©è‰²æˆ–é»‘ç™½å›¾åƒï¼›ç¦ç”¨åŒé¢æ‰“å°ï¼Œæ›´é€‚ç”¨äºå›¾åƒåª’ä½“çš„çº¸å¼ ç±»å‹ã€‚</li><li><code>.PhotoGrayscale</code>ï¼šå¯¹äºä»…ç°åº¦çš„å›¾åƒï¼Œæ ¹æ®æ‰“å°æœºçš„ä¸åŒï¼Œè¯¥ç±»å‹å¯èƒ½æ¯” <code>.Photo</code> æ›´å¥½ã€‚</li></ul></li><li><code>printerID</code> <em><code>String?</code></em>ï¼šä¸€ä¸ªç‰¹å®šçš„æ‰“å°æœºçš„ IDï¼Œå½“ç”¨æˆ·é€šè¿‡ UI é€‰æ‹©è¿‡æ‰“å°æœºå¹¶ä¸”ä¿å­˜å®ƒä½œä¸ºæœªæ¥æ‰“å°é¢„è®¾<em>ä¹‹å</em>ï¼Œä½ æ‰èƒ½å¾—åˆ°è¿™ä¸ªç±»å‹ã€‚</li></ul></blockquote><p>æ­¤å¤–ï¼Œ<code>UIPrintInfo</code> è¿˜æä¾›ä¸€ä¸ª <code>dictionaryRepresentation</code> å±æ€§ï¼Œå®ƒå¯ä»¥è¢«ä¿å­˜å¹¶ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>UIPrintInfo</code> å®ä¾‹ã€‚</p><h3 id=uiprintinteractioncontroller-è®¾ç½®><code>UIPrintInteractionController</code> è®¾ç½®</h3><p><code>UIPrintInteractionController</code> æœ‰ä¸€äº›å¾ˆä¾¿æ·çš„è®¾ç½®ï¼Œå¯ä»¥åœ¨æ˜¾ç¤ºæ‰“å° UI ä¹‹å‰é…ç½®è®¾ç½®ã€‚åŒ…æ‹¬ï¼š</p><blockquote><ul><li><code>printInfo</code> <em><code>UIPrintInfo</code></em>ï¼šä¹‹å‰æ‰€è¿°çš„æ‰“å°ä»»åŠ¡çš„é…ç½®ã€‚</li><li><code>printPaper</code> <em><code>UIPrintPaper</code></em>ï¼šçº¸å¼ ç±»å‹çš„ç‰©ç†å’Œæ‰“å°å°ºå¯¸çš„ä¸€ä¸ªç®€å•çš„ç±»å‹æè¿°ï¼›é™¤äº†ä¸“é—¨çš„åº”ç”¨ç¨‹åºï¼Œè¿™å°†ç”± UIKit å¤„ç†ã€‚</li><li><code>showsNumberOfCopies</code> <em><code>Bool</code></em>ï¼šå½“å€¼ä¸º <code>true</code> æ—¶ï¼Œè®©ç”¨æˆ·é€‰æ‹©æ‹·è´çš„ä»½æ•°ã€‚</li><li><code>showsPageRange</code> <em><code>Bool</code></em>ï¼šå½“å€¼ä¸º <code>true</code> æ—¶ï¼Œè®©ç”¨æˆ·ä»æ‰“å°æºä¸­é€‰æ‹©ä¸€ä¸ªå­èŒƒå›´ã€‚è¿™åªåœ¨å¤šé¡µå†…å®¹æ—¶æœ‰ç”¨ï¼Œå®ƒé»˜è®¤å…³é—­äº†å›¾åƒã€‚</li><li><code>showsPaperSelectionForLoadedPapers</code> <em><code>Bool</code></em>ï¼šå½“å€¼ä¸º <code>true</code> å¹¶ä¸”æ‰€é€‰æ‹©çš„æ‰“å°æœºæœ‰å¤šä¸ªçº¸å¼ é€‰é¡¹æ—¶ï¼Œç”¨æˆ·ç•Œé¢å°†è®©ç”¨æˆ·é€‰æ‹©ç”¨äºæ‰“å°çš„çº¸å¼ ã€‚</li></ul></blockquote><h2 id=æ ¼å¼åŒ–ä½ çš„å†…å®¹>æ ¼å¼åŒ–ä½ çš„å†…å®¹</h2><p>é€šè¿‡ <code>UIPrintInteractionController</code> å››ä¸ªä¸åŒçš„å±æ€§ï¼Œå¯ä»¥é€‰æ‹©å†…å®¹çš„æ§åˆ¶ï¼ˆå’Œå¤æ‚æ€§ï¼‰çº§åˆ«ã€‚</p><blockquote><ol><li><code>printingItem</code> <em><code>AnyObject!</code></em> æˆ– <code>printingItems</code> <em><code>[AnyObject]!</code></em>ï¼šæœ€åŸºæœ¬çš„ç­‰çº§ï¼Œæ§åˆ¶å™¨åªéœ€è¦å·²ç»å¯æ‰“å°ï¼ˆå›¾åƒå’Œ PDF æ–‡ä»¶ï¼‰çš„å†…å®¹ï¼Œå¹¶å°†å®ƒä»¬å‘é€åˆ°æ‰“å°æœºã€‚</li><li><code>printFormatter</code> <em><code>UIPrintFormatter</code></em>ï¼šæ›´é«˜ç­‰çº§ï¼Œä½ å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå†…ä½¿ç”¨ä¸€ä¸ª <code>UIPrintFormatter</code> çš„å­ç±»æ¥å¯¹å†…å®¹è¿›è¡Œæ ¼å¼åŒ–ï¼Œç„¶åä¼ ç»™ <code>UIPrintInteractionController</code>ã€‚ä½ å·²ç»åšäº†ä¸€äº›æ ¼å¼åŒ–ï¼Œå‰©ä¸‹çš„å¤§éƒ¨åˆ†äº‹æƒ…æ‰“å° API ä¼šå¤„ç†ã€‚</li><li><code>printPageRenderer</code> <em><code>UIPrintPageRenderer</code></em>ï¼šæœ€é«˜çº§åˆ«ï¼Œä½ å¯ä»¥åˆ›å»º <code>UIPrintPageRenderer</code> çš„ä¸€ä¸ªè‡ªå®šä¹‰å­ç±»ï¼Œç»“åˆé¡µé¢æ ¼å¼å’Œè‡ªå·±çš„ç»˜å›¾ç¨‹åºæ¥ç»˜åˆ¶é¡µçœ‰ã€é¡µè„šå’Œé¡µé¢å†…å®¹ã€‚</li></ol></blockquote><p>ä¸ºäº†è¯´æ˜è¿™äº›ç‰¹æ€§ï¼Œæ­£å¥½æ„Ÿæ©èŠ‚ï¼ˆæˆ‘æœ€å–œæ¬¢çš„èŠ‚æ—¥ï¼‰å°†è‡³ï¼Œæˆ‘ä»¬å°†å‡æƒ³ä¸€ä¸ªæ„Ÿæ©èŠ‚é£Ÿè°±çš„åº”ç”¨ç¨‹åºå¹¶å¢åŠ æ‰“å°ä¸åŒé¡µé¢çš„åŠŸèƒ½ã€‚</p><h2 id=ç”¨-printitems-æ‰“å°>ç”¨ <code>printItem</code>(<code>s</code>) æ‰“å°</h2><p>ä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>UIPrintInteractionController</code> çš„ <code>printItem</code> æˆ– <code>printItems</code> å±æ€§æ‰“å°é¢„å­˜çš„å¯æ‰“å°å†…å®¹ã€‚å›¾åƒå’Œ PDF æ–‡ä»¶å¯ä»¥é€šè¿‡å›¾è±¡æ•°æ®ï¼ˆ<code>NSData</code>ï¼Œ<code>UIImage</code> æˆ– <code>ALAsset</code> å®ä¾‹ï¼‰ï¼Œæˆ–é€šè¿‡ä»»ä½• <code>NSURL</code> å¼•ç”¨çš„ä¸œè¥¿è¢«åŠ è½½åˆ°ä¸€ä¸ª <code>NSData</code> å¯¹è±¡æ¥å¾—åˆ°ã€‚è¦æ‰“å°ï¼Œå›¾åƒå¿…é¡»æ˜¯<a href=https://developer.apple.com/library/ios/documentation/Uikit/reference/UIImage_Class/index.html#//apple_ref/doc/uid/TP40006890-CH3-SW3><code>UIImage</code> æ”¯æŒçš„æ ¼å¼</a>.</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ï¼šå½“ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®æ—¶æ˜¾ç¤ºæ‰“å°å›¾åƒçš„ UIã€‚ï¼ˆæˆ‘ä»¬ä¸‹é¢å°†çœ‹åˆ°åˆå§‹åŒ–æ‰“å°çš„å‡ ä¸ªæ–¹å¼ã€‚ï¼‰è¿™ä¸ªè¿‡ç¨‹æ˜¯å¤§è‡´ç›¸åŒçš„ï¼Œä¸ç®¡ä½ æ˜¯æ€ä¹ˆè®¾ç½®çš„æ‰“å°ä¿¡æ¯æˆ–è®¾ç½®æ‰“å°äº¤äº’æ§åˆ¶å™¨å’Œæ˜¾ç¤º UI ä¹‹å‰æä¾›çš„å†…å®¹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>@IBAction</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>print</span>(sender: UIBarButtonItem) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> UIPrintInteractionController.canPrintURL(imageURL) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> printInfo = UIPrintInfo(dictionary: <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>        printInfo.jobName = imageURL.lastPathComponent
</span></span><span style=display:flex><span>        printInfo.outputType = .Photo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> printController = UIPrintInteractionController.sharedPrintController()<span style=color:#f92672>!</span>
</span></span><span style=display:flex><span>        printController.printInfo = printInfo
</span></span><span style=display:flex><span>        printController.showsNumberOfCopies = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        printController.printingItem = imageURL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        printController.presentAnimated(<span style=color:#66d9ef>true</span>, completionHandler: <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>- (<span style=color:#66d9ef>IBAction</span>)<span style=color:#a6e22e>print:</span>(<span style=color:#66d9ef>id</span>)sender {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ([UIPrintInteractionController canPrintURL:self.imageURL]) {
</span></span><span style=display:flex><span>        UIPrintInfo <span style=color:#f92672>*</span>printInfo <span style=color:#f92672>=</span> [UIPrintInfo printInfo];
</span></span><span style=display:flex><span>        printInfo.jobName <span style=color:#f92672>=</span> self.imageURL.lastPathComponent;
</span></span><span style=display:flex><span>        printInfo.outputType <span style=color:#f92672>=</span> UIPrintInfoOutputGeneral;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        UIPrintInteractionController <span style=color:#f92672>*</span>printController <span style=color:#f92672>=</span> [UIPrintInteractionController sharedPrintController];
</span></span><span style=display:flex><span>        printController.printInfo <span style=color:#f92672>=</span> printInfo;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        printController.printingItem <span style=color:#f92672>=</span> self.imageURL;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        [printController presentAnimated:true completionHandler: nil];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ˜“å¦‚åæŒï¼ <em>(æˆ–è€…åº”æ™¯çš„è¯´ï¼Œåƒåšç…ç‘å£«ç”œèœä¸€æ ·ç®€å•ã€‚)</em></p><p><img alt="ç”¨ .printingItem æ‰“å°" src=/media/NSHipster/uiprintinteractioncontroller-image-print.png></p><blockquote><p><code>presentAnimated(:completionHandler:)</code> æ–¹æ³•æ˜¯åœ¨ <strong>iPhone</strong> ä¸Šå‘ˆç°æ‰“å° UIã€‚å¦‚æœæ˜¯ä» <strong>iPad</strong> æ‰“å°ï¼Œä½¿ç”¨ <code>presentFromBarButtonItem(:animated:completionHandler:)</code> æˆ–
<code>presentFromRect(:inView:animated:completionHandler:)</code> æ–¹æ³•ä»£æ›¿ã€‚</p></blockquote><h2 id=uiprintformatter>UIPrintFormatter</h2><p><code>UIPrintFormatter</code> ç±»æœ‰ä¸¤ä¸ªå­ç±»å¯ç”¨äºæ ¼å¼åŒ–æ–‡æœ¬ï¼ˆ<code>UISimpleTextPrintFormatter</code> å’Œ <code>UIMarkupTextPrintFormatter</code>ï¼‰ å¦å¤–è¿˜æœ‰ ï¼ˆ<code>UIViewPrintFormatter</code>ï¼‰å¯ä»¥æ ¼å¼åŒ–ä¸‰ç§è§†å›¾çš„å†…å®¹ï¼š<code>UITextView</code>ã€<code>UIWebView</code> å’Œ <code>MKMapView</code>ã€‚æ‰“å°æ ¼å¼åŒ–å™¨æœ‰å‡ ä¸ªç‰¹æ€§ï¼Œè®©ä½ ä»¥ä¸åŒæ–¹å¼å®šä¹‰é¡µé¢çš„æ‰“å°åŒºåŸŸï¼›æ ¼å¼åŒ–å™¨çš„æœ€ç»ˆæ‰“å°åŒºåŸŸå°†æ˜¯æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æœ€å°çŸ©å½¢ï¼š</p><blockquote><ul><li><code>contentInsets</code> <em><code>UIEdgeInsets</code></em>ï¼šä¸€ä¸ªå…¨éƒ¨å†…å®¹é¡µé¢çš„è¾¹ç¼˜æ’å›¾é›†åˆã€‚å·¦å’Œå³æ’å›¾è¢«åº”ç”¨åœ¨æ¯ä¸€é¡µä¸Šï¼Œä½†é¡¶éƒ¨è¾¹ç•Œåˆ™<em>åª</em>åº”ç”¨åœ¨ç¬¬ä¸€é¡µä¸Šã€‚åº•éƒ¨æ’å›¾å°†è¢«å¿½ç•¥ã€‚</li><li><code>perPageContentInsets</code> <em><code>UIEdgeInsets</code></em>ï¼ˆä»… iOS 8ï¼‰ï¼šä¸€ä¸ª<em>æ¯ä¸€é¡µ</em>æ ¼å¼åŒ–å†…å®¹é¡µé¢çš„è¾¹ç¼˜æ’å›¾é›†ã€‚</li><li><code>maximumContentWidth</code> å’Œ <code>maximumContentHeight</code> <em><code>CGFloat</code></em>ï¼šå¦‚æœæŒ‡å®šï¼Œå¯ä»¥è¿›ä¸€æ­¥çº¦æŸå†…å®¹åŒºåŸŸçš„å®½åº¦å’Œé«˜åº¦ã€‚</li></ul></blockquote><blockquote><p>è™½ç„¶ Apple çš„æ–‡æ¡£æ²¡æœ‰æ˜ç¡®è¯´æ˜ï¼Œä½†æ‰€æœ‰è¿™äº›å€¼éƒ½åŸºäºæ¯è‹±å¯¸ 72 ç‚¹ã€‚</p></blockquote><p>è¿™ä¸¤ä¸ªåŸºäºæ–‡æœ¬çš„æ‰“å°æ ¼å¼å°†åŒéœ€è¦æ ¼å¼åŒ–çš„æ–‡æœ¬ä¸€èµ·è¢«åˆå§‹åŒ–ã€‚<code>UISimpleTextPrintFormatter</code> å¯ä»¥å¤„ç†æ™®é€šæˆ–å±æ€§æ–‡æœ¬ï¼Œè€Œ <code>UIMarkupTextPrintFormatter</code> ç”¨å…¶ <code>markupText</code> å±æ€§å‘ˆç° HTML æ–‡æœ¬ã€‚è®©æˆ‘ä»¬å°è¯•é€šè¿‡æ ‡è®°æ ¼å¼å‘é€æˆ‘ä»¬ HTML ç‰ˆæœ¬çš„ç‘å£«ç”œèœèœè°±ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> formatter = UIMarkupTextPrintFormatter(markupText: htmlString)
</span></span><span style=display:flex><span>formatter.contentInsets = UIEdgeInsets(top: <span style=color:#ae81ff>72</span>, <span style=color:#66d9ef>left</span>: <span style=color:#ae81ff>72</span>, bottom: <span style=color:#ae81ff>72</span>, <span style=color:#66d9ef>right</span>: <span style=color:#ae81ff>72</span>) <span style=color:#75715e>// 1&#34; margins</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>printController.printFormatter = formatter
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>UIMarkupTextPrintFormatter <span style=color:#f92672>*</span>formatter <span style=color:#f92672>=</span> [[UIMarkupTextPrintFormatter alloc] initWithMarkupText:htmlString];
</span></span><span style=display:flex><span>formatter.contentInsets <span style=color:#f92672>=</span> UIEdgeInsetsMake(<span style=color:#ae81ff>72</span>, <span style=color:#ae81ff>72</span>, <span style=color:#ae81ff>72</span>, <span style=color:#ae81ff>72</span>); <span style=color:#75715e>// 1&#34; margins
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>printController.printFormatter <span style=color:#f92672>=</span> formatter;
</span></span></code></pre></div><p>ç»“æœå˜ï¼Ÿä¸€ä¸ªæ¼‚äº®çš„ HTML é¡µé¢ï¼š</p><p><img alt="ç”¨ UIMarkupTextPrintFormatter æ‰“å°" src=/media/NSHipster/uiprintinteractioncontroller-html-print.png></p><p>å¦ä¸€æ–¹é¢ï¼Œä½¿ç”¨ <code>UIViewPrintFormatter</code>ï¼Œä½ å¯ä»¥ä» <code>viewPrintFormatter</code> å±æ€§å¾—åˆ°ä¸€ä¸ªä½ æƒ³è¦æ‰“å°çš„è§†å›¾ã€‚ä¸‹é¢å°±æ¥çœ‹çœ‹æ ¼å¼åŒ–å¦‚ä½•æ ¼å¼å®ƒæ‰€æ”¯æŒçš„ä¸‰ä¸ªè§†å›¾çš„ï¼š</p><h4 id=1-uitextview>1) UITextView</h4><p><img alt="æ‰“å° UITextView" src=/media/NSHipster/uiprintinteractioncontroller-textview-print.png></p><h4 id=2-uiwebview>2) UIWebView</h4><p><img alt="æ‰“å° UIWebView" src=/media/NSHipster/uiprintinteractioncontroller-webview-print.png></p><h4 id=3-mkmapview>3) MKMapView</h4><p><img alt="æ‰“å° MKMapView" src=/media/NSHipster/uiprintinteractioncontroller-mapview-print.png></p><h2 id=uiprintpagerenderer>UIPrintPageRenderer</h2><p>å†…ç½®çš„æ ¼å¼åŒ–éƒ½å¾ˆå¥½ï¼Œä½†ä¸ºäº†å¯¹æ‰“å°é¡µé¢å®ç°<em>æœ€å¥½</em>çš„æ§åˆ¶ï¼Œä½ å¯ä»¥å®ç° <code>UIPrintPageRenderer</code> çš„ä¸€ä¸ªå­ç±»ã€‚åœ¨ä½ çš„å­ç±»é‡Œï¼Œä½ å¯ä»¥ç»“åˆæˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„æ‰“å°æ ¼å¼å’Œä½ è‡ªå®šä¹‰çš„ç»˜å›¾å‡½æ•°ä¸ºä½ çš„åº”ç”¨ç¨‹åºå†…å®¹åˆ›å»ºå‡ºè‰²çš„å¸ƒå±€ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ‰“å°é£Ÿè°±çš„å¦ä¸€ç§æ–¹å¼ï¼Œè¿™æ¬¡ä½¿ç”¨ç½‘é¡µæ¸²æŸ“å™¨æ¥æ·»åŠ é¡µçœ‰å’Œç»˜åˆ¶å›¾åƒæ—è¾¹çš„é…æ–¹æ–‡æœ¬ã€‚</p><p>åœ¨åˆå§‹åŒ–ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ‰“å°çš„æ•°æ®ä¿å­˜ä¸‹æ¥ï¼Œç„¶åè®¾ç½® <code>headerHeight</code>ï¼ˆé™¤éä½ è®¾ç½®å„è‡ªçš„é«˜åº¦ï¼Œå¦åˆ™é¡µçœ‰å’Œé¡µè„šçš„ç»˜å›¾æ–¹æ³•å°†ä¸ä¼šè¢«è°ƒç”¨ï¼‰ï¼Œå¹¶ä¸ºèœè°±çš„æ–‡å­—åˆ›å»ºä¸€ä¸ªæ ‡è®°æ–‡æœ¬æ ¼å¼ã€‚</p><blockquote><p>ä¸‹é¢ä¾‹å­çš„å®Œæ•´ Objective-C å’Œ Swift æºä»£ç <a href=https://gist.github.com/mattt/bd5e48ae461848cdbd1e>å¯ä»¥åœ¨ gist ä¸‹è½½</a>ã€‚</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RecipePrintPageRenderer</span>: UIPrintPageRenderer {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> authorName: String
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> recipe: Recipe
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>init</span>(authorName: String, recipe: Recipe) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.authorName = authorName
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.recipe = recipe
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.<span style=color:#66d9ef>init</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.headerHeight = <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>*</span> POINTS_PER_INCH
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.footerHeight = <span style=color:#ae81ff>0.0</span> <span style=color:#75715e>// default</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> formatter = UIMarkupTextPrintFormatter(markupText: recipe.html)
</span></span><span style=display:flex><span>        formatter.perPageContentInsets = UIEdgeInsets(top: POINTS_PER_INCH, <span style=color:#66d9ef>left</span>: POINTS_PER_INCH,
</span></span><span style=display:flex><span>            bottom: POINTS_PER_INCH, <span style=color:#66d9ef>right</span>: POINTS_PER_INCH <span style=color:#f92672>*</span> <span style=color:#ae81ff>3.5</span>)
</span></span><span style=display:flex><span>        addPrintFormatter(formatter, startingAtPageAtIndex: <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#66d9ef>@interface</span> <span style=color:#a6e22e>RecipePrintPageRenderer</span> : <span style=color:#a6e22e>UIPrintPageRenderer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>strong</span>) NSString <span style=color:#f92672>*</span>authorName;
</span></span><span style=display:flex><span><span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>strong</span>) Recipe <span style=color:#f92672>*</span>recipe;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- (<span style=color:#66d9ef>id</span>)<span style=color:#a6e22e>initWithAuthorName:</span>(NSString <span style=color:#f92672>*</span>)authorName
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>recipe:</span>(Recipe <span style=color:#f92672>*</span>)recipe;
</span></span><span style=display:flex><span><span style=color:#66d9ef>@end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@implementation</span> <span style=color:#a6e22e>RecipePrintPageRenderer</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- (<span style=color:#66d9ef>id</span>)<span style=color:#a6e22e>initWithAuthorName:</span>(NSString <span style=color:#f92672>*</span>)authorName
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>recipe:</span>(Recipe <span style=color:#f92672>*</span>)recipe
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (self <span style=color:#f92672>=</span> [super init]) {
</span></span><span style=display:flex><span>        self.authorName <span style=color:#f92672>=</span> authorName;
</span></span><span style=display:flex><span>        self.recipe <span style=color:#f92672>=</span> recipe;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self.headerHeight <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.5</span>;
</span></span><span style=display:flex><span>        self.footerHeight <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;  <span style=color:#75715e>// default
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        UIMarkupTextPrintFormatter <span style=color:#f92672>*</span>formatter <span style=color:#f92672>=</span> [[UIMarkupTextPrintFormatter alloc] initWithMarkupText:recipe.html];
</span></span><span style=display:flex><span>        formatter.perPageContentInsets <span style=color:#f92672>=</span> UIEdgeInsetsMake(POINTS_PER_INCH, POINTS_PER_INCH, POINTS_PER_INCH, POINTS_PER_INCH <span style=color:#f92672>*</span> <span style=color:#ae81ff>3.5</span>);
</span></span><span style=display:flex><span>        [self addPrintFormatter:formatter startingAtPageAtIndex:<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> self;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@end</span>
</span></span></code></pre></div><blockquote><p>å½“ä½ ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªæ‰“å°æ ¼å¼ä½œä¸ºè‡ªå®šä¹‰æ¸²æŸ“çš„ä¸€éƒ¨åˆ†ï¼ˆæ­£å¦‚æˆ‘ä»¬åœ¨è¿™é‡Œæ‰€åšçš„ä¸€æ ·ï¼‰ï¼ŒUIKit ä¼šæŸ¥è¯¢å®ƒä»¬çš„æ‰“å°é¡µæ•°ã€‚å¦‚æœä½ æ­£åœ¨åšçœŸæ­£çš„è‡ªå®šä¹‰é¡µé¢å¸ƒå±€ï¼Œå¯ä»¥å®ç° <code>numberOfPages()</code> æ–¹æ³•æ¥æä¾›æ­£ç¡®çš„å€¼ã€‚</p></blockquote><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é‡å†™ <code>drawHeaderForPageAtIndex(:inRect:)</code> æ¥ç»˜åˆ¶æˆ‘ä»¬çš„è‡ªå®šä¹‰æ ‡é¢˜ã€‚é—æ†¾çš„æ˜¯ï¼Œæ‰“å°æ ¼å¼çš„é‚£äº›æ–¹ä¾¿çš„ä¸ºæ¯ä¸ªé¡µé¢å†…å®¹è®¾ç½®æ’å›¾çš„åŠŸèƒ½åœ¨è¿™å„¿éƒ½æ²¡æœ‰äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦æ’å…¥ <code>headerRect</code> å‚æ•°æ¥é€‚åº”è¾¹è·ï¼Œç„¶åç®€å•åœ°ç»˜åˆ¶åˆ°å½“å‰çš„å›¾å½¢ä¸Šä¸‹æ–‡ä¸­ã€‚è¿˜æœ‰ä¸€ä¸ªç±»ä¼¼çš„ <code>drawFooterForPageAtIndex(:inRect:)</code> æ–¹æ³•æ¥ç»˜åˆ¶é¡µè„šã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>drawHeaderForPageAtIndex</span>(pageIndex: Int, <span style=color:#66d9ef>var</span> inRect headerRect: CGRect) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> headerInsets = UIEdgeInsets(top: CGRectGetMinY(headerRect), <span style=color:#66d9ef>left</span>: POINTS_PER_INCH, bottom: CGRectGetMaxY(paperRect) <span style=color:#f92672>-</span> CGRectGetMaxY(headerRect), <span style=color:#66d9ef>right</span>: POINTS_PER_INCH)
</span></span><span style=display:flex><span>    headerRect = UIEdgeInsetsInsetRect(paperRect, headerInsets)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// author name on left</span>
</span></span><span style=display:flex><span>    authorName.drawAtPointInRect(headerRect, withAttributes: nameAttributes, andAlignment: .LeftCenter)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// page number on right</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> pageNumberString: NSString = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>\(</span>pageIndex <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    pageNumberString.drawAtPointInRect(headerRect, withAttributes: pageNumberAttributes, andAlignment: .RightCenter)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>drawHeaderForPageAtIndex:</span>(NSInteger)index
</span></span><span style=display:flex><span>                          <span style=color:#a6e22e>inRect:</span>(CGRect)headerRect
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    UIEdgeInsets headerInsets <span style=color:#f92672>=</span> UIEdgeInsetsMake(CGRectGetMinY(headerRect), POINTS_PER_INCH, CGRectGetMaxY(self.paperRect) <span style=color:#f92672>-</span> CGRectGetMaxY(headerRect), POINTS_PER_INCH);
</span></span><span style=display:flex><span>    headerRect <span style=color:#f92672>=</span> UIEdgeInsetsInsetRect(self.paperRect, headerInsets);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// author name on left
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    [self.authorName drawAtPointInRect:headerRect withAttributes:self.nameAttributes andAlignment:NCStringAlignmentLeftCenter];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// page number on right
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NSString <span style=color:#f92672>*</span>pageNumberString <span style=color:#f92672>=</span> [NSString stringWithFormat:<span style=color:#e6db74>@&#34;%ld&#34;</span>, index <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>    [pageNumberString drawAtPointInRect:headerRect withAttributes:self.pageNumberAttributes andAlignment:NCStringAlignmentRightCenter];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æœ€åï¼Œè®©æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª <code>drawContentForPageAtIndex(:inRect:)</code>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>drawContentForPageAtIndex</span>(pageIndex: Int, inRect contentRect: CGRect) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> pageIndex == <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// only use rightmost two inches of contentRect</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> imagesRectWidth = POINTS_PER_INCH <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> imagesRectHeight = paperRect.height <span style=color:#f92672>-</span> POINTS_PER_INCH <span style=color:#f92672>-</span> (CGRectGetMaxY(paperRect) <span style=color:#f92672>-</span> CGRectGetMaxY(contentRect))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> imagesRect = CGRect(x: CGRectGetMaxX(paperRect) <span style=color:#f92672>-</span> imagesRectWidth <span style=color:#f92672>-</span> POINTS_PER_INCH, y: paperRect.origin.y <span style=color:#f92672>+</span> POINTS_PER_INCH, width: imagesRectWidth, height: imagesRectHeight)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        drawImages(recipe.images, inRect: imagesRect)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>drawContentForPageAtIndex:</span>(NSInteger)pageIndex
</span></span><span style=display:flex><span>                           <span style=color:#a6e22e>inRect:</span>(CGRect)contentRect
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (pageIndex <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// only use rightmost two inches of contentRect
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        CGFloat imagesRectWidth <span style=color:#f92672>=</span> POINTS_PER_INCH <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>        CGFloat imagesRectHeight <span style=color:#f92672>=</span> CGRectGetHeight(self.paperRect) <span style=color:#f92672>-</span> POINTS_PER_INCH <span style=color:#f92672>-</span> (CGRectGetMaxY(self.paperRect) <span style=color:#f92672>-</span> CGRectGetMaxY(contentRect));
</span></span><span style=display:flex><span>        CGRect imagesRect <span style=color:#f92672>=</span> CGRectMake(CGRectGetMaxX(self.paperRect) <span style=color:#f92672>-</span> imagesRectWidth <span style=color:#f92672>-</span> POINTS_PER_INCH, CGRectGetMinY(self.paperRect) <span style=color:#f92672>+</span> POINTS_PER_INCH, imagesRectWidth, imagesRectHeight);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        [self drawImages:self.recipe.images inRect:imagesRect];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å½“æˆ‘ä»¬çš„è‡ªå®šä¹‰é¡µé¢çš„æ¸²æŸ“å®ç°å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªå®ä¾‹ä½œä¸ºæ‰“å°äº¤äº’æ§åˆ¶å™¨ä¸Šçš„ <code>pageRenderer</code> å±æ€§ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å‡†å¤‡è¿›è¡Œæ‰“å°äº†ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> renderer = RecipePrintPageRenderer(authorName: <span style=color:#e6db74>&#34;Nate Cook&#34;</span>, recipe: selectedRecipe)
</span></span><span style=display:flex><span>printController.printPageRenderer = renderer
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>RecipePrintPageRenderer <span style=color:#f92672>*</span>renderer <span style=color:#f92672>=</span> [[RecipePrintPageRenderer alloc] initWithAuthorName:<span style=color:#e6db74>@&#34;Nate Cook&#34;</span> recipe:selectedRecipe];
</span></span><span style=display:flex><span>printController.printPageRenderer <span style=color:#f92672>=</span> renderer;
</span></span></code></pre></div><p>æœ€åçš„ç»“æœæ¯”ä»»ä½•å†…ç½®æ ¼å¼éƒ½è¦å¥½å¾—å¤šã€‚</p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯èœè°±çš„æ–‡æœ¬æ˜¯ç”±ä¸€ä¸ª <code>UIMarkupTextPrintFormatter</code> æ¥æ ¼å¼åŒ–çš„ï¼Œç„¶è€Œé¡µçœ‰å’Œå›¾åƒåˆ™é€šè¿‡è‡ªå®šä¹‰ä»£ç ç»˜åˆ¶ã€‚</p></blockquote><p><img alt="ç”¨ UIPrintPageRenderer å­ç±»æ‰“å°" src=/media/NSHipster/uiprintinteractioncontroller-renderer-print.png></p><h2 id=é€šè¿‡å…±äº«è¡¨å•æ‰“å°>é€šè¿‡å…±äº«è¡¨å•æ‰“å°</h2><p>æœ‰äº†ä¸Šé¢è¿™äº›æˆ‘ä»¬å·²ç»å­¦ä¼šäº†çš„å·¥å…·ï¼Œåœ¨å…±äº«è¡¨å•é‡Œæ·»åŠ æ‰“å°åŠŸèƒ½ä¹Ÿå¾ˆç®€å•ã€‚æˆ‘ä»¬æŠŠé…ç½®çš„ <code>UIPrintInfo</code> å’Œæ‰“å°é¡¹ç›®åŠæ ¼å¼æ¥æ˜¾ç¤ºæˆ–æ¸²æŸ“åˆ° <code>UIActivityViewController</code> æ¥æ˜¾ç¤ºæ‰“å° UIï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>UIPrintInteractionController</code> æ¥å‘ˆç°ã€‚å¦‚æœç”¨æˆ·åœ¨å…±äº«è¡¨å•é‡Œé€‰æ‹©äº†<em>æ‰“å°</em>æŒ‰é’®ï¼Œæ‰“å°ç•Œé¢å°†å®Œå¥½çš„æ˜¾ç¤ºæˆ‘ä»¬æ‰€æœ‰çš„é…ç½®ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>@IBAction</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>openShareSheet</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> printInfo = ...
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> formatter = ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> activityItems = [printInfo, formatter, textView.attributedText]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> activityController = UIActivityViewController(activityItems: activityItems, applicationActivities: <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>    presentViewController(activityController, animated: <span style=color:#66d9ef>true</span>, completion: <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>- (<span style=color:#66d9ef>IBAction</span>)<span style=color:#a6e22e>openShareSheet:</span>(<span style=color:#66d9ef>id</span>)sender {
</span></span><span style=display:flex><span>    UIPrintInfo <span style=color:#f92672>*</span>printInfo <span style=color:#f92672>=</span> ...
</span></span><span style=display:flex><span>    UISimpleTextPrintFormatter <span style=color:#f92672>*</span>formatter <span style=color:#f92672>=</span> ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    NSArray <span style=color:#f92672>*</span>activityItems <span style=color:#f92672>=</span> <span style=color:#ae81ff>@[</span>printInfo, formatter, self.textView.attributedText<span style=color:#ae81ff>]</span>;
</span></span><span style=display:flex><span>    UIActivityViewController <span style=color:#f92672>*</span>activityController <span style=color:#f92672>=</span> [[UIActivityViewController alloc] initWithActivityItems:activityItems applicationActivities:nil];
</span></span><span style=display:flex><span>    [self presentViewController:activityController animated:YES completion:nil];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>è™½ç„¶ <code>UIPrintInfo</code> ä»¥åŠ <code>UIPrintFormatter</code> å’Œ <code>UIPrintPageRenderer</code> çš„å­ç±»å¯ä»¥ä½œä¸ºæ´»åŠ¨ä¼ é€’åˆ° <code>UIActivityViewController</code>ï¼Œä½†ä»–ä»¬éƒ½ä¸ç¬¦åˆ <code>UIActivityItemSource</code> åè®®ï¼Œæ‰€ä»¥ä½ ä¼šåœ¨æ§åˆ¶å°çœ‹åˆ°ä¸€ä¸ª &ldquo;Unknown activity items.&rdquo; çš„ï¼ˆæ— å®³ï¼‰è­¦å‘Šã€‚</p></blockquote><h2 id=è·³è¿‡æ‰“å°--ui>è·³è¿‡æ‰“å° UI</h2><p>åœ¨æ–°çš„ iOS 8 é‡Œï¼Œæœ‰ä¸€ç§æ–¹å¼å¯ä»¥åœ¨æ²¡æœ‰ä»»ä½• UI å±•ç¤ºçš„æƒ…å†µä¸‹æ‰“å°ã€‚ä¸å¿…åœ¨ç”¨æˆ·æ¯æ¬¡æŒ‰ä¸‹æ‰“å°æŒ‰é’®æ—¶å‘ˆç° UIï¼Œä½ å¯ä»¥ç”¨å¥½ç”¨çš„ <code>UIPrinterPickerController</code> åœ¨åº”ç”¨ç¨‹åºä¸­ä¸ºä½ çš„ç”¨æˆ·åœ¨æŸä¸ªåœ°æ–¹é€‰æ‹©ä¸€å°æ‰“å°æœºæä¾›ä¸€ç§æ–¹æ³•ã€‚å®ƒçš„æ„é€ æ–¹æ³•æ¥å—å¯é€‰çš„ <code>UIPrinter</code> å®ä¾‹ä½œä¸ºä¸€ä¸ªé¢„é€‰ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šé¢è§£é‡Šè¿‡çš„ç›¸åŒçš„å±•ç¤ºé€‰é¡¹ï¼Œå¹¶ä¸”å½“ç”¨æˆ·é€‰æ‹©äº†æ‰“å°æœºåè¿˜æœ‰ä¸€ä¸ªå®Œæˆå›è°ƒï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> printerPicker = UIPrinterPickerController(initiallySelectedPrinter: savedPrinter)
</span></span><span style=display:flex><span>printerPicker.presentAnimated(<span style=color:#66d9ef>true</span>) {
</span></span><span style=display:flex><span>    (printerPicker, userDidSelect, error) <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> userDidSelect {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.savedPrinter = printerPicker.selectedPrinter
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>UIPrinterPickerController <span style=color:#f92672>*</span>printPicker <span style=color:#f92672>=</span> [UIPrinterPickerController printerPickerControllerWithInitiallySelectedPrinter:self.savedPrinter];
</span></span><span style=display:flex><span>[printPicker presentAnimated:YES completionHandler:
</span></span><span style=display:flex><span>    <span style=color:#f92672>^</span>(UIPrinterPickerController <span style=color:#f92672>*</span>printerPicker, <span style=color:#66d9ef>BOOL</span> userDidSelect, NSError <span style=color:#f92672>*</span>error) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (userDidSelect) {
</span></span><span style=display:flex><span>        self.savedPrinter <span style=color:#f92672>=</span> printerPicker.selectedPrinter;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}];
</span></span></code></pre></div><p>ç°åœ¨ï¼Œä½ å¯ä»¥è®©ä½ çš„ <code>UIPrintInteractionController</code> è°ƒç”¨ <code>printToPrinter(:completionHandler:)</code> æ¥ä½¿ç”¨å·²ä¿å­˜çš„æ‰“å°æœºè€Œä¸æ˜¯è°ƒç”¨æŸä¸€ä¸ª <code>present...</code> æ–¹æ³•æ¥ç›´æ¥æ‰“å°äº†ã€‚</p><hr><p>æœ€åæœ‰ä¸€ä¸ªå»ºè®®ï¼Œè€ƒè™‘åˆ°ä½ å¯èƒ½ä¼šåœ¨æ‰“å°é¡µé¢ä¸ä½ çš„å†…å®¹è¿›è¡ŒæŸç§æ–¹å¼çš„äº¤äº’ã€‚åœ¨ä½ ä»”ç»†æ£€æŸ¥å­—ä½“å¤§å°å’Œé‡é‡æˆ–æ˜¯å±å¹•ä¸Šå…ƒç´ ä¹‹é—´çš„å·®å¼‚çš„åŒæ—¶ï¼ŒåŒæ ·éœ€è¦ç¡®ä¿<em>åœ¨çº¸å¼ ä¸Š</em>æµ‹è¯•ä½ çš„æ‰“å°å¸ƒå±€ - å¦å¤–ï¼Œå¤§å°å’Œè¾¹è·éƒ½åº”è¯¥æœ€å¥½ä½¿ç”¨é€‚ä¸­çš„å€¼ã€‚</p><hr><p>é™¤é<a href=https://nshipster.cn/ target=_blank>å¦æœ‰å£°æ˜</a>ï¼Œæœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ã€Œ<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 3.0 ä¸­å›½å¤§é™†</a>ã€è®¸å¯åè®®æˆæƒã€‚</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top Â· å›é¡¶éƒ¨" rel=nofollow>&#127772;2014-11-17 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2026 Nate Cook ç‰ˆæƒæ‰€æœ‰</a><a href=https://autoptr.top/ title="Back to Home Â· å›é¦–é¡µ">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>æ ‡ç­¾:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>åˆ†ç±»:</span><li><a class=link href=https://autoptr.top/categories/Cocoa target=_blank>Cocoa</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>