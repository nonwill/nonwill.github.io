<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>Benchmarking</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="Benchmarking,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="Benchmarking,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"ğŸŒœ"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>Benchmarking</span><span class=btRight><span title="Author Â· ä½œè€…" class=author>Mattt</span> <span title="Translator Â· ç¿»è¯‘" class=author>Croath Liu</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post Â· å…³è”æˆ–è½¬è½½å¼•ç”¨çš„æ–‡ç« " target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics Â· å›ä¸»é¢˜é¡µ">&#127793;</a></span></h1><p>å¯¹äºå®Œæˆæœ‰æ„ä¹‰çš„å·¥ä½œæ¥è¯´æŠ½è±¡å¾ˆé‡è¦ï¼Œä½†å´ä¼šå¸¦æ¥å‰¯ä½œç”¨ã€‚ä¸ºäº†å·¥ä½œèµ·æ¥æ›´é¡ºæ‰‹æˆ‘ä»¬éœ€è¦æ´å¯Ÿä¸€äº›ç»†ææœ«èŠ‚æ¥ç¡®å®šä¸€äº›æ‰¹é‡å¤„ç†çš„å…·ä½“é€»è¾‘ã€‚æ‰¾åˆ°ä¸€ä¸ªç‰¹å®šä¸Šä¸‹æ–‡çš„æœ‰ç”¨ä¿¡æ¯æ˜¯éå¸¸é‡è¦çš„ï¼Œæ˜¯å…·æœ‰æŒ‘æˆ˜æ€§çš„ï¼Œæ˜¯é«˜æ•ˆç¼–ç¨‹çš„æ ¸å¿ƒã€‚</p><p>åˆ©ç”¨benchmarkingï¼Œå·¥ç¨‹å¸ˆå¯ä»¥æ­å¼€ä»–ä»¬ä»£ç ä¸­è¿è¡Œæ•ˆç‡çš„é¢çº±ï¼Œç„¶ååˆ©ç”¨è·å¾—çš„ä¿¡æ¯æ¥ä¼˜åŒ–ã€‚è¿™å¯¹äºæ¯ä¸€ä½æƒ³è®©appè¿è¡Œæ›´å¿«çš„å·¥ç¨‹å¸ˆï¼ˆæˆ–è€…è¯´æ¯ä¸€ä¸ªè‡ªé‡çš„å·¥ç¨‹å¸ˆï¼‰æ¥è¯´éƒ½æ˜¯å¿…å¤‡å·¥å…·ã€‚</p><hr><p>â€œbenchmarkâ€è¿™ä¸ªè¯å¯ä»¥è¿½æº¯åˆ°19ä¸–çºªã€‚å®ƒçš„æœ¬æ„æ˜¯ï¼Œä¸€ä¸ª benchmark å°±æ˜¯ä¸€ä¸ªä¸€ç§æŠŠçŸ³å¤´åˆ‡å‰²æˆå¹³æ¿çš„åˆ‡åˆ€æˆ–ç”¨æ¥æµ‹é‡çš„æ”¯æ¶ã€‚åæ¥è¿™ä¸ªè¯çš„â€œæµ‹é‡ä¸œè¥¿çš„æ ‡å‡†â€çš„æ¯”å–»ä¹‰è¢«åº”ç”¨åˆ°å„ç§é¢†åŸŸäº†ã€‚</p><p>åœ¨ç¼–ç¨‹ä¸­ï¼Œ <em>benchmark</em> å’Œ <em>benchmarking</em> ç•¥å¾®æœ‰è¯­ä¹‰ä¸Šçš„åŒºåˆ«ï¼š</p><p><em>benchmark</em> æ˜¯ç¨‹åºæ˜ç¡®åœ°è¦æµ‹é‡å¹¶æ¯”è¾ƒç¡¬ä»¶ä»¥åŠè½¯ä»¶ä¸Šçš„è¿è¡Œæ•ˆç‡ã€‚ç›¸å¯¹æ¥è¯´ <em>benchmarking</em> è¡¨ç¤ºçš„åˆ™æ˜¯æµ‹é‡æ•ˆç‡çš„ä¸€æ®µä»£ç ã€‚</p><h2 id=objective-c-ä¸­ä½¿ç”¨-benchmarking-æµ‹é‡æ•ˆç‡>Objective-C ä¸­ä½¿ç”¨ Benchmarking æµ‹é‡æ•ˆç‡</h2><p>Benchmarkåº”è¯¥å’Œå…¶ä»–è®¤çŸ¥è®ºæœ‰ä¸€æ ·çš„è§„å¾‹å¯éµå¾ªï¼Œåƒç»Ÿè®¡é‡é‚£æ ·çš„ç§‘å­¦æ–¹æ³•ä¸€æ ·æœ‰é€šç”¨çš„ç†è§£ã€‚</p><p>ç§‘å­¦æ–¹æ³•æ¶µç›–äº†ä¸€ç³»åˆ—çš„é€»è¾‘æ­¥éª¤æ¥æ¨æ¼”é—®é¢˜ï¼š</p><ol><li>æå‡ºé—®é¢˜</li><li>æ„é€ å‡è¯´</li><li>é¢„æœŸç»“æœ</li><li>éªŒè¯å‡è¯´</li><li>åˆ†æç»“æœ</li></ol><p>å½“åº”ç”¨åˆ°ç¼–ç¨‹æ—¶ï¼Œä¸€èˆ¬æ¥è¯´ä¼šæå‡ºä¸¤ç±»é—®é¢˜ï¼š</p><ul><li>**è¿™æ®µä»£ç çš„ <em>ç»å¯¹</em> æ•ˆç‡æ˜¯å¤šå°‘ï¼Ÿ**è¾¾åˆ°äº†è®¡ç®—åŠ›å’Œå†…å­˜çš„ä¸Šé™äº†å—ï¼Ÿåº”ç”¨ä¸åŒæ ·æœ¬å¤§å°æ—¶çš„<a href=https://en.wikipedia.org/wiki/Big_O_notation>ç“¶é¢ˆæ“ä½œ</a>æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>**è¿™æ®µä»£ç çš„ <em>ç›¸å¯¹</em> æ•ˆç‡æ˜¯å¤šå°‘ï¼Ÿ**æ–¹æ³• A å’Œ æ–¹æ³• B å“ªä¸ªæ›´å¿«ï¼Ÿ</li></ul><p>å› ä¸ºä»æ“ä½œç³»ç»Ÿæœ¬èº«çš„ä¸€åˆ‡åŸºæœ¬å› ç´ éƒ½æ˜¯å¯å˜æ€§éå¸¸å¼ºçš„ï¼Œæ€§èƒ½åº”è¯¥é€šè¿‡å¤§é‡çš„è¯•éªŒæ¥æµ‹é‡ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œæ ·æœ¬æ•°é‡åœ¨ 10<sup>5</sup> åˆ° 10<sup>8</sup> ç›´æ¥æ˜¯åˆç†çš„ã€‚</p><h3 id=ç¬¬ä¸€å‘cfabsolutetimegetcurrent>ç¬¬ä¸€å‘ï¼šCFAbsoluteTimeGetCurrent</h3><p>è¿™é‡Œä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹ä¸€çœ‹å‘å¯å˜æ•°ç»„ä¸­æ·»åŠ å…ƒç´ çš„æ•ˆç‡ã€‚</p><p>ä¸ºäº†å»ºç«‹ benchmarkï¼Œæˆ‘ä»¬æŒ‡å®šä¸€ä¸ª <code>count</code> è¡¨ç¤ºæœ‰å¤šå°‘ä¸ªå…ƒç´ éœ€è¦æ·»åŠ ï¼Œ<code>iterations</code> è¡¨ç¤ºè¿™ä¸ªæµ‹è¯•è¦è¿è¡Œå¤šå°‘æ¬¡ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#66d9ef>static</span> size_t <span style=color:#66d9ef>const</span> count <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> size_t <span style=color:#66d9ef>const</span> iterations <span style=color:#f92672>=</span> <span style=color:#ae81ff>10000</span>;
</span></span></code></pre></div><p>å› ä¸ºæˆ‘ä»¬ä¸éœ€è¦æµ‹è¯•ç”³è¯·å†…å­˜çš„æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ benchmark å¤–éƒ¨åªå£°æ˜ä¸€æ¬¡è¦æ·»åŠ è¿›æ•°ç»„çš„å…ƒç´ ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#66d9ef>id</span> object <span style=color:#f92672>=</span> <span style=color:#e6db74>@&#34;ğŸ·&#34;</span>;
</span></span></code></pre></div><p>åšè¿™ä¸ª benchmarking å¾ˆç®€å•ï¼šä»£ç è¿è¡Œå‰è®°å½•ä¸€æ¬¡æ—¶é—´ï¼Œè¿è¡Œåè®°å½•ä¸€æ¬¡ï¼Œç„¶åæ¯”è¾ƒæ—¶é—´å·®ã€‚ä½ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½¿ç”¨ åŒ…è£…äº† <code>mach_absolute_time</code> çš„ <code>CACurrentMediaTime()</code> æ–¹æ³•æ¥ä»¥ç§’ä¸ºå•ä½æµ‹é‡æ—¶é—´ã€‚</p><blockquote><p>å’Œ <code>NSDate</code> æˆ– <code>CFAbsoluteTimeGetCurrent()</code> åç§»é‡ä¸åŒçš„æ˜¯ï¼Œ<code>mach_absolute_time()</code> å’Œ <code>CACurrentMediaTime()</code> æ˜¯åŸºäºå†…å»ºæ—¶é’Ÿçš„ï¼Œèƒ½å¤Ÿæ›´ç²¾ç¡®æ›´åŸå­åŒ–åœ°æµ‹é‡ï¼Œå¹¶ä¸”ä¸ä¼šå› ä¸ºå¤–éƒ¨æ—¶é—´å˜åŒ–è€Œå˜åŒ–ï¼ˆä¾‹å¦‚æ—¶åŒºå˜åŒ–ã€å¤æ—¶åˆ¶ã€ç§’çªå˜ç­‰ï¼‰</p></blockquote><p><code>for</code> å¾ªç¯ç”¨æ¥è®© <code>count</code> å’Œ <code>iterations</code> é€’å¢ã€‚æ¯ä¸ªå¾ªç¯ä½“éƒ½è¢« <code>@autoreleasepool</code> åŒ…è£¹ï¼Œç”¨æ¥é™ä½å†…å­˜å ç”¨ã€‚</p><p>é‚£ä¹ˆå…·ä½“çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>CFTimeInterval startTime <span style=color:#f92672>=</span> CACurrentMediaTime();
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (size_t i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> iterations; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>@autoreleasepool</span> {
</span></span><span style=display:flex><span>            NSMutableArray <span style=color:#f92672>*</span>mutableArray <span style=color:#f92672>=</span> [NSMutableArray array];
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (size_t j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; j <span style=color:#f92672>&lt;</span> count; j<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                [mutableArray addObject:object];
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>CFTimeInterval endTime <span style=color:#f92672>=</span> CACurrentMediaTime();
</span></span><span style=display:flex><span>NSLog(<span style=color:#e6db74>@&#34;Total Runtime: %g s&#34;</span>, endTime <span style=color:#f92672>-</span> startTime);
</span></span></code></pre></div><blockquote><p>è¿™ä¸ªä¾‹å­ä¸­ <code>startTime</code> å’Œ <code>endTime</code> ä¹‹é—´çš„ block ä»£ç æ˜¯ä¸å¿…è¦çš„ï¼Œåªæ˜¯ä¸ºäº†æé«˜å¯è¯»æ€§ï¼Œè®©ä»£ç çœ‹èµ·æ¥æ›´æ¸…æ™°æ˜äº†ï¼šå¾ˆå®¹æ˜“èƒ½åˆ†éš”å¼€å˜é‡ä¼šå‘ç”Ÿå¤§è§„æ¨¡çªå˜çš„ä»£ç </p></blockquote><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ çš„ NSHipster ç¬¬å…­æ„Ÿè‚¯å®šå—…åˆ°äº†ä»€ä¹ˆ â€œè‚¯å®šæœ‰æ›´å¥½æ›´é«˜ç«¯çš„æ–¹æ³•å§ï¼â€</p><p>ç›¸ä¿¡çš„ä½ ç›´è§‰æ˜¯ä»¶å¥½äº‹ã€‚</p><p>ä¸‹é¢ï¼Œè¯·å…è®¸æˆ‘å‘ä½ ä»‹ç» <code>dispatch_benchmark</code>ã€‚</p><h3 id=ç¬¬äºŒå‘dispatch_benchmark>ç¬¬äºŒå‘ï¼šdispatch_benchmark</h3><p><code>dispatch_benchmark</code> æ˜¯ <a href=http://libdispatch.macosforge.org><code>libdispatch</code> (Grand Central Dispatch)</a> çš„ä¸€éƒ¨åˆ†ã€‚ä½†ä¸¥è‚ƒåœ°è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å¹¶æ²¡æœ‰è¢«å…¬å¼€å£°æ˜ï¼Œæ‰€ä»¥ä½ å¿…é¡»è¦è‡ªå·±å£°æ˜ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#66d9ef>extern</span> uint64_t <span style=color:#a6e22e>dispatch_benchmark</span>(size_t count, <span style=color:#66d9ef>void</span> (<span style=color:#f92672>^</span>block)(<span style=color:#66d9ef>void</span>));
</span></span></code></pre></div><p>å› ä¸ºæ²¡æœ‰å…¬å¼€çš„å‡½æ•°å®šä¹‰ï¼Œ <code>dispatch_benchmark</code> åœ¨ Xcode ä¸­ä¹Ÿæ²¡æœ‰å…¬å¼€çš„æ–‡æ¡£ã€‚ä½†å¹¸è¿çš„æ˜¯æœ‰ man é¡µé¢ï¼š</p><blockquote><p>è¯‘è€…æŒ‰ï¼šä¸‹é¢è¿™æ®µ man ä¸ç¿»è¯‘äº†ï¼Œä½ åº”è¯¥è‡ªå·±çœ‹æ‡‚æ‰€æœ‰çš„ manï¼Œå®Œæ•´çš„ man å†…å®¹çœ‹<a href=http://opensource.apple.com/source/libdispatch/libdispatch-339.90.1/man/dispatch_benchmark.3>è¿™é‡Œ</a></p></blockquote><h4 id=man-dispatch_benchmark3>man <code>dispatch_benchmark(3)</code></h4><blockquote><p>The <code>dispatch_benchmark</code> function executes the given <code>block</code> multiple times according to the <code>count</code> variable and then returns the average number of nanoseconds per execution. This function is for debugging and performance analysis work. For the best results, pass a high count value to <code>dispatch_benchmark</code>.</p><p>Please look for inflection points with various data sets and keep the following facts in mind:</p><ul><li>Code bound by computational bandwidth may be inferred by proportional
changes in performance as concurrency is increased.</li><li>Code bound by memory bandwidth may be inferred by negligible changes in
performance as concurrency is increased.</li><li>Code bound by critical sections may be inferred by retrograde changes in
performance as concurrency is increased.<ul><li>Intentional: locks, mutexes, and condition variables.</li><li>Accidental: unrelated and frequently modified data on the same cache-line.</li></ul></li></ul></blockquote><p>å¦‚æœä½ ç•¥è¿‡äº†è¿™äº›æ–‡æ¡£ï¼Œé‚£ä¹ˆå°±è¯·ä¸€å®šå†è¯»ä¸€éâ€”â€”è¿™äº›æ–‡æ¡£éå¸¸æœ‰ç”¨ã€‚ä¸ºäº†æ›´å¥½åœ°è¯´æ˜è¿™ä¸ªå‡½æ•°çš„ç”¨æ³•ï¼Œæ–‡æ¡£è¿˜å†™äº†éå¸¸æœ‰æŒ‡å¯¼æ„ä¹‰çš„æŒ‡å—ã€‚</p><p>ä¹‹å‰é‚£ä¸ªä¾‹å­å¦‚æœæˆ‘ä»¬ç”¨ <code>dispatch_benchmark</code> æ¥å†™ä¼šé•¿æˆè¿™ä¸ªæ ·å­ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>uint64_t t <span style=color:#f92672>=</span> dispatch_benchmark(iterations, <span style=color:#f92672>^</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>@autoreleasepool</span> {
</span></span><span style=display:flex><span>        NSMutableArray <span style=color:#f92672>*</span>mutableArray <span style=color:#f92672>=</span> [NSMutableArray array];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (size_t i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> count; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            [mutableArray addObject:object];
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>NSLog(<span style=color:#e6db74>@&#34;[[NSMutableArray array] addObject:] Avg. Runtime: %llu ns&#34;</span>, t);
</span></span></code></pre></div><p>çœ‹åˆ°äº†å§ï¼Œå¥½å¤šäº†å§ã€‚ç›¸æ¯”ä¹‹å‰çš„ç§’è®¡æ—¶ï¼Œæ¯«å¾®ç§’æ›´åŠ ç²¾ç¡®ï¼Œ<code>dispatch_benchmark</code> ä¹Ÿæ¯”æ‰‹åŠ¨å†™å¾ªç¯çš„ <code>CFAbsoluteTimeGetCurrent()</code> è¯­æ³•ç»“æ„ä¸Šçœ‹èµ·æ¥æ›´å¥½ã€‚</p><h3 id=nsmutablearray-array-å¯¹å†³-arraywithcapacity>NSMutableArray array å¯¹å†³ arrayWithCapacity:ï¼</h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“äº†ç”¨ Objective-C ç›´æ¥è¿è¡Œä¸€ä¸ª benchmark çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæ¥åšä¸€ä¸ªæ¯”è¾ƒé€Ÿåº¦çš„æµ‹è¯•å§ã€‚</p><p>è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬ä¾æ—§æ¥è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼šâ€œä¼ å…¥ capacity å‚æ•°å’Œç›´æ¥åˆå§‹åŒ–æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿâ€ï¼Œæˆ–è€…æ›´ç›´æ¥ä¸€ç‚¹ï¼šâ€œç”¨ <code>-arrayWithCapacity:</code> è¿˜æ˜¯ä¸ç”¨ï¼ˆï¼Œè¿™æ˜¯ä¸ªé—®é¢˜ï¼‰â€ã€‚</p><p>ä¸€èµ·æ¥çœ‹çœ‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>uint64_t t_0 <span style=color:#f92672>=</span> dispatch_benchmark(iterations, <span style=color:#f92672>^</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>@autoreleasepool</span> {
</span></span><span style=display:flex><span>        NSMutableArray <span style=color:#f92672>*</span>mutableArray <span style=color:#f92672>=</span> [NSMutableArray array];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (size_t i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> count; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            [mutableArray addObject:object];
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>NSLog(<span style=color:#e6db74>@&#34;[[NSMutableArray array] addObject:] Avg. Runtime: %llu ns&#34;</span>, t_0);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>uint64_t t_1 <span style=color:#f92672>=</span> dispatch_benchmark(iterations, <span style=color:#f92672>^</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>@autoreleasepool</span> {
</span></span><span style=display:flex><span>        NSMutableArray <span style=color:#f92672>*</span>mutableArray <span style=color:#f92672>=</span> [NSMutableArray arrayWithCapacity:count];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (size_t i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> count; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            [mutableArray addObject:object];
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>NSLog(<span style=color:#e6db74>@&#34;[[NSMutableArray arrayWithCapacity] addObject:] Avg. Runtime: %llu ns&#34;</span>, t_1);
</span></span></code></pre></div><h4 id=ç»“æœ>ç»“æœ</h4><p>æµ‹è¯•è¿è¡Œåœ¨ æ­è½½ iOS 7.1 çš„ iPhone æ¨¡æ‹Ÿå™¨ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><pre tabindex=0><code>[[NSMutableArray array] addObject:]: Avg. Runtime 26119 ns
[[NSMutableArray arrayWithCapacity] addObject:] Avg. Runtime: 24158 ns
</code></pre><p>ç»è¿‡å¤§è§„æ¨¡æ ·æœ¬çš„æµ‹è¯•ï¼Œç”¨ capacity ä¸å¦é€ æˆäº† 7% çš„æ•ˆç‡å·®å¼‚ã€‚</p><p>è™½ç„¶ç»“æœæ²¡ä»€ä¹ˆæœ‰äº‰è®®çš„åœ°æ–¹ï¼ˆæˆ‘ä»¬çš„ benchmark å®Œç¾åœ°å·¥ä½œäº†ï¼‰ï¼ŒçœŸæ­£é‡è¦çš„æ˜¯è§£é‡Šè¿™ä¸ªç»“æœäº§ç”Ÿçš„åŸå› ã€‚é”™è¯¯çš„æƒ³æ³•æ˜¯ï¼šé€šè¿‡ benchmark æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼Œç”¨ capacity å‚æ•°æ¥åˆå§‹åŒ–æ˜¯æœ€ä½³é€‰æ‹©ã€‚æ­£ç¡®æƒ³æ³•åº”è¯¥æ˜¯ï¼šè¿™ä¸ª benchmark çš„ç»“æœæç¤ºæˆ‘ä»¬åº”è¯¥ç»§ç»­æå‡ºé—®é¢˜ï¼š</p><ul><li><strong>è¿™äº›æ•ˆç‡æ¶ˆè€—æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ</strong> ä¸ºäº†é¿å…å‡ºç°<a href=http://c2.com/cgi/wiki?PrematureOptimization>ä¸å½“ä¼˜åŒ–</a>ï¼Œæƒ³æƒ³è¿™ç‚¹æ•ˆç‡å·®åˆ«åœ¨å¤§è§„æ¨¡ç³»ç»Ÿä¸­æ˜¯å¦å¯ä»¥å¿½ç•¥ä¸è®¡å‘¢ï¼Ÿ</li><li><strong>å¦‚æœæ”¹å˜æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ï¼Œä¼šæœ‰ä»€ä¹ˆä¸åŒçš„ç»“è®ºå—ï¼Ÿ</strong> å› ä¸ºç”¨äº† capacity å‚æ•°ï¼Œå¯ä»¥æ¨æµ‹çš„æ˜¯æˆ‘ä»¬é¿å…äº†æ•°ç»„å…ƒç´ çš„å¢åŠ ï¼Œä½†æ˜¯å»è®¡ç®—å¤§è§„æ¨¡æ•°æ®çš„ <code>n</code> å€¼æ¶ˆè€—æœ‰å¤šå¤§å‘¢ï¼Ÿ</li><li><strong>å…¶ä»–é›†åˆç±»å‹ï¼Œæ¯”å¦‚è¯´ <code>NSMutableSet</code> æˆ– <code>NSMutableDictionary</code> çš„ capacity å‚æ•°åˆå§‹åŒ–æ•ˆç‡åˆæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</strong> æ°‘ä¼—éœ€è¦çœŸç›¸ï¼</li></ul><h2 id=benchmarking-å¸¸è¯†æŒ‡å—>Benchmarking å¸¸è¯†æŒ‡å—</h2><ul><li><strong>çŸ¥é“ä½ è¦è§£ç­”çš„æ˜¯ä»€ä¹ˆé—®é¢˜ã€‚</strong> è™½ç„¶æˆ‘ä»¬å§‹ç»ˆè‡´åŠ›äºç”¨æ€è€ƒå»ä»£æ›¿ç¥å¥‡çš„æ€ç»´ï¼Œä½†æˆ‘ä»¬å¿…é¡»ä¿æŠ¤è‡ªå·±å…å—ç§‘å­¦æ–¹æ³•çš„æ·¹æ²¡ï¼Œä¹Ÿä¸åº”è¯¥æ”¯æŒä¸å®Œæ•´çš„æ¨ç†ã€‚å¾—å‡ºç»“è®ºä¹‹å‰ï¼ŒèŠ±ä¸€äº›æ—¶é—´å»ç†è§£åœ¨å¤§èƒŒæ™¯ä¸‹ä½ çš„ç»“æœåˆ°åº•æ„å‘³ç€ä»€ä¹ˆã€‚</li><li><strong>ä¸è¦åœ¨ä½  app çš„æäº¤ä»£ç ä¸­åŠ å…¥ benchmarkingã€‚</strong> æ³¨æ„ï¼Œ<code>dispatch_benchmark</code> å¯èƒ½ä¼šå¯¼è‡´ app è¢« App Store æ‹’ç»ï¼Œbenchmark ä»£ç ä¸åº”è¯¥è¢«åŠ åˆ°ç»ˆææäº¤çš„äº§å“ä¸­ã€‚Benchmarking åº”è¯¥è¢«åˆ†ç¦»åˆ°å•ç‹¬çš„é¡¹ç›®åˆ†æ”¯æˆ–ç‹¬ç«‹çš„æµ‹è¯•ç”¨ä¾‹ä¸­ã€‚</li><li><strong>ä½¿ç”¨ Instruments æ¥è·å¾—æ›´æœ‰ç”¨çš„ç»“æœã€‚</strong> çŸ¥é“äº†ä¸€ç³»åˆ—è®¡ç®—è¿‡ç¨‹çš„è¿è¡Œç»å¯¹æ—¶é—´ç¡®å®æœ‰ä»·å€¼ï¼Œä½†å¯èƒ½ä¸è¶³ä»¥ä¸ºå‡å°‘å†…å­˜ä½¿ç”¨æä¾›å®Œå–„çš„å‚è€ƒã€‚ä½¿ç”¨ Instruments æ¥åˆ†ææœ‰ç–‘é—®ä»£ç çš„æ ˆè°ƒç”¨å’Œå†…å­˜ç”¨é‡ï¼Œä½ ä¼šå¯¹è¿™æ®µä»£ç åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆæœ‰æ›´å¥½åœ°ç†è§£ã€‚</li><li><strong>åœ¨çœŸå®è®¾å¤‡ä¸Š benchmarkã€‚</strong> åƒå…¶ä»–ä»»ä½•æ•ˆç‡æµ‹é‡å·¥å…·ä¸€æ ·ï¼Œæµ‹é‡ç»ˆç©¶è¦åœ¨çœŸæ­£çš„æœºå™¨ä¸Šè·‘ä¸€è·‘ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹æ¨¡æ‹Ÿå™¨å’ŒçœŸå®è®¾å¤‡çš„æ•ˆç‡æµ‹é‡ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä½†ä»¥é˜²ä¸‡ä¸€è¿˜æ˜¯å€¼å¾—è¿™ä¹ˆåšçš„ã€‚</li><li><strong>ä¸è¦è¿‡æ—©ä¼˜åŒ–ã€‚</strong> <em>è¿™å¥è¯æ€ä¹ˆå¼ºè°ƒä¹Ÿä¸è¿‡åˆ†ã€‚</em> å·¥ç¨‹å¸ˆçš„æ™®éå€¾å‘æ˜¯åœ¨å‘ç°çœŸæ­£çš„åŸå› ä¹‹å‰è¿‡åˆ†å…³æ³¨ä»–ä»¬è®¤ä¸ºçš„â€œæ…¢ä»£ç â€ã€‚å³ä½¿æ˜¯è€æ‰‹ä¹Ÿå¾ˆå®¹æ˜“æŠŠåº”ç”¨çš„ç“¶é¢ˆé¢„æµ‹é”™è¯¯ã€‚ä¸è¦æµªè´¹æ—¶é—´åœ¨è¿½èµ¶å½±å­ä¸Šã€‚è®© Instruments å‘Šè¯‰ä½ ä½ çš„åº”ç”¨åˆ°åº•å“ªé‡ŒèŠ±è´¹äº†æœ€å¤šçš„æ—¶é—´ã€‚</li></ul><hr><p>Richard Feynman æ›¾ç»æŠŠç‰©ç†å­¦ä¸­çš„é¢—ç²’åŒ–å®éªŒæ¯”ä½œâ€œ[æ‰¾å‡º]æ‰‹è¡¨æ˜¯æ€ä¹ˆåšå‡ºæ¥çš„ï¼Œä»¥åŠæœºå™¨æ˜¯å¦‚ä½•[é€šè¿‡]æŠŠä¸€å †æ‰‹è¡¨ç»„åˆåœ¨ä¸€èµ·å¹¶ä¸”å‰”æ‰æ— ç”¨çš„é½¿è½®å°±è¿è¡Œèµ·æ¥äº†â€ã€‚Benchmarking ä»£ç çš„æ„Ÿè§‰å°±åƒè¿™ä¸ªã€‚</p><p>æ‹¥æœ‰äº†è¿™äº›è®¡ç®—ä¸–ç•Œéšè—èµ·æ¥çš„æŠ½è±¡å±‚çš„å…·ä½“å®ç°ç»†èŠ‚ï¼Œæœ‰æ—¶æˆ‘ä»¬å¯ä»¥èƒ½å°½æ‰€èƒ½æ¥ç†è§£åœ¨å¤§æ•°é‡çº§ä»£ç å±‚æ¬¡ä¸Šåˆ°åº•ä»€ä¹ˆåœ¨å…¶æ ¸å¿ƒä½œç”¨ï¼Œä»¥åŠæˆ‘ä»¬èƒ½å¤Ÿå¾—åˆ°ä»€ä¹ˆã€‚</p><p>é€šè¿‡ç§‘å­¦å’ŒåŸºå‡†ç»Ÿè®¡çš„ä¸¥è°¨ç¨‹åºï¼Œå¼€å‘äººå‘˜èƒ½å¤Ÿåœ¨å…¶ä»£ç çš„æ€§èƒ½ç‰¹çˆ¹æ–¹é¢å¾—å‡ºç†ç”±å……åˆ†çš„ç»“è®ºã€‚å°†è¿™äº›è¿™äº›åŸåˆ™å’Œæƒ¯ä¾‹å¥—ç”¨åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­æ¥å¾—å‡ºé€‚åˆä½ è‡ªå·±çš„ç»“è®ºï¼Œå¹¶æ®æ­¤ä¼˜åŒ–ã€‚</p><hr><p>é™¤é<a href=https://nshipster.cn/ target=_blank>å¦æœ‰å£°æ˜</a>ï¼Œæœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ã€Œ<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 3.0 ä¸­å›½å¤§é™†</a>ã€è®¸å¯åè®®æˆæƒã€‚</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top Â· å›é¡¶éƒ¨" rel=nofollow>&#127772;2014-05-19 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2026 Mattt ç‰ˆæƒæ‰€æœ‰</a><a href=https://autoptr.top/ title="Back to Home Â· å›é¦–é¡µ">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>æ ‡ç­¾:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>åˆ†ç±»:</span><li><a class=link href=https://autoptr.top/categories/Objective-C target=_blank>Objective-C</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>