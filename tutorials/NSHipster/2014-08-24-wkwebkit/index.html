<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>WKWebView</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="WKWebView,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="WKWebView,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"ğŸŒœ"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>WKWebView</span><span class=btRight><span title="Author Â· ä½œè€…" class=author>Mattt</span> <span title="Translator Â· ç¿»è¯‘" class=author>Croath Liu</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post Â· å…³è”æˆ–è½¬è½½å¼•ç”¨çš„æ–‡ç« " target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics Â· å›ä¸»é¢˜é¡µ">&#127793;</a></span></h1><p>iOS ä¸ web ä¹‹é—´çš„å…³ç³»éå¸¸å¤æ‚ï¼Œè¿™ç§å¤æ‚å…³ç³»ç”šè‡³å¯ä»¥è¿½æº¯åˆ°å‡ åå¹´å‰ç³»ç»Ÿå»ºç«‹åˆæœŸã€‚</p><p>å…¶å®ç°åœ¨å¾ˆéš¾è¯´æ¸…ç¬¬ä¸€ä»£ iPhone æ¨ªç©ºå‡ºä¸–æ˜¯ä¸€ä»¶å¤šä¹ˆå›°éš¾çš„äº‹æƒ…ã€‚æˆ‘ä»¬ç°ä»Šå¸ç©ºè§æƒ¯çš„è§¦æ‘¸å±åœ¨å½“æ—¶åªæ˜¯è¯¸å¤šæ–¹æ¡ˆä¸­çš„ä¸€ç§ã€‚æœ€æ—©æœŸçš„äº§å“åŸå‹æ˜¯ç‰©ç†é”®ç›˜ã€è§¦æ‘¸å±ã€è§¦æ§ç¬”çš„ç»“åˆï¼Œå±å¹•å°ºå¯¸æ‰æ˜¯ 5" x 7"ã€‚ç”šè‡³å½“æ—¶ iPod çš„è½®å­éƒ½æ˜¯ä¸€ä¸ªä¸¥è‚ƒçš„å¤‡é€‰æ–¹æ¡ˆã€‚</p><p>ä½†æœ€æœ€é‡è¦çš„å†³å®šæˆ–è®¸éƒ½æ˜¯ç”±è½¯ä»¶è€Œéç¡¬ä»¶å†³å®šçš„ã€‚</p><p>iPhone åº”è¯¥å¦‚ä½•è¿è¡Œè½¯ä»¶å‘¢ï¼Ÿåƒ OS X ä¸Šçš„åº”ç”¨ç¨‹åºï¼Œæˆ–è€… web é¡µé¢ï¼Œä»¥åŠ Safari éƒ½åº”è¯¥å¦‚ä½•è¿è¡Œèµ·æ¥å‘¢ï¼Ÿä»¿ç…§ OS X å»æ„å»º iPhone OS çš„æ–¹æ³•å·²ç»å¹¿æ³›åœ°è¢«å¤§å®¶ç†ŸçŸ¥äº†ï¼Œè¿™ç§æ–¹æ³•åˆ°ä»Šå¤©ä¹Ÿç•™ä¸‹äº†ä¸å°‘äº‰è®®ã€‚</p><p>æˆ‘ä»¬æ¥å›å¿†ä¸€ä¸‹ Steve Jobs 2007 å¹´ WWDC keynote ä¸Šè¿™å¥è‡­åæ˜­è‘—çš„è¯ï¼š</p><blockquote><p>iPhone åŒ…å«äº†æ•´ä¸ª Safari å¼•æ“ã€‚å› æ­¤ï¼Œä½ å¯ä»¥åˆ›ä½œåº”ç”¨ Ajax æŠ€æœ¯çš„ Web 2.0 åº”ç”¨ï¼Œè¡¨ç°ä¸Šå’Œä½¿ç”¨ä¸Šéƒ½å’Œ iPhone åŸç”Ÿåº”ç”¨ä¸€æ¨¡ä¸€æ ·ã€‚è¿™äº›åº”ç”¨å¯ä»¥å’Œ iPhone çš„å„ç§æœåŠ¡å®Œç¾åœ°é›†æˆåˆ°ä¸€èµ·ï¼šè¿™äº›åº”ç”¨å¯ä»¥æœ‰æ‰“ç”µè¯çš„åŠŸèƒ½ï¼Œå¯ä»¥å‘é‚®ä»¶ï¼Œå¯ä»¥åœ¨ Google Maps ä¸Šå¯»æ‰¾åœ°æ ‡ã€‚</p></blockquote><p>Web ä¸€ç›´æ˜¯ iOS ç³»ç»Ÿä¸Šçš„äºŒçº§å…¬æ°‘_(è®½åˆºçš„æ˜¯ï¼Œå…¶å®ç°ä»Šç§»åŠ¨ç½‘é¡µå“åº”å¼è®¾è®¡çš„å‡ºç°å¤§å¤šæ˜¯ iPhone æ¨åŠ¨çš„)_ã€‚<code>UIWebView</code> ç¬¨é‡éš¾ç”¨ï¼Œè¿˜æœ‰å†…å­˜æ³„æ¼ï¼Œå’Œ Nirtro JavaScript å¼•æ“è°ˆç¬‘é£ç”Ÿçš„ Safari ä¸çŸ¥é“è¦æ¯”å®ƒé«˜åˆ°å“ªé‡Œå»äº†ã€‚</p><p>ç„¶è€Œï¼Œè¿™æ‰€æœ‰çš„ä¸€åˆ‡éƒ½ä¼šå› ä¸º <code>WKWebView</code> å’Œ <code>WebKit</code> æ¡†æ¶å…¶ä»–éƒ¨åˆ†çš„å‡ºç°è€Œå‘ç”Ÿæ”¹å˜ã€‚</p><hr><p><code>WKWebView</code> æ˜¯ç°ä»£ WebKit API åœ¨ iOS 8 å’Œ OS X Yosemite åº”ç”¨ä¸­çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚å®ƒä»£æ›¿äº† UIKit ä¸­çš„ <code>UIWebView</code> å’Œ AppKit ä¸­çš„ <code>WebView</code>ï¼Œæä¾›äº†ç»Ÿä¸€çš„è·¨åŒå¹³å° APIã€‚</p><p>è‡ªè¯©æ‹¥æœ‰ 60fps æ»šåŠ¨åˆ·æ–°ç‡ã€å†…ç½®æ‰‹åŠ¿ã€é«˜æ•ˆçš„ app å’Œ web ä¿¡æ¯äº¤æ¢é€šé“ã€å’Œ Safari ç›¸åŒçš„ JavaScript å¼•æ“ï¼Œ<code>WKWebView</code> æ¯«æ— ç–‘é—®åœ°æˆä¸ºäº† WWDC 2014 ä¸Šçš„æœ€äº®ç‚¹ã€‚</p><p><code>UIWebView</code> & <code>UIWebViewDelegate</code> è¿™ä¸ªä¸¤ä¸ªä¸œè¥¿æ˜¯å¦‚ä½•åœ¨ WKWebKit ä¸­è¢«é‡æ„æˆ 14 ä¸ªç±» 3 ä¸ªåè®®çš„å‘¢ã€‚è™½ç„¶è¿™æ¬¡çš„å˜åŒ–ç¡®å®å¸¦æ¥äº†ä¸å°‘çš„æ–°åŠŸèƒ½ï¼Œä½†è¯·ä¸€å®šä¸è¦å› æ­¤æ„Ÿåˆ°ææ…Œï¼</p><h2 id=wkwebkit-framework>WKWebKit Framework</h2><h3 id=classes>Classes</h3><blockquote><ul><li><code>WKBackForwardList</code>: ä¹‹å‰è®¿é—®è¿‡çš„ web é¡µé¢çš„åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡åé€€å’Œå‰è¿›åŠ¨ä½œæ¥è®¿é—®åˆ°ã€‚<ul><li><code>WKBackForwardListItem</code>: webview ä¸­åé€€åˆ—è¡¨é‡Œçš„æŸä¸€ä¸ªç½‘é¡µã€‚</li></ul></li><li><code>WKFrameInfo</code>: åŒ…å«ä¸€ä¸ªç½‘é¡µçš„å¸ƒå±€ä¿¡æ¯ã€‚</li><li><code>WKNavigation</code>: åŒ…å«ä¸€ä¸ªç½‘é¡µçš„åŠ è½½è¿›åº¦ä¿¡æ¯ã€‚<ul><li><code>WKNavigationAction</code>: åŒ…å«å¯èƒ½è®©ç½‘é¡µå¯¼èˆªå˜åŒ–çš„ä¿¡æ¯ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦åšå‡ºå¯¼èˆªå˜åŒ–ã€‚</li><li><code>WKNavigationResponse</code>: åŒ…å«å¯èƒ½è®©ç½‘é¡µå¯¼èˆªå˜åŒ–çš„è¿”å›å†…å®¹ä¿¡æ¯ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦åšå‡ºå¯¼èˆªå˜åŒ–ã€‚</li></ul></li><li><code>WKPreferences</code>: æ¦‚æ‹¬ä¸€ä¸ª webview çš„åå¥½è®¾ç½®ã€‚</li><li><code>WKProcessPool</code>: è¡¨ç¤ºä¸€ä¸ª web å†…å®¹åŠ è½½æ± ã€‚</li><li><code>WKUserContentController</code>: æä¾›ä½¿ç”¨ JavaScript post ä¿¡æ¯å’Œæ³¨å°„ script çš„æ–¹æ³•ã€‚<ul><li><code>WKScriptMessage</code>: åŒ…å«ç½‘é¡µå‘å‡ºçš„ä¿¡æ¯ã€‚</li><li><code>WKUserScript</code>: è¡¨ç¤ºå¯ä»¥è¢«ç½‘é¡µæ¥å—çš„ç”¨æˆ·è„šæœ¬ã€‚</li></ul><blockquote><ul><li><code>WKWebViewConfiguration</code>: åˆå§‹åŒ– webview çš„è®¾ç½®ã€‚</li></ul></blockquote></li><li><code>WKWindowFeatures</code>: æŒ‡å®šåŠ è½½æ–°ç½‘é¡µæ—¶çš„çª—å£å±æ€§ã€‚</li></ul></blockquote><h3 id=protocols>Protocols</h3><blockquote><ul><li><code>WKNavigationDelegate</code>: æä¾›äº†è¿½è¸ªä¸»çª—å£ç½‘é¡µåŠ è½½è¿‡ç¨‹å’Œåˆ¤æ–­ä¸»çª—å£å’Œå­çª—å£æ˜¯å¦è¿›è¡Œé¡µé¢åŠ è½½æ–°é¡µé¢çš„ç›¸å…³æ–¹æ³•ã€‚</li><li><code>WKScriptMessageHandler</code>: æä¾›ä»ç½‘é¡µä¸­æ”¶æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•ã€‚</li><li><code>WKUIDelegate</code>: æä¾›ç”¨åŸç”Ÿæ§ä»¶æ˜¾ç¤ºç½‘é¡µçš„æ–¹æ³•å›è°ƒã€‚</li></ul></blockquote><h2 id=uiwebview-å’Œ-wkwebview-çš„-api-åŒºåˆ«><code>UIWebView</code> å’Œ <code>WKWebView</code> çš„ API åŒºåˆ«</h2><p><code>WKWebView</code> ç»§æ‰¿äº† <code>UIWebView</code> å¤§éƒ¨åˆ†çš„æ¥å£ï¼Œè¿™è®© app æ¥ç»§æ‰¿ WKWebKit ä¹Ÿç®€å•äº†è®¸å¤šï¼ˆåŒæ—¶éšç€æ›´æ–° iOS 8 çš„è¶Šæ¥è¶Šå¤šè¿™ä¹Ÿæˆä¸ºäº†æŸç§å¿…éœ€ï¼‰ã€‚</p><p>æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªç±»çš„ API åŒºåˆ«ï¼š</p><table><thead><tr><th>UIWebView</th><th>WKWebView</th></tr></thead><tbody><tr><td><code>var scrollView: UIScrollView! { get }</code></td><td><code>var scrollView: UIScrollView! { get }</code></td></tr><tr><td></td><td><code>var configuration: WKWebViewConfiguration! { get }</code></td></tr><tr><td><code>var delegate: UIWebViewDelegate!</code></td><td><code>var UIDelegate: WKUIDelegate!</code></td></tr><tr><td></td><td><code>var navigationDelegate: WKNavigationDelegate!</code></td></tr><tr><td></td><td><code>var backForwardList: WKBackForwardList! { get }</code></td></tr></tbody></table><h3 id=é¡µé¢åŠ è½½>é¡µé¢åŠ è½½</h3><table><thead><tr><th>UIWebView</th><th>WKWebView</th></tr></thead><tbody><tr><td><code>func loadRequest(request: NSURLRequest!)</code></td><td><code>func loadRequest(request: NSURLRequest!) -> WKNavigation!</code></td></tr><tr><td><code>func loadHTMLString(string: String!, baseURL: NSURL!)</code></td><td><code>func loadHTMLString(string: String!, baseURL: NSURL!) -> WKNavigation!</code></td></tr><tr><td><code>func loadData(data: NSData!, MIMEType: String!, textEncodingName: String!, baseURL: NSURL!)</code></td><td></td></tr><tr><td></td><td><code>var estimatedProgress: Double { get }</code></td></tr><tr><td></td><td><code>var hasOnlySecureContent: Bool { get }</code></td></tr><tr><td><code>func reload()</code></td><td><code>func reload() -> WKNavigation!</code></td></tr><tr><td></td><td><code>func reloadFromOrigin() -> WKNavigation!</code></td></tr><tr><td><code>func stopLoading()</code></td><td><code>func stopLoading()</code></td></tr><tr><td><code>var request: NSURLRequest! { get }</code></td><td></td></tr><tr><td></td><td><code>var URL: NSURL! { get }</code></td></tr><tr><td></td><td><code>var title: String! { get }</code></td></tr></tbody></table><h3 id=è®¿é—®å†å²>è®¿é—®å†å²</h3><table><thead><tr><th>UIWebView</th><th>WKWebView</th></tr></thead><tbody><tr><td></td><td><code>func goToBackForwardListItem(item: WKBackForwardListItem!) -> WKNavigation!</code></td></tr><tr><td><code>func goBack()</code></td><td><code>func goBack() -> WKNavigation!</code></td></tr><tr><td><code>func goForward()</code></td><td><code>func goForward() -> WKNavigation!</code></td></tr><tr><td><code>var canGoBack: Bool { get }</code></td><td><code>var canGoBack: Bool { get }</code></td></tr><tr><td><code>var canGoForward: Bool { get }</code></td><td><code>var canGoForward: Bool { get }</code></td></tr><tr><td><code>var loading: Bool { get }</code></td><td><code>var loading: Bool { get }</code></td></tr></tbody></table><h3 id=è°ƒç”¨-javascript>è°ƒç”¨ Javascript</h3><table><thead><tr><th>UIWebView</th><th>WKWebView</th></tr></thead><tbody><tr><td><code>func stringByEvaluatingJavaScriptFromString(script: String!) -> String!</code></td><td></td></tr><tr><td></td><td><code>func evaluateJavaScript(javaScriptString: String!, completionHandler: ((AnyObject!, NSError!) -> Void)!)</code></td></tr></tbody></table><h3 id=åŸç”Ÿæ··ç”¨>åŸç”Ÿæ··ç”¨</h3><table><thead><tr><th>UIWebView</th><th>WKWebView</th></tr></thead><tbody><tr><td><code>var keyboardDisplayRequiresUserAction: Bool</code></td><td></td></tr><tr><td><code>var scalesPageToFit: Bool</code></td><td></td></tr><tr><td></td><td><code>var allowsBackForwardNavigationGestures: Bool</code></td></tr></tbody></table><h3 id=é¡µç >é¡µç </h3><p><code>WKWebView</code> ç›®å‰ç¼ºå°‘å…³äºé¡µç ç›¸å…³çš„ APIã€‚</p><ul><li><code>var paginationMode: UIWebPaginationMode</code></li><li><code>var paginationBreakingMode: UIWebPaginationBreakingMode</code></li><li><code>var pageLength: CGFloat</code></li><li><code>var gapBetweenPages: CGFloat</code></li><li><code>var pageCount: Int { get }</code></li></ul><h3 id=é‡æ„åˆ†ç¦»å¼€çš„-wkwebviewconfiguration>é‡æ„åˆ†ç¦»å¼€çš„ <code>WKWebViewConfiguration</code></h3><p>ä¸‹é¢è¿™äº› <code>UIWebView</code> çš„å±æ€§è¢«é‡æ„è¿›äº†åœ¨åˆå§‹åŒ– <code>WKWebView</code> ä¼ å…¥çš„è®¾ç½®å¯¹è±¡ï¼š</p><ul><li><code>var allowsInlineMediaPlayback: Bool</code></li><li><code>var mediaPlaybackRequiresUserAction: Bool</code></li><li><code>var mediaPlaybackAllowsAirPlay: Bool</code></li><li><code>var suppressesIncrementalRendering: Bool</code></li></ul><hr><h2 id=javascript--swift-å¯¹è¯æœºåˆ¶>JavaScript â†”ï¸ Swift å¯¹è¯æœºåˆ¶</h2><p>ç›¸å¯¹äº <code>UIWebView</code> æœ€å¤§çš„æå‡å°±æ˜¯æ•°æ®åœ¨å¯ä»¥ app å’Œ web å†…å®¹ä¹‹é—´ä¼ é€’ã€‚</p><h3 id=ä½¿ç”¨ç”¨æˆ·è„šæœ¬æ¥æ³¨å…¥-javascript>ä½¿ç”¨ç”¨æˆ·è„šæœ¬æ¥æ³¨å…¥ JavaScript</h3><p><code>WKUserScript</code> å…è®¸åœ¨æ­£æ–‡åŠ è½½ä¹‹å‰æˆ–ä¹‹åæ³¨å…¥åˆ°é¡µé¢ä¸­ã€‚è¿™ä¸ªå¼ºå¤§çš„åŠŸèƒ½å…è®¸åœ¨é¡µé¢ä¸­ä»¥å®‰å…¨ä¸”å”¯ä¸€çš„æ–¹å¼æ“ä½œç½‘é¡µå†…å®¹ã€‚</p><p>ä¸€ä¸ªç®€å•çš„ä¾‹å­å¦‚ä¸‹ï¼Œç”¨æˆ·æ”¹å˜èƒŒæ™¯çš„ç”¨æˆ·è„šæœ¬è¢«æ’å…¥åˆ°ç½‘é¡µä¸­ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> source = <span style=color:#e6db74>&#34;document.body.style.background = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>#777</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> userScript = WKUserScript(source: source, injectionTime: .AtDocumentEnd, forMainFrameOnly: <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> userContentController = WKUserContentController()
</span></span><span style=display:flex><span>userContentController.addUserScript(userScript)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> configuration = WKWebViewConfiguration()
</span></span><span style=display:flex><span>configuration.userContentController = userContentController
</span></span><span style=display:flex><span><span style=color:#66d9ef>self</span>.webView = WKWebView(frame: <span style=color:#66d9ef>self</span>.view.bounds, configuration: configuration)
</span></span></code></pre></div><p><code>WKUserScript</code> å¯¹è±¡å¯ä»¥ä»¥ JavaScript æºç å½¢å¼åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–æ—¶è¿˜å¯ä»¥ä¼ å…¥æ˜¯åœ¨åŠ è½½ä¹‹å‰è¿˜æ˜¯ç»“æŸæ—¶æ³¨å…¥ï¼Œä»¥åŠè„šæœ¬å½±å“çš„æ˜¯è¿™ä¸ªå¸ƒå±€è¿˜æ˜¯ä»…ä¸»è¦å¸ƒå±€ã€‚äºæ˜¯ç”¨æˆ·è„šæœ¬è¢«åŠ å…¥åˆ° <code>WKUserContentController</code> ä¸­ï¼Œå¹¶ä¸”ä»¥ <code>WKWebViewConfiguration</code> å±æ€§ä¼ å…¥åˆ° <code>WKWebView</code> çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ã€‚</p><p>è¿™ä¸ªæ ·ä¾‹å¯ä»¥ç®€å•æ‰©å±•ä¸ºæ›´ä¸ºé«˜çº§çš„é¡µé¢ä¿®æ”¹æ–¹æ³•ï¼Œä¾‹å¦‚å»é™¤å¹¿å‘Šã€éšè—è¯„è®ºç­‰ï¼Œæ›´å¤æ‚çš„æ ·ä¾‹è§æ­¤ï¼š<a href=https://github.com/panicsteve/cloud-to-butt>è®©æ‰€æœ‰å‡ºç°çš„"the cloud"å˜ä¸º"my butt"</a>ã€‚</p><h3 id=é©¬æ€é¸¡-é­‚æ–—ç½—message-handlers-æŠ±æ­‰æˆ‘æ†‹äº†ä¸€å¤©çœŸçš„ä¸ä¼šç¿»è¯‘>é©¬æ€é¸¡ é­‚æ–—ç½—(Message Handlers æŠ±æ­‰æˆ‘æ†‹äº†ä¸€å¤©ï¼ŒçœŸçš„ä¸ä¼šç¿»è¯‘)</h3><p>web å’Œ app é€šè®¯æœºåˆ¶ä¹Ÿé€šè¿‡ message handler æœ‰å¾ˆå¤§æå‡ã€‚</p><p>å°±æƒ³åœ¨<a href=https://developer.apple.com/library/safari/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/Introduction/Introduction.html>Safari å®¡æŸ¥å…ƒç´ </a>åŠŸèƒ½ä¸­çš„ <code>console.log</code> èƒ½åœ¨è°ƒè¯•ç»ˆç«¯æ‰“å°ä¿¡æ¯ä¸€æ ·ï¼Œç½‘é¡µä¸­çš„ä¿¡æ¯ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨è¿™ä¸ªå‡½æ•°è¢«ä¼ åˆ° app é‡Œï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>window.<span style=color:#a6e22e>webkit</span>.<span style=color:#a6e22e>messageHandlers</span>.{<span style=color:#a6e22e>NAME</span>}.<span style=color:#a6e22e>postMessage</span>()
</span></span></code></pre></div><blockquote><p>è¿™ä¸ª API çœŸæ­£ç¥å¥‡çš„åœ°æ–¹åœ¨äº JavaScript å¯¹è±¡å¯ä»¥_è‡ªåŠ¨è½¬æ¢_ä¸º Objective-C æˆ– Swift å¯¹è±¡ã€‚</p></blockquote><p>Handler çš„åå­—å¯ä»¥é€šè¿‡ <code>WKScriptMessageHandler</code> åè®®ä¸­çš„ <code>addScriptMessageHandler()</code> æ¥å£å‡½æ•°è®¾ç½®ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NotificationScriptMessageHandler</span>: NSObject, WKScriptMessageHandler {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>userContentController</span>(userContentController: WKUserContentController, didReceiveScriptMessage message: WKScriptMessage!) {
</span></span><span style=display:flex><span>        println(message.body)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> userContentController = WKUserContentController()
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> handler = NotificationScriptMessageHandler()
</span></span><span style=display:flex><span>userContentController.addScriptMessageHandler(handler, name: <span style=color:#e6db74>&#34;notification&#34;</span>)
</span></span></code></pre></div><p>äºæ˜¯å½“é€šçŸ¥è¿›å…¥ app çš„æ—¶å€™ï¼Œæ¯”å¦‚è¯´åœ¨é¡µé¢ä¸­åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œç›¸å…³ä¿¡æ¯å°±å¯ä»¥è¿™æ ·ä¼ é€’ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>window.<span style=color:#a6e22e>webkit</span>.<span style=color:#a6e22e>messageHandlers</span>.<span style=color:#a6e22e>notification</span>.<span style=color:#a6e22e>postMessage</span>({<span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;...&#34;</span>});
</span></span></code></pre></div><blockquote><p>æ·»åŠ ç”¨æˆ·è„šæœ¬æ¥å¯¹ web äº‹ä»¶ç›‘å¬å¹¶ç”¨ Message Handler å°†ä¿¡æ¯ä¼ å› appã€‚</p></blockquote><p>åŒæ ·çš„æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨æ¥æ”¶é›†é¡µé¢ä¿¡æ¯ç”¨äº app çš„é¡µé¢å±•ç¤ºæˆ–æ•°æ®åˆ†æã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæŸäººè¦é’ˆå¯¹ NSHipster.com åšä¸€ä¸ªç‰¹åˆ«çš„æµè§ˆå™¨ï¼Œå°±å¯ä»¥åŠ ä¸€ä¸ªèƒ½å¤Ÿå‘¼å‡ºç›¸ä¼¼æ–‡ç« åˆ—è¡¨çš„æŒ‰é’®ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// document.location.href == &#34;https://nshipster.com/webkit&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getRelatedArticles</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>related</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>elements</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;related&#34;</span>).<span style=color:#a6e22e>getElementsByTagName</span>(<span style=color:#e6db74>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>elements</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>elements</span>[<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>related</span>.<span style=color:#a6e22e>push</span>({<span style=color:#a6e22e>href</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>href</span>, <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>title</span>});
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    window.<span style=color:#a6e22e>webkit</span>.<span style=color:#a6e22e>messageHandlers</span>.<span style=color:#a6e22e>related</span>.<span style=color:#a6e22e>postMessage</span>({<span style=color:#a6e22e>articles</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>related</span>});
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> js = <span style=color:#e6db74>&#34;getRelatedArticles();&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>self</span>.webView?.evaluateJavaScript(js) { (<span style=color:#66d9ef>_</span>, error) <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>    println(error)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Get results in previously-registered message handler</span>
</span></span></code></pre></div><hr><p>å¦‚æœä½ çš„ app åªæ˜¯å¯¹ç½‘é¡µå†…å®¹åšäº†å¾ˆç®€å•çš„ä¸€å±‚åŒ…è£…ï¼Œé‚£ä¹ˆ <code>WKWebView</code> å¯ä»¥å½»åº•æ”¹å˜è¿™ç§çŠ¶å†µã€‚ä½ å¯¹äºæ€§èƒ½å’Œå…¼å®¹æ€§çš„æ‰€æœ‰æ„¿æœ›éƒ½å°†å˜ä¸ºç°å®ã€‚æ‰€æœ‰ä½ æƒ³è¦çš„ä¸œè¥¿éƒ½åœ¨è¿™äº†ã€‚</p><p>å¦‚æœä½ æ˜¯ä¸€ä¸ªåŸç”Ÿçº¯ç²¹ä¸»ä¹‰è€…ï¼Œä½ å¯èƒ½ä¼šè¢« iOS 8 æ–°å¸¦æ¥å¼ºå¤§å’Œæ‰©å±•æ€§åŠŸèƒ½å“åˆ°ã€‚æœ‰ä¸€ä¸ªç§˜å¯†å°±æ˜¯ï¼Œä¾‹å¦‚ Messages è¿™ç§åŸç”Ÿåº”ç”¨éƒ½åº”ç”¨äº† WebKit æ¥æ¸²æŸ“å¤æ‚çš„é¡µé¢å…ƒç´ ã€‚ä½ å¯èƒ½å°šä¸”æ²¡æœ‰æ„è¯†åˆ°ï¼Œä½†äº‹å®æ˜¯ï¼Œwebview åœ¨ç§»åŠ¨å¼€å‘æœ€ä½³å®è·µä¸­åº”è¯¥å¾—åˆ°ä¸€å¸­ä¹‹åœ°ã€‚</p><hr><p>é™¤é<a href=https://nshipster.cn/ target=_blank>å¦æœ‰å£°æ˜</a>ï¼Œæœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ã€Œ<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 3.0 ä¸­å›½å¤§é™†</a>ã€è®¸å¯åè®®æˆæƒã€‚</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top Â· å›é¡¶éƒ¨" rel=nofollow>&#127772;2014-08-24 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2026 Mattt ç‰ˆæƒæ‰€æœ‰</a><a href=https://autoptr.top/ title="Back to Home Â· å›é¦–é¡µ">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>æ ‡ç­¾:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>åˆ†ç±»:</span><li><a class=link href=https://autoptr.top/categories/Cocoa target=_blank>Cocoa</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>