<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>Swift Property Observers</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="Swift Property Observers,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="Swift Property Observers,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"ğŸŒœ"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>Swift Property Observers</span><span class=btRight><span title="Author Â· ä½œè€…" class=author>Mattt</span> <span title="Translator Â· ç¿»è¯‘" class=author>Hale</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post Â· å…³è”æˆ–è½¬è½½å¼•ç”¨çš„æ–‡ç« " target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics Â· å›ä¸»é¢˜é¡µ">&#127793;</a></span></h1><p>åˆ°äº† 20 ä¸–çºª 30 å¹´ä»£ï¼ŒRube Goldberg å·²æˆä¸ºå®¶å–»æˆ·æ™“çš„åå­—ï¼Œä¸<a href=https://upload.wikimedia.org/wikipedia/commons/a/a9/Rube_Goldberg%27s_%22Self-Operating_Napkin%22_%28cropped%29.gif>â€œè‡ªè¥é¤å·¾â€</a> ç­‰æ¼«ç”»ä¸­æç»˜çš„å¥‡å¼‚å¤æ‚å’Œå¼‚æƒ³å¤©å¼€çš„å‘æ˜åŒä¹‰ã€‚å¤§çº¦åœ¨åŒä¸€æ—¶æœŸï¼Œé˜¿å°”ä¼¯ç‰¹Â·çˆ±å› æ–¯å¦å¯¹å°¼å°”æ–¯Â·ç»å°”é‡å­åŠ›å­¦çš„æ™®éè§£é‡Šè¿›è¡Œäº†<a href=https://zh.wikipedia.org/wiki/%E7%88%B1%E5%9B%A0%E6%96%AF%E5%9D%A6-%E6%B3%A2%E5%A4%9A%E5%B0%94%E6%96%AF%E5%9F%BA-%E7%BD%97%E6%A3%AE%E4%BD%AF%E8%B0%AC>æ‰¹åˆ¤</a>ï¼Œå¹¶ä»ä¸­æå‡ºäº†â€œé¬¼é­…ä¼¼çš„è¿œè·ä½œç”¨â€è¿™ä¸€è¯æ±‡ã€‚</p><p>è¿‘ä¸€ä¸ªä¸–çºªä¹‹åï¼Œç°ä»£è½¯ä»¶å¼€å‘å·²ç»è¢«è§†ä¸ºå¯èƒ½æˆä¸º Goldbergian è£…ç½®çš„å…¸èŒƒâ€”â€”é€šè¿‡é‡å­è®¡ç®—æœºç›¸ä¿¡æˆ‘ä»¬ä¼šè¶Šæ¥è¶Šæ¥è¿‘è¿™ä¸ªé¬¼é­…çš„é¢†åŸŸã€‚</p><p>ä½œä¸ºè½¯ä»¶å¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬æå€¡å°½å¯èƒ½å‡å°‘ä»£ç ä¸­çš„è¿œç¨‹æ“ä½œã€‚è¿™æ˜¯æ ¹æ®ä¸€äº›ä¼—æ‰€å‘¨çŸ¥çš„è§„èŒƒæ³•åˆ™å¾—å‡ºçš„ï¼Œå¦‚<a href=https://zh.wikipedia.org/wiki/%E5%8D%95%E4%B8%80%E5%8A%9F%E8%83%BD%E5%8E%9F%E5%88%99>å•ä¸€èŒè´£åŸåˆ™</a>ã€<a href=https://en.wikipedia.org/wiki/Principle_of_least_astonishment>æœ€å°‘æ„å¤–åŸåˆ™</a> å’Œ<a href=https://zh.wikipedia.org/wiki/%E5%BE%97%E5%A2%A8%E5%BF%92%E8%80%B3%E5%AE%9A%E5%BE%8B>å¾—å¢¨å¿’è€³å®šå¾‹</a>ã€‚å°½ç®¡å®ƒä»¬å¯èƒ½ä¼šå¯¹ä»£ç äº§ç”Ÿä¸€å®šçš„å‰¯ä½œç”¨ï¼Œä½†æ›´å¤šçš„æ—¶å€™è¿™äº›åŸåˆ™èƒ½ä½¿ä»£ç é€»è¾‘å˜å¾—æ¸…æ™°ã€‚</p><p>è¿™æ˜¯æœ¬å‘¨æ–‡ç« çš„ç„¦ç‚¹ Swift å±æ€§è§‚å¯Ÿå™¨ï¼Œå®ƒæ˜¯ç³»ç»Ÿå†…ç½®çš„ï¼Œæ¯”æ¨¡å‹ - è§†å›¾ - è§†å›¾æ¨¡å‹ï¼ˆMVVMï¼‰ã€å‡½æ•°å“åº”å¼ç¼–ç¨‹ï¼ˆFRPï¼‰è¿™äº›æ›´æ­£å¼çš„è§£å†³æ–¹æ¡ˆæ›´è½»é‡ã€‚</p><hr><p>Swift ä¸­æœ‰ä¸¤ç§å±æ€§ï¼š<dfn>å­˜å‚¨å±æ€§</dfn>ï¼Œå®ƒä»¬å°†çŠ¶æ€å’Œå¯¹è±¡ç›¸å…³è”ï¼›<dfn>è®¡ç®—å±æ€§</dfn>ï¼Œåˆ™æ ¹æ®è¯¥çŠ¶æ€æ‰§è¡Œè®¡ç®—ã€‚ä¾‹å¦‚ï¼Œ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>S</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å­˜å‚¨å±æ€§</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> stored: String = <span style=color:#e6db74>&#34;stored&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// è®¡ç®—å±æ€§</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> computed: String {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;computed&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å½“ä½ å£°æ˜ä¸€ä¸ªå­˜å‚¨å±æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨é—­åŒ…å®šä¹‰ä¸€ä¸ª <dfn>å±æ€§è§‚å¯Ÿå™¨</dfn>ï¼Œè¯¥é—­åŒ…ä¸­çš„ä»£ç ä¼šåœ¨å±æ€§è¢«è®¾å€¼çš„æ—¶å€™æ‰§è¡Œã€‚<code>willSet</code> è§‚å¯Ÿå™¨ä¼šåœ¨å±æ€§è¢«èµ‹æ–°å€¼ä¹‹å‰è¢«è¿è¡Œï¼Œ<code>didSet</code> è§‚å¯Ÿå™¨åˆ™ä¼šåœ¨å±æ€§è¢«èµ‹æ–°å€¼ä¹‹åè¿è¡Œã€‚æ— è®ºæ–°å€¼æ˜¯å¦ç­‰äºå±æ€§çš„æ—§å€¼å®ƒä»¬éƒ½ä¼šè¢«æ‰§è¡Œã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>S</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> stored: String {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>willSet</span> {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;willSet was called&#34;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;stored is now equal to </span><span style=color:#e6db74>\(</span><span style=color:#66d9ef>self</span>.stored<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;stored will be set to </span><span style=color:#e6db74>\(</span>newValue<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>didSet</span> {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;didSet was called&#34;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;stored is now equal to </span><span style=color:#e6db74>\(</span><span style=color:#66d9ef>self</span>.stored<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;stored was previously set to </span><span style=color:#e6db74>\(</span>oldValue<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä¾‹å¦‚ï¼Œè¿è¡Œä¸‹é¢çš„ä»£ç åœ¨æ§åˆ¶å°çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>var</span> s = S(stored: <span style=color:#e6db74>&#34;first&#34;</span>)
</span></span><span style=display:flex><span>s.stored = <span style=color:#e6db74>&#34;second&#34;</span>
</span></span></code></pre></div><ul><li><samp>willSet was called</samp></li><li><samp>stored is now equal to first</samp></li><li><samp>stored will be set to second</samp></li><li><samp>didSet was called</samp></li><li><samp>stored is now equal to second</samp></li><li><samp>stored was previously set to first</samp></li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯å½“å±æ€§åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­è¿›è¡Œèµ‹å€¼æ—¶ï¼Œä¸ä¼šè§¦å‘è§‚å¯Ÿå™¨çš„ä»£ç ã€‚ä» Swift4.2 å¼€å§‹ï¼Œä½ å¯ä»¥å°†èµ‹å€¼é€»è¾‘åŒ…è£…åœ¨ <code>defer</code> ä»£ç å—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†è¿™æ˜¯<a href=https://twitter.com/jckarter/status/926459181661536256>ä¸€ä¸ªå¾ˆå¿«å°±ä¼šè¢«ä¿®å¤çš„é—®é¢˜</a>ï¼Œå› æ­¤ä½ ä¸åº”è¯¥ä¾èµ–äºè¿™ç§è¡Œä¸ºã€‚</p><hr><p>Swift çš„å±æ€§è§‚å¯Ÿå™¨ä»ä¸€å¼€å§‹å°±æ˜¯è¯­è¨€çš„ä¸€éƒ¨åˆ†ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£å…¶åŸç†ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹å®ƒåœ¨ Objective-C ä¸­çš„å·¥ä½œåŸç†ã€‚</p><h2 id=objective-c-ä¸­çš„å±æ€§>Objective-C ä¸­çš„å±æ€§</h2><p>ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼ŒObjective-C ä¸­çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯è¢«è®¡ç®—å‡ºæ¥çš„ã€‚æ¯æ¬¡é€šè¿‡ç‚¹è¯­æ³•è®¿é—®å±æ€§æ—¶ï¼Œéƒ½ä¼šè½¬æ¢ä¸ºç­‰æ•ˆçš„ getter æˆ– setter æ–¹æ³•è°ƒç”¨ã€‚è¿™äº›è°ƒç”¨æœ€ç»ˆè¢«ç¼–è¯‘æˆæ¶ˆæ¯å‘é€ï¼Œéšåå†æ‰§è¡Œè¯»å–æˆ–å†™å…¥å®ä¾‹å˜é‡çš„æ–¹æ³•ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#75715e>// ç‚¹è¯­æ³•è®¿é—®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>person.name <span style=color:#f92672>=</span> <span style=color:#e6db74>@&#34;Johnny&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...ç­‰ä»·äº
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>[person setName:<span style=color:#e6db74>@&#34;Johnny&#34;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...å®ƒè¢«ç¼–è¯‘æˆ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>objc_msgSend(person, <span style=color:#66d9ef>@selector</span>(setName:), <span style=color:#e6db74>@&#34;Johnny&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...æœ€ç»ˆå®ç°
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>person<span style=color:#f92672>-&gt;</span>_name <span style=color:#f92672>=</span> <span style=color:#e6db74>@&#34;Johnny&#34;</span>;
</span></span></code></pre></div><p>ç¼–ç¨‹è¿‡ç¨‹ä¸­æˆ‘ä»¬é€šå¸¸æƒ³è¦é¿å…å¼•å…¥å‰¯ä½œç”¨ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´ç¨‹åºçš„è¡Œä¸ºéš¾ä»¥æ¨æ–­ã€‚ä½†å¾ˆå¤š Objective-C å¼€å‘è€…å·²ç»ä¾èµ–äºè¿™ç§ç‰¹æ€§ï¼Œä»–ä»¬ä¼šæ ¹æ®éœ€è¦åœ¨ getter æˆ– setter ä¸­æ³¨å…¥å„ç§é¢å¤–çš„è¡Œä¸ºã€‚</p><p>Swift çš„å±æ€§è®¾è®¡ä½¿è¿™äº›æ¨¡å¼æ›´åŠ æ ‡å‡†åŒ–ï¼Œå¹¶å¯¹è£…é¥°çŠ¶æ€è®¿é—®ï¼ˆå­˜å‚¨å±æ€§ï¼‰çš„å‰¯ä½œç”¨å’Œé‡å®šå‘çŠ¶æ€è®¿é—®ï¼ˆè®¡ç®—å±æ€§ï¼‰çš„å‰¯ä½œç”¨è¿›è¡Œäº†åŒºåˆ†ã€‚å¯¹äºå­˜å‚¨å±æ€§ï¼Œ<code>willSet</code> å’Œ <code>didSet</code> è§‚å¯Ÿå™¨å°†æ›¿æ¢ä½ åœ¨ ivar è®¿é—®æ—¶çš„ä»£ç ã€‚å¯¹äºè®¡ç®—å±æ€§ï¼Œ<code>get</code> å’Œ <code>set</code> è®¿é—®å™¨å¯èƒ½ä¼šæ›¿æ¢åœ¨ Objective-C ä¸­å®ç°çš„ä¸€äº› <code>@dynamic</code> å±æ€§ã€‚</p><p>æ­£å› ä¸ºå¦‚æ­¤ï¼Œæˆ‘ä»¬æ‰å¯ä»¥è·å–æ›´ä¸€è‡´çš„è¯­ä¹‰ï¼Œå¹¶æ›´å¥½åœ°ä¿è¯é”®å€¼è§‚å¯Ÿï¼ˆKVOï¼‰å’Œé”®å€¼ç¼–ç ï¼ˆKVCï¼‰ç­‰å±æ€§äº¤äº’æœºåˆ¶ã€‚</p><hr><p>é‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ Swift å±æ€§è§‚å¯Ÿå™¨åšäº›ä»€ä¹ˆå‘¢ï¼Ÿä»¥ä¸‹æ˜¯ä¸€äº›ä¾›ä½ å‚è€ƒçš„æƒ³æ³•ï¼š</p><hr><h2 id=æ ‡å‡†åŒ–æˆ–éªŒè¯å€¼>æ ‡å‡†åŒ–æˆ–éªŒè¯å€¼</h2><p>æœ‰æ—¶ï¼Œä½ å¸Œæœ›å¯¹ç±»å‹æ¥å—çš„å€¼å¢åŠ é¢å¤–çš„çº¦æŸã€‚</p><p>ä¾‹å¦‚ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå’Œæ”¿åºœæœºæ„å¯¹æ¥çš„åº”ç”¨ç¨‹åºï¼Œä½ éœ€è¦ä¿è¯ç”¨æˆ·å¡«å†™äº†æ‰€æœ‰çš„å¿…å¡«é¡¹å¹¶ä¸”ä¸åŒ…å«éæ³•çš„å€¼æ‰èƒ½æäº¤è¡¨å•ã€‚</p><p>å¦‚æœä¸€ä¸ªè¡¨å•è¦æ±‚åç§°å­—æ®µä½¿ç”¨å¤§å†™å­—æ¯ä¸”ä¸ä½¿ç”¨é‡éŸ³ç¬¦å·ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>didSet</code> å±æ€§è§‚å¯Ÿå™¨è‡ªåŠ¨å»é™¤é‡éŸ³ç¬¦å·å¹¶è½¬åŒ–ä¸ºå¤§å†™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>var</span> name: String? {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>didSet</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.name = <span style=color:#66d9ef>self</span>.name?
</span></span><span style=display:flex><span>                        .applyingTransform(.stripDiacritics,
</span></span><span style=display:flex><span>                                            reverse: <span style=color:#66d9ef>false</span>)?
</span></span><span style=display:flex><span>                        .uppercased()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å¹¸è¿çš„æ˜¯åœ¨è§‚å¯Ÿå™¨å†…éƒ¨è®¾ç½®å±æ€§ä¸ä¼šè§¦å‘é¢å¤–çš„å›è°ƒï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç ä¸­ä¸ä¼šäº§ç”Ÿæ— é™å¾ªç¯ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥ä¸ä½¿ç”¨ <code>willSet</code> è§‚å¯Ÿå™¨æ˜¯å› ä¸ºå³ä½¿æˆ‘ä»¬åœ¨å…¶å›è°ƒä¸­è¿›è¡Œä»»ä½•èµ‹å€¼ï¼Œéƒ½ä¼šåœ¨å±æ€§è¢«èµ‹äºˆ <code>newValue</code> æ—¶è¦†ç›–ã€‚</p><p>è™½ç„¶è¿™ç§æ–¹æ³•å¯ä»¥è§£å†³ä¸€æ¬¡æ€§é—®é¢˜ï¼Œä½†åƒè¿™æ ·éœ€è¦é‡å¤ä½¿ç”¨çš„ä¸šåŠ¡é€»è¾‘å¯ä»¥å°è£…åˆ°ä¸€ä¸ªç±»å‹ä¸­ã€‚</p><p>æ›´å¥½çš„è®¾è®¡æ˜¯åˆ›å»ºä¸€ä¸ª <code>NormalizedText</code> ç±»å‹ï¼Œå®ƒå°è£…äº†è¦ä»¥è¿™ç§å½¢å¼è¾“å…¥çš„æ–‡æœ¬çš„è§„åˆ™ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>NormalizedText</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>Error</span>: Swift.Error {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> empty
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> excessiveLength
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> unsupportedCharacters
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>let</span> maximumLength = <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span>(<span style=color:#66d9ef>set</span>) <span style=color:#66d9ef>var</span> value: String
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>_</span> string: String) <span style=color:#66d9ef>throws</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> string.isEmpty {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> Error.empty
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>let</span> value = string.applyingTransform(.stripDiacritics,
</span></span><span style=display:flex><span>                                                   reverse: <span style=color:#66d9ef>false</span>)?
</span></span><span style=display:flex><span>                                .uppercased(),
</span></span><span style=display:flex><span>              value.canBeConverted(to: .ascii)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>throw</span> Error.unsupportedCharacters
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>guard</span> value.count <span style=color:#f92672>&lt;</span> NormalizedText.maximumLength <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> Error.excessiveLength
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.value = value
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä¸€ä¸ªå¯æŠ›å‡ºå¼‚å¸¸çš„åˆå§‹åŒ–æ–¹æ³•å¯ä»¥å‘è°ƒç”¨è€…å‘é€é”™è¯¯ä¿¡æ¯ï¼Œè¿™æ˜¯ <code>didSet</code> è§‚å¯Ÿå™¨æ— æ³•åšåˆ°çš„ã€‚ç°åœ¨é¢å¯¹<a href=https://zh.wikipedia.org/wiki/%E5%85%B0%E9%9F%A6%E5%B0%94%E6%99%AE%E5%B0%94%E5%8F%A4%E5%9B%A0%E5%90%89%E5%B0%94%E6%88%88%E6%A0%BC%E9%87%8C%E6%83%A0%E5%B0%94%E6%81%A9%E5%BE%B7%E7%BD%97%E5%B8%83%E5%B0%94%E5%85%B0%E8%92%82%E8%A5%BF%E5%88%A9%E5%A5%A5%E6%88%88%E6%88%88%E6%88%88%E8%B5%AB>å…°éŸ¦å°”æ™®å°”å¤å› å‰å°”æˆˆæ ¼é‡Œæƒ å°”æ©å¾·ç½—å¸ƒå°”å…°è’‚è¥¿åˆ©å¥¥æˆˆæˆˆæˆˆèµ«</a> çš„ <em>çº¦ç¿°å°¼</em> è¿™æ ·çš„éº»çƒ¦åˆ¶é€ è€…ï¼Œæˆ‘ä»¬èƒ½ä¸ºä»–åšäº›ä»€ä¹ˆï¼ï¼ˆæ¢è¨€ä¹‹ï¼Œä»¥åˆç†çš„æ–¹å¼ä¼ è¾¾é”™è¯¯æ¯”æä¾›æ— æ•ˆçš„æ•°æ®æ›´å¥½ï¼‰</p><h2 id=ä¼ æ’­ä¾èµ–çŠ¶æ€>ä¼ æ’­ä¾èµ–çŠ¶æ€</h2><p>å±æ€§è§‚å¯Ÿå™¨çš„å¦ä¸€ä¸ªæ½œåœ¨ç”¨ä¾‹æ˜¯å°†çŠ¶æ€ä¼ æ’­åˆ°ä¾èµ–äºè§†å›¾æ§åˆ¶å™¨çš„ç»„ä»¶ã€‚</p><p>è€ƒè™‘ä¸‹é¢çš„ <code>Track</code> æ¨¡å‹ç¤ºä¾‹å’Œä¸€ä¸ªå‘ˆç°å®ƒçš„ <code>TrackViewController</code>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Track</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> title: String
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> audioURL: URL
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TrackViewController</span>: UIViewController {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> player: AVPlayer?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> track: Track? {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>willSet</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.player?.pause()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>didSet</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>let</span> track = <span style=color:#66d9ef>self</span>.track <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.title = track.title
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> item = AVPlayerItem(url: track.audioURL)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.player = AVPlayer(playerItem: item)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.player?.play()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å½“è§†å›¾æ§åˆ¶å™¨çš„ <code>track</code> å±æ€§è¢«èµ‹å€¼ï¼Œä»¥ä¸‹äº‹æƒ…ä¼šè‡ªåŠ¨å‘ç”Ÿï¼š</p><ol><li>ä¹‹å‰è½¨é“çš„éŸ³é¢‘éƒ½ä¼šæš‚åœ</li><li>è§†å›¾æ§åˆ¶å™¨çš„ <code>title</code> ä¼šè¢«è®¾ç½®ä¸ºæ–°è½¨é“å¯¹è±¡çš„æ ‡é¢˜</li><li>æ–°è½¨é“å¯¹è±¡çš„éŸ³é¢‘ä¿¡æ¯ä¼šè¢«åŠ è½½å¹¶æ’­æ”¾</li></ol><p><em>å¾ˆé…·, å¯¹å—?</em></p><p>ä½ ç”šè‡³å¯ä»¥åƒ<a href="https://www.youtube.com/watch?v=TVAhhVrpkwM"><em>æ•é¼ è®°</em> ä¸­æç»˜çš„åœºæ™¯</a> ä¸€æ ·ï¼Œå°†è¡Œä¸ºä¸å¤šä¸ªè§‚å¯Ÿå±æ€§çº§è”èµ·æ¥ã€‚</p><hr><p>å½“ç„¶ï¼Œè§‚å¯Ÿå™¨ä¹Ÿå­˜åœ¨ä¸€å®šçš„å‰¯ä½œç”¨ï¼Œå®ƒä½¿å¾—æœ‰äº›å¤æ‚çš„è¡Œä¸ºéš¾ä»¥è¢«æ¨æ–­ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨ç¼–ç¨‹ä¸­éœ€è¦é¿å…çš„ã€‚ä»Šååœ¨ä½¿ç”¨è¿™ä¸€ç‰¹æ€§çš„åŒæ—¶ä¹Ÿéœ€è¦æ³¨æ„è¿™ä¸€ç‚¹ã€‚</p><p>ç„¶è€Œï¼Œåœ¨è¿™æ‘‡æ‘‡æ¬²å çš„æŠ½è±¡å¡”çš„é¡¶ç«¯ï¼Œä¸€å®šé™åº¦çš„ç³»ç»Ÿæ··ä¹±æ˜¯è¯±äººçš„ï¼Œæœ‰æ—¶æ˜¯å€¼å¾—çš„ã€‚ä¸€ç›´éµå¾ªè§„åˆ™çš„æ˜¯æ³¢å°”ç†è®ºè€Œéçˆ±å› æ–¯å¦ã€‚</p><hr><p>é™¤é<a href=https://nshipster.cn/ target=_blank>å¦æœ‰å£°æ˜</a>ï¼Œæœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ã€Œ<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 3.0 ä¸­å›½å¤§é™†</a>ã€è®¸å¯åè®®æˆæƒã€‚</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top Â· å›é¡¶éƒ¨" rel=nofollow>&#127772;2018-08-20 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2026 Mattt ç‰ˆæƒæ‰€æœ‰</a><a href=https://autoptr.top/ title="Back to Home Â· å›é¦–é¡µ">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>æ ‡ç­¾:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>åˆ†ç±»:</span><li><a class=link href=https://autoptr.top/categories/Swift target=_blank>Swift</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>