<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>Extended File Attributes</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="Extended File Attributes,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="Extended File Attributes,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"ğŸŒœ"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>Extended File Attributes</span><span class=btRight><span title="Author Â· ä½œè€…" class=author>Mattt</span> <span title="Translator Â· ç¿»è¯‘" class=author>April Peng</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post Â· å…³è”æˆ–è½¬è½½å¼•ç”¨çš„æ–‡ç« " target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics Â· å›ä¸»é¢˜é¡µ">&#127793;</a></span></h1><p>åœ¨ NSA æŠ«éœ²çš„é—´è°æ´»åŠ¨ä¸­ï¼Œåœ¨å¤§ä¼—çš„å…³æ³¨ä¸‹ï¼Œå…ƒæ•°æ®çš„æ¦‚å¿µåœ¨æ”¿åºœç›‘æ§ä¸­æ‹…å½“äº†æ„æƒ³ä¸åˆ°çš„è§’è‰²ã€‚å®ƒæ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ­ç¤ºäº†æˆ‘ä»¬çš„ä»€ä¹ˆä¿¡æ¯å’Œå“ªäº›æ—¥å¸¸ä¹ æƒ¯ï¼Ÿè¿™äº›æ˜¯ç¾å›½äººæ°‘éƒ½åœ¨é—®çš„é—®é¢˜ï¼Œä»–ä»¬éœ€è¦ä¸€ä¸ªç­”æ¡ˆã€‚</p><p>æˆ‘ä»¬ç§‰ç€å±±å§†å¤§å”å¤§è´¥å…±äº§ä¸»ä¹‰æ‰èƒ½åª²ç¾çš„å…¬æ°‘å’Œçˆ±å›½è´£ä»»æ„Ÿï¼ŒNSHipster è¦åƒæ–¯è¯ºç™»ä¸€æ ·ï¼ŒæŠŠ metadata èº«ä¸Šçš„å…‰é²œäº®ä¸½éƒ½æ‰’æ‰ï¼Œç»™å¤§å®¶çœ‹çœ‹ä»–åŸæœ¬æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚</p><hr><p>åœ¨ UNIX æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ¯ä¸ªæ–‡ä»¶ï¼Œéƒ½æœ‰å…³è”çš„å…ƒæ•°æ®ã€‚äº‹å®ä¸Šï¼Œä¸€ä¸ªè·¯å¾„ï¼Œæƒé™å’Œæ—¶é—´æˆ³æ˜¯ä½¿ä¸€ä¸ªæ–‡ä»¶ä¹‹æ‰€ä»¥æˆä¸ºæ–‡ä»¶çš„å±æ€§ï¼Œè€Œä¸åªæ˜¯ä¸€ä¸ªæ•°æ®ç‚¹ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨ OS X å’Œ iOSï¼Œé¢å¤–çš„å…ƒæ•°æ®å¯ä»¥å­˜å‚¨åœ¨<a href=https://en.wikipedia.org/wiki/Extended_file_attributes><strong>æ‰©å±•æ–‡ä»¶å±æ€§</strong></a>ä¸­ã€‚è¿™æ˜¯åœ¨ OS X Tiger ä¸­è¢«å¼•å…¥çš„ï¼ŒæŠŠé‚£äº›å°‘é‡çš„ï¼Œåº”ç”¨ç¨‹åºç‰¹å®šçš„æ•°æ®å…³è”åˆ°ä¸€ä¸ªæ–‡ä»¶æ¥è¯´æ˜¯å®Œç¾çš„è§£å†³åŠæ³•ã€‚EAs å­˜å‚¨åœ¨ HFS+ æ–‡ä»¶ç³»ç»Ÿçš„ B*-Tree ä¸­ï¼Œå¹¶åœ¨OS X Lion å’Œ iOS 5 ä¸­æœ‰æœ€å¤§ 128KB çš„å®¹é‡ã€‚</p><p>ä½ é—®è¿™æ˜¯ä»€ä¹ˆæ ·çš„ä¿¡æ¯ï¼Ÿåœ¨ç»ˆç«¯è°ƒç”¨ <code>ls</code> å‘½ä»¤ï¼Œå¹¶é€šè¿‡ <code>@</code> é€‰é¡¹æ¥æŸ¥çœ‹åœ¨ä¼—ç›®ç½ç½ä¸‹éšè—äº†ä»€ä¹ˆæ ·çš„ä¿¡æ¯ã€‚</p><pre tabindex=0><code>$ ls -l@
-rw-r--r--@ 1 mattt  staff  12292 Oct 19 05:59 .DS_Store
	com.apple.FinderInfo	   32
-rw-r--r--@ 1 mattt  staff   5147 Dec  3 05:01 NSFixie.h
	com.apple.TextEncoding	   15
-rw-r--r--@ 1 mattt  staff   5147 Dec  3 05:04 NSFixie.m
-rw-r--r--@ 1 mattt  staff   1438 Dec 18 14:31 Podfile
	com.macromates.selectionRange	     4
	com.macromates.visibleIndex	     1
</code></pre><ul><li>Finder å­˜å‚¨äº† 32 ä¸ªå­—èŠ‚çš„ä¿¡æ¯åœ¨ <code>.DS_Store</code>ï¼Œä½†å…¶åŸå› å°šä¸å®Œå…¨æ¸…æ¥šã€‚</li><li>Xcode ä¸­éœ€è¦ 15 ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶è¡¨ç¤º TextEncoding ã€‚</li><li>TextMate ç”¨æ‰©å±•å±æ€§ä¿ç•™å¯åŠ¨æ—¶çš„å…‰æ ‡ä½ç½®ã€‚</li></ul><p>æ‰©å±•å±æ€§ API å£°æ˜åœ¨ <code>&lt;sys/xattr.h></code>ï¼Œæœ‰è·å–ï¼Œè®¾ç½®ï¼Œåˆ—å‡ºå’Œåˆ é™¤å±æ€§çš„åŠŸèƒ½ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>ssize_t <span style=color:#a6e22e>getxattr</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>path, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>name, <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>value, size_t size, u_int32_t position, <span style=color:#66d9ef>int</span> options);
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>setxattr</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>path, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>name, <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>value, size_t size, u_int32_t position, <span style=color:#66d9ef>int</span> options);
</span></span><span style=display:flex><span>ssize_t <span style=color:#a6e22e>listxattr</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>path, <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>namebuf, size_t size, <span style=color:#66d9ef>int</span> options);
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>removexattr</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>path, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>name, <span style=color:#66d9ef>int</span> options);
</span></span></code></pre></div><p>ä¸ºäº†æ˜¾ç¤ºè¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬æ¥å‡è®¾ä½¿ç”¨æ‰©å±•å±æ€§æŠŠä¸€ä¸ª <a href=https://en.wikipedia.org/wiki/HTTP_ETag>HTTP Etag</a> ä¸ä¸€ä¸ªæ–‡ä»¶ç›¸å…³è”ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSHTTPURLResponse <span style=color:#f92672>*</span>response <span style=color:#f92672>=</span> ...;
</span></span><span style=display:flex><span>NSURL <span style=color:#f92672>*</span>fileURL <span style=color:#f92672>=</span> ...;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>filePath <span style=color:#f92672>=</span> [fileURL fileSystemRepresentation];
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;com.Example.Etag&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>value <span style=color:#f92672>=</span> [[response allHeaderFields][<span style=color:#e6db74>@&#34;Etag&#34;</span>] UTF8String];
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> result <span style=color:#f92672>=</span> setxattr(filePath, name, value, strlen(value), <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span></code></pre></div><p>ä¸¾å¦ä¸€ä¸ª iOS 5.0.1 çš„ä¾‹å­ï¼ŒEAs æ˜¯è®¾è®¡æ¥è¡¨ç¤ºä¸€ä¸ªä¸åº”è¯¥è¢« iCloud åŒæ­¥çš„ç‰¹å®šæ–‡ä»¶ï¼ˆå¦‚ iOS 5.1 ä¸­ï¼Œå¦‚æœä½¿ç”¨ <code>NSURL -setResourceValue:forKey:error:</code>ï¼Œå®ƒå°†è®¾ç½® <code>com.apple.metadata:com_apple_backup_excludeItem</code> çš„ EAï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/xattr.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!&amp;</span>NSURLIsExcludedFromBackupKey) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// iOS &lt;= 5.0.1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>filePath <span style=color:#f92672>=</span> [[URL path] fileSystemRepresentation];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;com.apple.MobileBackup&#34;</span>;
</span></span><span style=display:flex><span>    u_int8_t value <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> result <span style=color:#f92672>=</span> setxattr(filePath, name, <span style=color:#f92672>&amp;</span>value, <span style=color:#66d9ef>sizeof</span>(value), <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// iOS &gt;= 5.1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NSError <span style=color:#f92672>*</span>error <span style=color:#f92672>=</span> nil;
</span></span><span style=display:flex><span>    [URL setResourceValue:<span style=color:#ae81ff>@YES</span>
</span></span><span style=display:flex><span>                   forKey:NSURLIsExcludedFromBackupKey
</span></span><span style=display:flex><span>                    error:<span style=color:#f92672>&amp;</span>error];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä¸ºäº†é¿å…æ‰©å±•å±æ€§å˜æˆä¸ â€œå¯¹ä¸€æŠŠé”¤å­æ¥è¯´ï¼Œä¸€åˆ‡çœ‹èµ·æ¥éƒ½åƒé’‰å­â€ æ¥è¿‘çš„ç»“æœï¼Œæˆ‘ä»¬éœ€è¦æ¸…æ¥šçš„æ˜¯ï¼š<strong>æ‰©å±•å±æ€§ä¸åº”è¯¥è¢«ç”¨äºå…³é”®æ•°æ®</strong>ã€‚å¹¶éæ‰€æœ‰å·æ ¼å¼æ”¯æŒæ‰©å±•å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒHFS+ å’Œ FAT32 ä¹‹é—´çš„å¤åˆ¶å¯èƒ½å¯¼è‡´ä¿¡æ¯ä¸¢å¤±ã€‚åŒæ—¶ä¹Ÿéœ€è¦æ¸…æ¥šï¼Œæ²¡æœ‰ä»€ä¹ˆèƒ½é˜»æ­¢ä»»ä½•åº”ç”¨ç¨‹åºåœ¨ä»»ä½•æ—¶å€™åˆ é™¤æˆ–è¦†ç›–æ‰©å±•å±æ€§ã€‚</p><p>å¯¹äºåƒä½œè€…ï¼Œæ–‡ä»¶å†å²è®°å½•ï¼Œçª—å£æˆ–å…‰æ ‡ä½ç½®ï¼Œæˆ–è€…ç½‘ç»œçš„å…ƒæ•°æ®ï¼Œæ‰©å±•å±æ€§æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å¦‚æœä½ ä¸€ç›´åœ¨åŠªåŠ›åŒæ­¥æ–‡ä»¶çš„çŠ¶æ€ï¼Œè¿™å¯èƒ½æ­£æ˜¯ä½ ä¸€ç›´åœ¨å¯»æ‰¾çš„è§£å†³æ–¹æ¡ˆã€‚åªæ˜¯è¦ç•™æ„æœ‰å…³ EAs çš„å±€é™å’Œç†è§£ä»–ä»¬ä¸ºä»€ä¹ˆä¼šæˆ–ä¸ä¼šé€‚ç”¨ç‰¹å®šçš„ç”¨ä¾‹ã€‚</p><hr><p>å›½å†…çš„çªƒå¬é—¨ï¼Œæ‹™åŠ£æ¨å‡ºçš„ <a href=https://www.healthcare.gov>healthcare.gov</a>ï¼Œé›¶å”®å•†æ³„éœ²å®¢æˆ·ä¿¡æ¯ï¼Œä»¥åŠç¤¾äº¤ç½‘ç»œä¸Šçš„æ•°ä¸æ¸…çš„æ•…äº‹ï¼Œéƒ½ä¸éš¾çœ‹å‡ºæˆ‘ä»¬çš„æ–‡åŒ–å·²ç»å°†å®ƒçš„å…³ç³»è½¬ç§»åˆ°è®¡ç®—æœºä¸Šã€‚ç°åœ¨çš„äººæ›´ç²¾é€šæŠ€æœ¯ï¼ŒåŒæ—¶ä¹Ÿéšè—äº†æ–°å‘ç°çš„æ€€ç–‘å’ŒæŠ€æœ¯çš„ä¸ä¿¡ä»»ã€‚</p><p>çŸ¥é“äº†æ•°æ®ï¼Œå…ƒæ•°æ®ï¼Œä»¥åŠä¸è¿™ä¸¤ä¸ªäº¤äº’çš„å®ä½“ä¹‹é—´çš„å…³ç³»ï¼Œå°±å¯ä»¥å¾ˆå¥½åœ°ç†è§£å’Œé€‚åº”æœªæ¥ã€‚ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘ä»¬æ˜¯è‡ªå·±å’Œä»–äººæ•°å­—åŒ–ç°å®çš„æå«è€…ï¼›çœŸè¯šå¹¶å‡­è‰¯å¿ƒåŠäº‹æ˜¯æˆ‘ä»¬çš„è´£ä»»ã€‚è®¤çœŸå¯¹å¾…è¿™ä¸€è´£ä»»æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½æ›´åŠ é‡è¦ã€‚ç„¶è€Œï¼Œä½“ç°åœ¨ä½ çš„èŒä¸šé‡Œçš„å°±æ˜¯ï¼Œåšå¥½ä½ åœ¨åšçš„ã€‚</p><hr><p>é™¤é<a href=https://nshipster.cn/ target=_blank>å¦æœ‰å£°æ˜</a>ï¼Œæœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ã€Œ<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 3.0 ä¸­å›½å¤§é™†</a>ã€è®¸å¯åè®®æˆæƒã€‚</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top Â· å›é¡¶éƒ¨" rel=nofollow>&#127772;2014-01-20 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2026 Mattt ç‰ˆæƒæ‰€æœ‰</a><a href=https://autoptr.top/ title="Back to Home Â· å›é¦–é¡µ">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>æ ‡ç­¾:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>åˆ†ç±»:</span><li><a class=link href=https://autoptr.top/categories/Objective-C target=_blank>Objective-C</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>