<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>NSFileManager</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="NSFileManager,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªå¤æ‚çš„ä¸»é¢˜ï¼Œå®ƒæœ‰æ•°åå¹´çš„å†å²ï¼Œä¸€äº›é—ç•™ä¸‹çš„å¤æ‚æ€§å’Œä¸€äº›ç‰¹åˆ«çš„åœ°æ–¹ï¼Œå·²ç»ä¸æ˜¯ä¸€ç¯‡æ–‡ç« å°±å¯ä»¥æè¿°çš„äº†ã€‚ç°åœ¨å¤§å¤šæ•°çš„åº”ç”¨é™¤äº†ç®€å•çš„æ–‡ä»¶æ“ä½œä¹‹å¤–ä¸ä¼šç»å¸¸ä¸æ–‡ä»¶ç³»ç»Ÿäº¤äº’ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ç®€å•äº†è§£å®ƒçš„åŸºç¡€å°±è¡Œäº†ã€‚"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"ğŸŒœ"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>NSFileManager</span><span class=btRight><span title="Author Â· ä½œè€…" class=author>Mattt</span> <span title="Translator Â· ç¿»è¯‘" class=author>Lin Xiangyu</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post Â· å…³è”æˆ–è½¬è½½å¼•ç”¨çš„æ–‡ç« " target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics Â· å›ä¸»é¢˜é¡µ">&#127793;</a></span></h1><p><code>NSFileManager</code> æ˜¯å¤„ç†æ–‡ä»¶ç³»ç»Ÿçš„ Foundation æ¡†æ¶çš„é«˜çº§APIã€‚å®ƒæŠ½è±¡äº† Unix å’Œ Finder çš„å†…éƒ¨æ„æˆï¼Œå’Œ iCloud ubiquitous containers ä¸€æ ·ï¼Œ æä¾›äº†åˆ›å»ºï¼Œè¯»å–ï¼Œç§»åŠ¨ï¼Œæ‹·è´ä»¥åŠåˆ é™¤æœ¬åœ°æˆ–è€…ç½‘ç»œé©±åŠ¨å™¨ä¸Šçš„æ–‡ä»¶æˆ–è€…ç›®å½•çš„æ–¹æ³•ã€‚</p><p>æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªå¤æ‚çš„ä¸»é¢˜ï¼Œå®ƒæœ‰æ•°åå¹´çš„å†å²ï¼Œä¸€äº›é—ç•™ä¸‹çš„å¤æ‚æ€§å’Œä¸€äº›ç‰¹åˆ«çš„åœ°æ–¹ï¼Œå·²ç»ä¸æ˜¯ä¸€ç¯‡æ–‡ç« å°±å¯ä»¥æè¿°çš„äº†ã€‚ç°åœ¨å¤§å¤šæ•°çš„åº”ç”¨é™¤äº†ç®€å•çš„æ–‡ä»¶æ“ä½œä¹‹å¤–ä¸ä¼šç»å¸¸ä¸æ–‡ä»¶ç³»ç»Ÿäº¤äº’ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ç®€å•äº†è§£å®ƒçš„åŸºç¡€å°±è¡Œäº†ã€‚</p><p>ä½ å¯ä»¥å¤åˆ¶ç²˜è´´ä¸‹é¢çš„ä»£ç è¯•è¯•çœ‹ï¼Œç”¨ä»–ä»¬ä½œä¸ºä½ çš„ä»£ç åŸºç¡€ï¼Œä¿®æ”¹è¿™äº›å‚æ•°æ¥è¾¾åˆ°ä½ æœŸæœ›çš„æ•ˆæœã€‚</p><h2 id=å¸¸ç”¨æ“ä½œ>å¸¸ç”¨æ“ä½œ</h2><p>çºµè§‚è‹¹æœæä¾›çš„æ ·ä¾‹ä»£ç ï¼Œå°½æ˜¯è¿™æ ·çš„é»‘é­”æ³•ï¼š <code>NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES)</code> ï¼Œ å®ƒæˆ–è®¸ç»‘å®šäº†KVOï¼Œä¹Ÿæ˜¯Cocoaæœ€ç³Ÿç³•çš„APIä¹‹ä¸€ã€‚ä½ åªéœ€è¦çŸ¥é“å®ƒè¿”å›äº†ä¸€ä¸ªåŒ…å«ç”¨æˆ·æ–‡æ¡£ç›®å½•ä½œä¸ºç¬¬ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„å°±è¡Œäº†ã€‚çœŸè¦æ„Ÿè°¢ <code>NSArray -firstObject</code>ã€‚</p><h2 id=ç¡®å®šæ–‡ä»¶æ˜¯å¦å­˜åœ¨>ç¡®å®šæ–‡ä»¶æ˜¯å¦å­˜åœ¨</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>
</span></span><span style=display:flex><span>NSFileManager <span style=color:#f92672>*</span>fileManager <span style=color:#f92672>=</span> [NSFileManager defaultManager];
</span></span><span style=display:flex><span>NSString <span style=color:#f92672>*</span>documentsPath <span style=color:#f92672>=</span> [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];
</span></span><span style=display:flex><span>NSString <span style=color:#f92672>*</span>filePath <span style=color:#f92672>=</span> [documentsPath stringByAppendingPathComponent:<span style=color:#e6db74>@&#34;file.txt&#34;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>BOOL</span> fileExists <span style=color:#f92672>=</span> [fileManager fileExistsAtPath:filePath];
</span></span></code></pre></div><h2 id=åˆ—å‡ºç›®å½•é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶>åˆ—å‡ºç›®å½•é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>
</span></span><span style=display:flex><span>NSFileManager <span style=color:#f92672>*</span>fileManager <span style=color:#f92672>=</span> [NSFileManager defaultManager];
</span></span><span style=display:flex><span>NSURL <span style=color:#f92672>*</span>bundleURL <span style=color:#f92672>=</span> [[NSBundle mainBundle] bundleURL];
</span></span><span style=display:flex><span>NSArray <span style=color:#f92672>*</span>contents <span style=color:#f92672>=</span> [fileManager contentsOfDirectoryAtURL:bundleURL
</span></span><span style=display:flex><span>                               includingPropertiesForKeys:<span style=color:#ae81ff>@[]</span>
</span></span><span style=display:flex><span>                                                  options:NSDirectoryEnumerationSkipsHiddenFiles
</span></span><span style=display:flex><span>                                                    error:nil];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSPredicate <span style=color:#f92672>*</span>predicate <span style=color:#f92672>=</span> [NSPredicate predicateWithFormat:<span style=color:#e6db74>@&#34;pathExtension == &#39;png&#39;&#34;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (NSURL <span style=color:#f92672>*</span>fileURL <span style=color:#66d9ef>in</span> [contents filteredArrayUsingPredicate:predicate]) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åœ¨ç›®å½•ä¸­æšä¸¾ .png æ–‡ä»¶
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><h3 id=åœ¨ç›®å½•ä¸­é€’å½’åœ°éå†æ–‡ä»¶>åœ¨ç›®å½•ä¸­é€’å½’åœ°éå†æ–‡ä»¶</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>
</span></span><span style=display:flex><span>NSFileManager <span style=color:#f92672>*</span>fileManager <span style=color:#f92672>=</span> [NSFileManager defaultManager];
</span></span><span style=display:flex><span>NSURL <span style=color:#f92672>*</span>bundleURL <span style=color:#f92672>=</span> [[NSBundle mainBundle] bundleURL];
</span></span><span style=display:flex><span>NSDirectoryEnumerator <span style=color:#f92672>*</span>enumerator <span style=color:#f92672>=</span> [fileManager enumeratorAtURL:bundleURL
</span></span><span style=display:flex><span>                                      includingPropertiesForKeys:<span style=color:#ae81ff>@[</span>NSURLNameKey, NSURLIsDirectoryKey<span style=color:#ae81ff>]</span>
</span></span><span style=display:flex><span>                                                         options:NSDirectoryEnumerationSkipsHiddenFiles
</span></span><span style=display:flex><span>                                                    errorHandler:<span style=color:#f92672>^</span><span style=color:#66d9ef>BOOL</span>(NSURL <span style=color:#f92672>*</span>url, NSError <span style=color:#f92672>*</span>error)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (error) {
</span></span><span style=display:flex><span>        NSLog(<span style=color:#e6db74>@&#34;[Error] %@ (%@)&#34;</span>, error, url);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> NO;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> YES;
</span></span><span style=display:flex><span>}];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSMutableArray <span style=color:#f92672>*</span>mutableFileURLs <span style=color:#f92672>=</span> [NSMutableArray array];
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (NSURL <span style=color:#f92672>*</span>fileURL <span style=color:#66d9ef>in</span> enumerator) {
</span></span><span style=display:flex><span>    NSString <span style=color:#f92672>*</span>filename;
</span></span><span style=display:flex><span>    [fileURL getResourceValue:<span style=color:#f92672>&amp;</span>filename forKey:NSURLNameKey error:nil];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    NSNumber <span style=color:#f92672>*</span>isDirectory;
</span></span><span style=display:flex><span>    [fileURL getResourceValue:<span style=color:#f92672>&amp;</span>isDirectory forKey:NSURLIsDirectoryKey error:nil];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Skip directories with &#39;_&#39; prefix, for example
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> ([filename hasPrefix:<span style=color:#e6db74>@&#34;_&#34;</span>] <span style=color:#f92672>&amp;&amp;</span> [isDirectory boolValue]) {
</span></span><span style=display:flex><span>        [enumerator skipDescendants];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>[isDirectory boolValue]) {
</span></span><span style=display:flex><span>        [mutableFileURLs addObject:fileURL];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=åˆ›å»ºä¸€ä¸ªç›®å½•>åˆ›å»ºä¸€ä¸ªç›®å½•</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>
</span></span><span style=display:flex><span>NSFileManager <span style=color:#f92672>*</span>fileManager <span style=color:#f92672>=</span> [NSFileManager defaultManager];
</span></span><span style=display:flex><span>NSString <span style=color:#f92672>*</span>documentsPath <span style=color:#f92672>=</span> [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];
</span></span><span style=display:flex><span>NSString <span style=color:#f92672>*</span>imagesPath <span style=color:#f92672>=</span> [documentsPath stringByAppendingPathComponent:<span style=color:#e6db74>@&#34;images&#34;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>[fileManager fileExistsAtPath:imagesPath]) {
</span></span><span style=display:flex><span>    [fileManager createDirectoryAtPath:imagesPath withIntermediateDirectories:NO attributes:nil error:nil];
</span></span><span style=display:flex><span>}<span style=color:#960050;background-color:#1e0010>ï¼½</span>
</span></span></code></pre></div><h3 id=åˆ é™¤ä¸€ä¸ªç›®å½•>åˆ é™¤ä¸€ä¸ªç›®å½•</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSFileManager <span style=color:#f92672>*</span>fileManager <span style=color:#f92672>=</span> [NSFileManager defaultManager];
</span></span><span style=display:flex><span>NSString <span style=color:#f92672>*</span>documentsPath <span style=color:#f92672>=</span> [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];
</span></span><span style=display:flex><span>NSString <span style=color:#f92672>*</span>filePath <span style=color:#f92672>=</span> [documentsPath stringByAppendingPathComponent:<span style=color:#e6db74>@&#34;image.png&#34;</span>];
</span></span><span style=display:flex><span>NSError <span style=color:#f92672>*</span>error <span style=color:#f92672>=</span> nil;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>[fileManager removeItemAtPath:filePath error:<span style=color:#f92672>&amp;</span>error]) {
</span></span><span style=display:flex><span>    NSLog(<span style=color:#e6db74>@&#34;[Error] %@ (%@)&#34;</span>, error, filePath);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=åˆ é™¤æ–‡ä»¶çš„åˆ›å»ºæ—¥æœŸ>åˆ é™¤æ–‡ä»¶çš„åˆ›å»ºæ—¥æœŸ</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>
</span></span><span style=display:flex><span>NSFileManager <span style=color:#f92672>*</span>fileManager <span style=color:#f92672>=</span> [NSFileManager defaultManager];
</span></span><span style=display:flex><span>NSString <span style=color:#f92672>*</span>documentsPath <span style=color:#f92672>=</span> [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];
</span></span><span style=display:flex><span>NSString <span style=color:#f92672>*</span>filePath <span style=color:#f92672>=</span> [documentsPath stringByAppendingPathComponent:<span style=color:#e6db74>@&#34;Document.pages&#34;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSDate <span style=color:#f92672>*</span>creationDate <span style=color:#f92672>=</span> nil;
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ([fileManager fileExistsAtPath:filePath]) {
</span></span><span style=display:flex><span>    NSDictionary <span style=color:#f92672>*</span>attributes <span style=color:#f92672>=</span> [fileManager attributesOfItemAtPath:filePath error:nil];
</span></span><span style=display:flex><span>    creationDate <span style=color:#f92672>=</span> attributes[NSFileCreationDate];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>é€šè¿‡NSFileManagerçš„ <code>-attributesOfItemAtPath:error:</code> å’Œå…¶å®ƒæ–¹æ³•å¯ä»¥è®¿é—®å¾ˆå¤šæ–‡ä»¶çš„å±æ€§</p><h4 id=æ–‡ä»¶å±æ€§çš„é”®>æ–‡ä»¶å±æ€§çš„é”®</h4><blockquote><ul><li><code>NSFileAppendOnly</code>: æ–‡ä»¶æ˜¯å¦åªè¯»</li><li><code>NSFileBusy</code>: æ–‡ä»¶æ˜¯å¦ç¹å¿™</li><li><code>NSFileCreationDate</code>: æ–‡ä»¶åˆ›å»ºæ—¥æœŸ</li><li><code>NSFileOwnerAccountName</code>: æ–‡ä»¶æ‰€æœ‰è€…çš„åå­—</li><li><code>NSFileGroupOwnerAccountName</code>: æ–‡ä»¶æ‰€æœ‰ç»„çš„åå­—</li><li><code>NSFileDeviceIdentifier</code>: æ–‡ä»¶æ‰€åœ¨é©±åŠ¨å™¨çš„æ ‡ç¤ºç¬¦</li><li><code>NSFileExtensionHidden</code>: æ–‡ä»¶åç¼€æ˜¯å¦éšè—</li><li><code>NSFileGroupOwnerAccountID</code>: æ–‡ä»¶æ‰€æœ‰ç»„çš„group ID</li><li><code>NSFileHFSCreatorCode</code>: æ–‡ä»¶çš„HFSåˆ›å»ºè€…çš„ä»£ç </li><li><code>NSFileHFSTypeCode</code>: æ–‡ä»¶çš„HFSç±»å‹ä»£ç </li><li><code>NSFileImmutable</code>: æ–‡ä»¶æ˜¯å¦å¯ä»¥æ”¹å˜</li><li><code>NSFileModificationDate</code>: æ–‡ä»¶ä¿®æ”¹æ—¥æœŸ</li><li><code>NSFileOwnerAccountID</code>: æ–‡ä»¶æ‰€æœ‰è€…çš„ID</li><li><code>NSFilePosixPermissions</code>: æ–‡ä»¶çš„Posixæƒé™</li><li><code>NSFileReferenceCount</code>: æ–‡ä»¶çš„é“¾æ¥æ•°é‡</li><li><code>NSFileSize</code>: æ–‡ä»¶çš„å­—èŠ‚</li><li><code>NSFileSystemFileNumber</code>: æ–‡ä»¶åœ¨æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶æ•°é‡</li><li><code>NSFileType</code>: æ–‡ä»¶ç±»å‹</li><li><code>NSDirectoryEnumerationSkipsSubdirectoryDescendants</code>: æµ…å±‚çš„æšä¸¾ï¼Œä¸ä¼šæšä¸¾å­ç›®å½•</li><li><code>NSDirectoryEnumerationSkipsPackageDescendants</code>: ä¸ä¼šæ‰«æpakagesçš„å†…å®¹</li><li><code>NSDirectoryEnumerationSkipsHiddenFile</code>: ä¸ä¼šæ‰«æéšè—æ–‡ä»¶</li></ul></blockquote><h2 id=nsfilemanagerdelegate>NSFileManagerDelegate</h2><p>NSFileManager å¯ä»¥è®¾ç½®ä¸€ä¸ª <code>&lt;NSFileManagerDelegate></code> protocol æ¥ç¡®è®¤æ˜¯å¦è¦è¿›è¡Œç‰¹å®šçš„æ–‡ä»¶æ“ä½œã€‚å®ƒå…è®¸è¿›è¡Œä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚ä¿æŠ¤ä¸€äº›æ–‡ä»¶åˆ é™¤ï¼Œåœ¨ Controller ä¸­åˆ é™¤ä¸€äº›å…ƒç´ </p><p><code>NSFileManagerDelegate</code>é‡Œé¢æœ‰å››ä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæŒ‰ç…§pathå˜åŒ–</p><ul><li><code>-fileManager:shouldMoveItemAtURL:toURL:</code></li><li><code>-fileManager:shouldCopyItemAtURL:toURL:</code></li><li><code>-fileManager:shouldRemoveItemAtURL:</code></li><li><code>-fileManager:shouldLinkItemAtURL:toURL:</code></li></ul><p>å¦‚æœä½ æƒ³ç”¨ <code>alloc init</code> åˆå§‹åŒ–ä½ è‡ªå·±çš„ <code>NSFileManager</code> æ¥å–ä»£sharedå®ä¾‹ï¼Œé‚£å°±è¦ç”¨å®ƒäº†ï¼Œå°±åƒæ–‡æ¡£è¯´çš„</p><blockquote><p>å¦‚æœä½ ä½¿ç”¨ä¸€ä¸ªdelegate æ¥æ¥å—ç§»åŠ¨ï¼Œæ‹·è´ï¼Œæ¶‰æ¡ˆå‡ºï¼Œä»¥åŠé“¾æ¥çš„æ“ä½œï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å®ä¾‹ï¼Œå°†delegateç»‘å®šåˆ°ä½ çš„å®ä¾‹ä¸­ï¼Œç”¨è¿™ä¸ªfielmanagerå¼€å§‹ä½ çš„æ“ä½œ</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>
</span></span><span style=display:flex><span>NSFileManager <span style=color:#f92672>*</span>fileManager <span style=color:#f92672>=</span> [[NSFileManager alloc] init];
</span></span><span style=display:flex><span>fileManager.delegate <span style=color:#f92672>=</span> delegate;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSURL <span style=color:#f92672>*</span>bundleURL <span style=color:#f92672>=</span> [[NSBundle mainBundle] bundleURL];
</span></span><span style=display:flex><span>NSArray <span style=color:#f92672>*</span>contents <span style=color:#f92672>=</span> [fileManager contentsOfDirectoryAtURL:bundleURL
</span></span><span style=display:flex><span>                               includingPropertiesForKeys:<span style=color:#ae81ff>@[]</span>
</span></span><span style=display:flex><span>                                                  options:NSDirectoryEnumerationSkipsHiddenFiles
</span></span><span style=display:flex><span>                                                    error:nil];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (NSString <span style=color:#f92672>*</span>filePath <span style=color:#66d9ef>in</span> contents) {
</span></span><span style=display:flex><span>    [fileManager removeItemAtPath:filePath error:nil];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=customfilemanagerdelegatem>CustomFileManagerDelegate.m</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#75715e>#pragma mark - NSFileManagerDelegate
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>- (<span style=color:#66d9ef>BOOL</span>)<span style=color:#a6e22e>fileManager:</span>(NSFileManager <span style=color:#f92672>*</span>)fileManager
</span></span><span style=display:flex><span><span style=color:#a6e22e>shouldRemoveItemAtURL:</span>(NSURL <span style=color:#f92672>*</span>)URL
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>!</span>[[[URL lastPathComponent] pathExtension] isEqualToString:<span style=color:#e6db74>@&#34;pdf&#34;</span>];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=ubiquitous-storage>Ubiquitous Storage</h2><p>æ–‡æ¡£ä¹Ÿå¯ä¸æ”¾åˆ°iCloudé‡Œé¢ã€‚å¦‚æœä½ çŒœå¯ä»¥ç›´æˆªäº†å½“çš„è¿›è¡Œæ“ä½œï¼Œæ­å–œä½ çŒœå¯¹äº†ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªå…¶å®ƒç”¨åˆ° <code>alloc init</code> çš„åœ°æ–¹ï¼Œå› ä¸º <code>URLForUbiquityContainerIdentifier: and setUbiquitous:itemAtURL:destinationURL:error:</code> æ˜¯ä»£ç å—è°ƒç”¨ï¼Œæ‰€ä»¥æ•´ä¸ªæ“ä½œéœ€è¦åœ¨åå°é˜Ÿåˆ—åˆ†å‘</p><h3 id=å°†æ–‡ä»¶æ”¾åˆ°icloudé‡Œé¢>å°†æ–‡ä»¶æ”¾åˆ°iCloudé‡Œé¢</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, <span style=color:#ae81ff>0</span>), <span style=color:#f92672>^</span>{
</span></span><span style=display:flex><span>    NSFileManager <span style=color:#f92672>*</span>fileManager <span style=color:#f92672>=</span> [[NSFileManager alloc] init];
</span></span><span style=display:flex><span>    NSString <span style=color:#f92672>*</span>documentsPath <span style=color:#f92672>=</span> [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];
</span></span><span style=display:flex><span>    NSURL <span style=color:#f92672>*</span>fileURL <span style=color:#f92672>=</span> [NSURL fileURLWithPath:[documentsPath stringByAppendingPathComponent:<span style=color:#e6db74>@&#34;Document.pages&#34;</span>]];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//è¿™é‡Œçš„ identifier åº”è¯¥è®¾ç½®ä¸º entitlements çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›å½“ä½ ä½¿ç”¨è¿™æ®µä»£ç çš„æ—¶å€™éœ€è¦æŠŠ identifier è®¾ç½®ä¸ºä½ è‡ªå·±çš„çœŸå® identifier
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NSString <span style=color:#f92672>*</span>identifier <span style=color:#f92672>=</span> nil;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    NSURL <span style=color:#f92672>*</span>ubiquitousContainerURL <span style=color:#f92672>=</span> [fileManager URLForUbiquityContainerIdentifier:identifier];
</span></span><span style=display:flex><span>    NSURL <span style=color:#f92672>*</span>ubiquitousFileURL <span style=color:#f92672>=</span> [ubiquitousContainerURL URLByAppendingPathComponent:<span style=color:#e6db74>@&#34;Document.pages&#34;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    NSError <span style=color:#f92672>*</span>error <span style=color:#f92672>=</span> nil;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>BOOL</span> success <span style=color:#f92672>=</span> [fileManager setUbiquitous:YES
</span></span><span style=display:flex><span>                                    itemAtURL:fileURL
</span></span><span style=display:flex><span>                               destinationURL:ubiquitousFileURL
</span></span><span style=display:flex><span>                                        error:<span style=color:#f92672>&amp;</span>error];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>success) {
</span></span><span style=display:flex><span>        NSLog(<span style=color:#e6db74>@&#34;[Error] %@ (%@) (%@)&#34;</span>, error, fileURL, ubiquitousFileURL);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><blockquote><p>ä½ å¯ä»¥åœ¨è‹¹æœçš„ <code>iCloud File Management</code> æ–‡æ¡£é‡Œé¢æ‰¾åˆ°æ›´å¤šä¿¡æ¯</p></blockquote><hr><p>å…³äºæ–‡ä»¶ç³»ç»Ÿéœ€è¦çŸ¥é“å¾ˆå¤šä¸œè¥¿ï¼Œä½†å¤§å¤šæ•°æ˜¯ç†è®ºæµ‹éªŒå±‚é¢çš„ã€‚åˆ«è¯¯ä¼šï¼Œè¿™äº›ç†è®ºæµ‹éªŒå¹¶æ²¡æœ‰é”™ï¼ä½†ç†è®ºå¹¶ä¸èƒ½æ•™ä½ ä»£ç è¯¥æ€ä¹ˆå†™ã€‚NSFileManagerå¯ä»¥è®©ä½ ä¸ç”¨å­¦ä¹ å®ƒä»¬å¤§å¤šæ•°çš„å†…å®¹å°±èƒ½å®Œæˆå·¥ä½œã€‚</p><hr><p>é™¤é<a href=https://nshipster.cn/ target=_blank>å¦æœ‰å£°æ˜</a>ï¼Œæœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ã€Œ<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 3.0 ä¸­å›½å¤§é™†</a>ã€è®¸å¯åè®®æˆæƒã€‚</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top Â· å›é¡¶éƒ¨" rel=nofollow>&#127772;2013-11-18 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2026 Mattt ç‰ˆæƒæ‰€æœ‰</a><a href=https://autoptr.top/ title="Back to Home Â· å›é¦–é¡µ">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>æ ‡ç­¾:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>åˆ†ç±»:</span><li><a class=link href=https://autoptr.top/categories/Cocoa target=_blank>Cocoa</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>