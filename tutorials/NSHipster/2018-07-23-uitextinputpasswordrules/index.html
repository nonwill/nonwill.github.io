<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>密码规则 / UITextInputPasswordRules</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="密码规则 / UITextInputPasswordRules,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="密码规则 / UITextInputPasswordRules,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"🌜"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>密码规则 / UITextInputPasswordRules</span><span class=btRight><span title="Author · 作者" class=author>Mattt</span> <span title="Translator · 翻译" class=author>Bei Li</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post · 关联或转载引用的文章" target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics · 回主题页">&#127793;</a></span></h1><p>也难怪 hipster 们着迷于工艺品和手工制品。不管是一片厚切鳄梨吐司、一瓶限量（非乳制）姜黄奶或一杯完美的手冲咖啡——其中的人情味是无法替代的。</p><p>相反，好密码和工艺品截然不同。密码应该完全没有任何意义，除非它是一个 90 年代骇客电影的标题或者一个密室逃脱游戏的答案。</p><p>有了 iOS 12 和 macOS Mojave 中的 Safari，生成可以想象到的最强、最没有意义、最难猜到的密码从未如此简单——这都要感谢一些新功能。</p><hr><p>理想的密码策略非常简单：强制要求最少字符数（至少 8 位）并且允许长密码（64 位或者更多）。</p><p>其他更复杂的策略，像预置的安全问题、周期性的失效密码或者强制要求一些奇怪的符号，只不过让这些策略想要保护人感到厌烦。</p><blockquote><p>但是不要太相信我说的话——我不是安全专家</p><p>相对的，请查看美国国家标准技术研究所最新发布（2017 年 6 月）的 <a href=https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63b.pdf>Digital Identity Guidelines</a></p></blockquote><p>好消息是越来越多的公司和组织开始注意安全性最佳实践了。坏消息则是改变这些事情需要进行一系列影响数百万人的大范围数据改动。事实上前面说到的安全性反面模式并不会很快消失，因为公司和政府做任何事情都需要花很久的时间。</p><h2 id=自动式强密码>自动式强密码</h2><p>Safari 的自动填充从 iOS 8 起就可以生成密码了，但是它有一个缺点就是不能保证生成的密码符合某些服务的要求。</p><p>Apple 通过 iOS 12 和 macOS Mojave 里 Safari 中的自动式强密码功能来解决这个问题。</p><p>WebKit 工程师 Daniel Bates 在 3 月 1 日给 <acronym title="Web Hypertext Application Technology Working Group">WHATWG</acronym> 提交了<a href=https://github.com/whatwg/html/issues/3518>这个提案</a>。6 月 6 日，WebKit 团队<a href=https://webkit.org/blog/8327/safari-technology-preview-58-with-safari-12-features-is-now-available/>发布了 Safari Technology Preview 58</a>，使用新属性 <code>passwordrules</code> 来支持强密码生成。同时，WWDC 发布了 iOS 12 beta SDK，包括新的 <code>UITextInputPasswordRules</code> API，还有验证码自动输入和联合身份验证等其他一些密码管理功能。</p><h2 id=密码规则>密码规则</h2><p>密码规则就像是密码生成器的配方。根据一些简单的规则，密码生成器就可以随机生成满足服务提供方需求的新密码。</p><p>密码规则由一个或多个键值对组成：</p><p><code>required: lower; required: upper; required: digit; allowed: ascii-printable; max-consecutive: 3;</code></p><h3 id=键>键</h3><p>每个规则可以指定下列键：</p><ul><li><code>required</code>: 需要的字符类型</li><li><code>allowed</code>: 允许使用的字符类型</li><li><code>max-consecutive</code>: 允许字符连续出现次数的最大值</li><li><code>minlength</code>: 密码最小长度</li><li><code>maxlength</code>: 密码最大长度</li></ul><p><code>required</code> 和 <code>allowed</code> 键使用下面列出的字符类别作为值。<code>max-consecutive</code>、<code>minlength</code> 和 <code>maxlength</code> 使用非负整数作为值。</p><h3 id=字符类别>字符类别</h3><p><code>required</code> 和 <code>allowed</code> 键可以使用下面的字符类别作为值：</p><ul><li><code>upper</code> (<code>A-Z</code>)</li><li><code>lower</code> (<code>a-z</code>)</li><li><code>digits</code> (<code>0-9</code>)</li><li><code>special</code> (<code>-~!@#$%^&\*\_+=`|(){}[:;"'&lt;>,.? ]</code> 和空格)</li><li><code>ascii-printable</code> (U+0020 — 007f)</li><li><code>unicode</code> (U+0 — 10FFFF)</li></ul><p>除了这些预置字符类别，还可以用方括号包住 ASCII 字符来指定自定义字符类别（比如 <code>[abc]</code>）。</p><hr><p>Apple 的 <a href=https://developer.apple.com/password-rules/>Password Rules Validation Tool</a> 让你可以对不同的规则进行实验，并得到实时的结果反馈。甚至可以生成并下载上千个密码用来开发和测试！</p><p><img src=/media/NSHipster/password-rules-validation-tool.png title="Password Rules Validation Tool"></p><p>更多有关于密码规则的语法，请查看 Apple 的文档<a href=https://developer.apple.com/documentation/security/password_autofill/customizing_password_autofill_rules>「Customizing Password AutoFill Rules」</a>。</p><hr><h2 id=指定密码规则>指定密码规则</h2><p>在 iOS 上，给 <code>UITextField</code> 的 <code>passwordRules</code> 属性设置一个 <code>UITextInputPasswordRules</code> 对象（同时也应该将 <code>textContentType</code> 属性设置为 <code>.newPassword</code>）：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> newPasswordTextField = UITextField()
</span></span><span style=display:flex><span>newPasswordTextField.textContentType = .newPassword
</span></span><span style=display:flex><span>newPasswordTextField.passwordRules = UITextInputPasswordRules(descriptor: <span style=color:#e6db74>&#34;required: upper; required: lower; required: digit; max-consecutive: 2; minlength: 8;&#34;</span>)
</span></span></code></pre></div><p>在网页上，设置 <code>&lt;input></code> 元素（且 <code>type="password"</code>）的 <code>passwordrules</code> 属性：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> <span style=color:#a6e22e>passwordrules</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;required: upper; required: lower; required: special; max-consecutive: 3;&#34;</span>/&gt;
</span></span></code></pre></div><blockquote><p>如果没有指定，默认的密码规则是 <code>allowed: ascii-printable</code>。如果表单中有密码验证区域，它的密码规则会从上一个区域继承下来。</p></blockquote><h2 id=在-swift-中生成密码规则>在 Swift 中生成密码规则</h2><p>不光是只有你会觉得直接使用没有良好抽象的字符串格式令人感到不安。</p><p>下面是一种将密码规则封装成 Swift API 的方式（<a href=https://github.com/NSHipster/PasswordRules>可以作为 Swift package 获取</a>）：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>PasswordRule</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>CharacterClass</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> upper, lower, digits, special, asciiPrintable, unicode
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> custom(Set&lt;Character&gt;)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>required</span>(CharacterClass)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> allowed(CharacterClass)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> maxConsecutive(UInt)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> minLength(UInt)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> maxLength(UInt)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>PasswordRule</span>: CustomStringConvertible {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> description: String {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> <span style=color:#66d9ef>self</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> .<span style=color:#66d9ef>required</span>(<span style=color:#66d9ef>let</span> characterClass):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;required: </span><span style=color:#e6db74>\(</span>characterClass<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> .allowed(<span style=color:#66d9ef>let</span> characterClass):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;allowed: </span><span style=color:#e6db74>\(</span>characterClass<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> .maxConsecutive(<span style=color:#66d9ef>let</span> length):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;max-consecutive: </span><span style=color:#e6db74>\(</span>length<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> .minLength(<span style=color:#66d9ef>let</span> length):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;minlength: </span><span style=color:#e6db74>\(</span>length<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> .maxLength(<span style=color:#66d9ef>let</span> length):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;maxlength: </span><span style=color:#e6db74>\(</span>length<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>PasswordRule</span>.CharacterClass: CustomStringConvertible {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> description: String {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> <span style=color:#66d9ef>self</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> .upper: <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;upper&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> .lower: <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;lower&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> .digits: <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;digits&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> .special: <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;special&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> .asciiPrintable: <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;ascii-printable&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> .unicode: <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;unicode&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> .custom(<span style=color:#66d9ef>let</span> characters):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;[&#34;</span> <span style=color:#f92672>+</span> String(characters) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;]&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>有了这个，我们就可以在代码里指定一些规则，然后用它们生成有效的密码规则语法字符串：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> rules: [PasswordRule] = [ .<span style=color:#66d9ef>required</span>(.upper),
</span></span><span style=display:flex><span>                              .<span style=color:#66d9ef>required</span>(.lower),
</span></span><span style=display:flex><span>                              .<span style=color:#66d9ef>required</span>(.special),
</span></span><span style=display:flex><span>                              .minLength(<span style=color:#ae81ff>20</span>) ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> descriptor = rules.map{ <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>\(</span>$0.description<span style=color:#e6db74>)</span><span style=color:#e6db74>;&#34;</span> }
</span></span><span style=display:flex><span>                      .joined(separator: <span style=color:#e6db74>&#34; &#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// &#34;required: upper; required: lower; required: special; max-consecutive: 3;&#34;</span>
</span></span></code></pre></div><p>只要你愿意，你甚至可以扩展 <code>UITextInputPasswordRules</code> 给它添加一个接收 <code>PasswordRule</code> 数组的 convenience initializer。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>UITextInputPasswordRules</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>convenience</span> <span style=color:#66d9ef>init</span>(rules: [PasswordRule]) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> descriptor = rules.map{ $0.description }
</span></span><span style=display:flex><span>                              .joined(separator: <span style=color:#e6db74>&#34;; &#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.<span style=color:#66d9ef>init</span>(descriptor: descriptor)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><p>如果你是一个在个人认证信息上非常有感情的人，喜欢在密码输入区域中的小圆点后面输入你的大学、小狗或者最喜欢的运动团队，请考虑不要再这样做了。</p><p>就我个人来说，我无法想象没有密码管理器的日子。当你知道任何时候你都能访问到你需要的信息，并且只有你能访问到时，你的心灵将会获得极大的平静。</p><p>从现在开始改变，你就能完全利用上在之后今年发布的 iOS 12 和 macOS Mojave 的 Safari 中的这些改进。</p><hr><p>除非<a href=https://nshipster.cn/ target=_blank>另有声明</a>，本文采用知识共享「<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>署名-非商业性使用 3.0 中国大陆</a>」许可协议授权。</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top · 回顶部" rel=nofollow>&#127772;2018-07-23 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2025 Mattt 版权所有</a><a href=https://autoptr.top/ title="Back to Home · 回首页">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>标签:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>分类:</span><li><a class=link href=https://autoptr.top/categories/Cocoa target=_blank>Cocoa</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>