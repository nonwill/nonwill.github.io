<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>UIApplicationDelegate launchOptions</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="UIApplicationDelegate launchOptions,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="UIApplicationDelegate launchOptions,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"🌜"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>UIApplicationDelegate launchOptions</span><span class=btRight><span title="Author · 作者" class=author>Mattt</span> <span title="Translator · 翻译" class=author>Croath Liu</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post · 关联或转载引用的文章" target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics · 回主题页">&#127793;</a></span></h1><p>AppDelegate 是 iOS 各种功能的集散中心。</p><p>应用生命周期管理？URL 路由？通知？Core Data 咒语？各种三方 SDK 的初始化？一些似乎放在哪里都不合适的零散功能？统统丢进 <code>AppDelegate.m</code> 里吧！</p><p>在 AppDelegate 所有这些拥挤的、超出负载的方法中，-application:didFinishLaunchingWithOptions: 是最臃肿的一个了。</p><p>对于很多开发者来说 <code>launchOptions</code> 参数就是类似于 Java 的 <code>main</code> 函数中 <code>String[] args</code> 的作用 —— 在构建应用时候一般是被忽略的。在其平淡的外表下，<code>launchOptions</code> 其实隐藏着 iOS 应用启动时携带的大量核心信息。</p><p>NSHipster 本周披露的知识点是关于我们平时关心最少的、但又是 UIKit 中最重要的东西：<code>launchOptions</code>。</p><hr><p>每个应用都使用 <code>UIApplicationDelegate -application:didFinishLaunchingWithOptions:</code>（更精确地说以后或许也包含 <code>-application:willFinishLaunchingWithOptions:</code>） 启动。应用调用这个方法来告诉 delegate 进程已经启动完毕，已经准备好运行了。</p><p>在 <a href=https://en.wikipedia.org/wiki/SpringBoard>Springboard</a> 中点击图标应用就开始启动了，但也有其他一些启动的方法。比如说注册了自定义 URL scheme 的应用可以以类似于 <code>twitter://</code> 的方式从一个 URL 启动。应用可以通过推送通知或地理位置变更启动。</p><p>查明应用为什么以及是如何启动的，就是 <code>launchOptions</code> 参数的职责所在。就像 <code>userInfo</code> 字典一样，在 <code>-application:didFinishLaunchingWithOptions:</code> 的 <code>launchOptions</code> 中也包含很多特别命名的键。</p><blockquote><p>这些键中的许多在应用启动时发出的 <code>UIApplicationDidFinishLaunchingNotification</code> 的通知中也可用，详细内容请查阅文档。</p></blockquote><p><code>launchOptions</code> 包含的键太多了，按照应用启动原因分组理解起来更容易一点：</p><h2 id=从-url-打开>从 URL 打开</h2><p>其他应用通过传递 URL 可以打开一个应用：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>[[UIApplication sharedApplication] openURL:[NSURL URLWithString:<span style=color:#e6db74>@&#34;app://...&#34;</span>]];
</span></span></code></pre></div><p>例如：<code>http://</code> 开头的 URL 会在 Safari 中打开，<code>mailto://</code> 开头的 URL 会在邮件中打开，<code>tel://</code> 开头的 URL 会在电话中打开。</p><p>这些情况下 <code>UIApplicationLaunchOptionsURLKey</code> 键就会很常用了。</p><blockquote><ul><li><code>UIApplicationLaunchOptionsURLKey</code>: 标示应用是通过 URL 打开的。其对应的值代表应用被打开时使用的 <code>NSURL</code> 对象。</li></ul></blockquote><p>应用也可以通过 URL 和附加系统信息打开。当应用从 AirDrop 的 <code>UIDocumentInteractionController</code> 中打开时，<code>launchOptions</code> 会包含下列这键：</p><blockquote><ul><li><code>UIApplicationLaunchOptionsSourceApplicationKey</code>：请求打开应用的应用 id。对应的值是请求打开应用的 bundle ID 的 <code>NSString</code> 对象</li><li><code>UIApplicationLaunchOptionsAnnotationKey</code>：标示通过 URL 打开应用时携带了自定义数据。对应的值是包含自定义数据的属性列表对象</li></ul></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSURL <span style=color:#f92672>*</span>fileURL <span style=color:#f92672>=</span> [[NSBundle mainBundle] URLForResource:<span style=color:#e6db74>@&#34;Document&#34;</span> withExtension:<span style=color:#e6db74>@&#34;pdf&#34;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (fileURL) {
</span></span><span style=display:flex><span>    UIDocumentInteractionController <span style=color:#f92672>*</span>documentInteractionController <span style=color:#f92672>=</span> [UIDocumentInteractionController interactionControllerWithURL:fileURL];
</span></span><span style=display:flex><span>    documentInteractionController.annotation <span style=color:#f92672>=</span> <span style=color:#ae81ff>@{</span><span style=color:#e6db74>@&#34;foo&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>@&#34;bar&#34;</span><span style=color:#ae81ff>}</span>;
</span></span><span style=display:flex><span>    [documentInteractionController setDelegate:self];
</span></span><span style=display:flex><span>    [documentInteractionController presentPreviewAnimated:YES];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=响应通知>响应通知</h2><p>不要和 <a href=https://nshipster.com/nsnotification-and-nsnotificationcenter/><code>NSNotification</code></a> 混淆了，应用可以通过本地（local）或远程（remote）通知打开。</p><h3 id=推送通知>推送通知</h3><p>自 iOS 3 开始引入的 remote（或者叫 push）notification 是在移动平台上的重要特性。</p><p>在 <code>application:didFinishLaunchingWithOptions:</code> 中调用 <code>registerForRemoteNotificationTypes:</code> 来注册推送通知。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>[application registerForRemoteNotificationTypes:
</span></span><span style=display:flex><span>	UIRemoteNotificationTypeBadge <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>    UIRemoteNotificationTypeSound <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>	UIRemoteNotificationTypeAlert];
</span></span></code></pre></div><p>如果调用成功则会回调 <code>-application:didRegisterForRemoteNotificationsWithDeviceToken:</code>，之后该设备就能随时收到推送通知了。</p><p>如果应用在打开时收到了推送通知，delegate 会调用 <code>application:didReceiveRemoteNotification:</code>。但是如果是通过在通知中心中滑动通知打开的应用，则会调用 <code>application:didFinishLaunchingWithOptions:</code> 并携带 <code>UIApplicationLaunchOptionsRemoteNotificationKey</code> 启动参数：</p><blockquote><ul><li><code>UIApplicationLaunchOptionsRemoteNotificationKey</code>：标示推送通知目前处于可用状态。对应的值是包含通知内容的 <code>NSDictionary</code>。</li></ul><blockquote><ul><li><code>alert</code>：一个字符串或包含两个键 <code>body</code> 和 <code>show-view</code> 的字典。</li><li><code>badge</code>：标示从通知发出者那应该获取数据的数量。这个数字会显示在应用图标上。没有 badge 信息则表示应该从图片上移除数字显示。</li><li><code>sound</code>：通知接收时播放音频的文件名。如果值为 &ldquo;default&rdquo; 那么则播放默认音频。</li></ul></blockquote></blockquote><p>因为通知可以通过两种方式控制，通常的做法是在 <code>application:didFinishLaunchingWithOptions:</code> 中手动调用 <code>application:didReceiveRemoteNotification:</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>- (<span style=color:#66d9ef>BOOL</span>)<span style=color:#a6e22e>application:</span>(UIApplication <span style=color:#f92672>*</span>)application
</span></span><span style=display:flex><span><span style=color:#a6e22e>didFinishLaunchingWithOptions:</span>(NSDictionary <span style=color:#f92672>*</span>)launchOptions
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (launchOptions[UIApplicationLaunchOptionsRemoteNotificationKey]) {
</span></span><span style=display:flex><span>        [self application:application didReceiveRemoteNotification:launchOptions[UIApplicationLaunchOptionsRemoteNotificationKey]];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=本地通知>本地通知</h3><p><a href=https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/IPhoneOSClientImp.html#//apple_ref/doc/uid/TP40008194-CH103-SW1>本地通知</a> 是在 iOS 4 中加入的功能，这个功能至今都被误解了。</p><p>应用可以制定计划在未来某个时间点触发 <code>UILocalNotification</code>。如果应用处于打开状态，那么将回调 <code>-application:didReceiveLocalNotification:</code> 方法。如果应用处于非活跃状态，通知将会被发送到通知中心。</p><p>不像推送通知，<code>UIApplication</code> 的 delegate 提供了统一控制本地通知的方法。如果应用是通过本地通知启动的，<code>-application:didReceiveLocalNotification:</code> 将会在 <code>-application:didFinishLaunchingWithOptions:</code> 之后被自动调用（意思就是不需要像推送通知一样在 <code>-application:didFinishLaunchingWithOptions:</code> 中手动调用了）。</p><p>本地通知会在启动参数中携带和推送通知有类似结构的 <code>UIApplicationLaunchOptionsLocalNotificationKey</code>：</p><ul><li><code>UIApplicationLaunchOptionsLocalNotificationKey</code>: 标示本地通知目前处于可用状态。对应的值是包含通知内容的 <code>NSDictionary</code>。</li></ul><p>如果应用在运行中收到本地通知需要显示提示框、其他情况不显示提示框，可以手动从 <code>UILocalNotification</code> 获取相关信息进行操作：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#75715e>// .h
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>@import AVFoundation;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@interface</span> <span style=color:#a6e22e>AppDelegate</span> ()
</span></span><span style=display:flex><span><span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>readwrite</span>, <span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>assign</span>) SystemSoundID localNotificationSound;
</span></span><span style=display:flex><span><span style=color:#66d9ef>@end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// .m
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>-</span> (<span style=color:#66d9ef>void</span>)application:(UIApplication <span style=color:#f92672>*</span>)application
</span></span><span style=display:flex><span>didReceiveLocalNotification:(UILocalNotification <span style=color:#f92672>*</span>)notification
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (application.applicationState <span style=color:#f92672>==</span> UIApplicationStateActive) {
</span></span><span style=display:flex><span>        UIAlertView <span style=color:#f92672>*</span>alertView <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            [[UIAlertView alloc] initWithTitle:notification.alertAction
</span></span><span style=display:flex><span>                                       message:notification.alertBody
</span></span><span style=display:flex><span>                                      delegate:nil
</span></span><span style=display:flex><span>                             cancelButtonTitle:NSLocalizedString(<span style=color:#e6db74>@&#34;OK&#34;</span>, nil)
</span></span><span style=display:flex><span>                             otherButtonTitles:nil];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>self.localNotificationSound) {
</span></span><span style=display:flex><span>            NSURL <span style=color:#f92672>*</span>soundURL <span style=color:#f92672>=</span> [[NSBundle mainBundle] URLForResource:<span style=color:#e6db74>@&#34;Sosumi&#34;</span>
</span></span><span style=display:flex><span>                                                      withExtension:<span style=color:#e6db74>@&#34;wav&#34;</span>];
</span></span><span style=display:flex><span>            AudioServicesCreateSystemSoundID((<span style=color:#66d9ef>__bridge</span> CFURLRef)soundURL, <span style=color:#f92672>&amp;</span>_localNotificationSound);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        AudioServicesPlaySystemSound(self.localNotificationSound);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        [alertView show];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>-</span> (<span style=color:#66d9ef>void</span>)applicationWillTerminate:(UIApplication <span style=color:#f92672>*</span>)application {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (self.localNotificationSound) {
</span></span><span style=display:flex><span>        AudioServicesDisposeSystemSoundID(self.localNotificationSound);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=地理位置事件>地理位置事件</h2><p>听说你在开发一个 LBS 签到照片的应用？哈哈，看起来你的动作好像落后时代四年多了。</p><p>但不要害怕！有了 iOS 的位置监控，你的应用可以通过地理位置触发的事件启动了：</p><blockquote><ul><li><code>UIApplicationLaunchOptionsLocationKey</code>：标示应用是响应地理位置事件启动的。对应的值是包含 Boolean 值的 <code>NSNumber</code> 对象。可以把这个键作为信号来创建 <code>CLLocationManager</code> 对象并开始进行定位。位置数据会传给 location manager 的 delegate（并不需要这个键）。</li></ul></blockquote><p>以下是检测位置变化来判断启动行为的例子：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#75715e>// .h
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>@import CoreLocation;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@interface</span> <span style=color:#a6e22e>AppDelegate</span> () <span style=color:#f92672>&lt;</span>CLLocationManagerDelegate<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>readwrite</span>, <span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>strong</span>) CLLocationManager <span style=color:#f92672>*</span>locationManager;
</span></span><span style=display:flex><span><span style=color:#66d9ef>@end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// .m
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>-</span> (<span style=color:#66d9ef>BOOL</span>)application:(UIApplication <span style=color:#f92672>*</span>)application
</span></span><span style=display:flex><span>didFinishLaunchingWithOptions:(NSDictionary <span style=color:#f92672>*</span>)launchOptions
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>[CLLocationManager locationServicesEnabled]) {
</span></span><span style=display:flex><span>        [[[UIAlertView alloc] initWithTitle:NSLocalizedString(<span style=color:#e6db74>@&#34;Location Services Disabled&#34;</span>, nil)
</span></span><span style=display:flex><span>                                    message:NSLocalizedString(<span style=color:#e6db74>@&#34;You currently have all location services for this device disabled. If you proceed, you will be asked to confirm whether location services should be reenabled.&#34;</span>, nil)
</span></span><span style=display:flex><span>                                   delegate:nil
</span></span><span style=display:flex><span>                          cancelButtonTitle:NSLocalizedString(<span style=color:#e6db74>@&#34;OK&#34;</span>, nil)
</span></span><span style=display:flex><span>                          otherButtonTitles:nil] show];
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        self.locationManager <span style=color:#f92672>=</span> [[CLLocationManager alloc] init];
</span></span><span style=display:flex><span>        self.locationManager.delegate <span style=color:#f92672>=</span> self;
</span></span><span style=display:flex><span>        [self.locationManager startMonitoringSignificantLocationChanges];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (launchOptions[UIApplicationLaunchOptionsLocationKey]) {
</span></span><span style=display:flex><span>        [self.locationManager startUpdatingLocation];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=报刊杂志newsstand>报刊杂志（Newsstand）</h2><p><em>所有的报刊杂志开发者都会为此欢呼的！</em></p><p><em><code>欢呼声.aiff</code></em></p><p>够了&mldr;</p><p>有新的可用下载时，报刊杂志应用可以启动。</p><p>这样注册即可：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>[application registerForRemoteNotificationTypes:
</span></span><span style=display:flex><span>	UIRemoteNotificationTypeNewsstandContentAvailability];
</span></span></code></pre></div><p>然后在启动参数中找到这个键：</p><blockquote><ul><li><code>UIApplicationLaunchOptionsNewsstandDownloadsKey</code>：标示应用有新的可用杂志资源下载。对应的值是包含 <code>NKAssetDownload</code> id 的字符串数组。虽然你可以通过这些 id 进行检查，但还是应该通过 <code>NKLibrary</code> 对象的 downloadingAssets 属性来持有这些 <code>NKAssetDownload</code> 对象（可用用于展示下载进度或错误）以便显示在报刊杂志书架中。</li></ul></blockquote><p>详细情况不再赘述。</p><h2 id=蓝牙>蓝牙</h2><p>iOS 7 开始支持外围蓝牙设备重新唤醒应用。</p><p>应用启动后通过特定的 id 实例化一个 <code>CBCentralManager</code> 或 <code>CBPeripheralManager</code> 用于连接蓝牙设备，之后应用就可以通过蓝牙系统的相关动作来被重新唤醒了。取决于发出通知的是一个中心设备还是外围设备，<code>launchOptions</code> 会传入以下两个键中的一个：</p><blockquote><ul><li><code>UIApplicationLaunchOptionsBluetoothCentralsKey</code>：标示应用之前曾有过一个或多个 <code>CBCentralManager</code> 对象并被蓝牙系统的相关动作唤醒过。对应的值是包含 <code>NSString</code> 对象的数组。数组中每一个字符串表示一个中心设备的恢复连接 id。</li><li><code>UIApplicationLaunchOptionsBluetoothPeripheralsKey</code>：标示应用之前曾有过一个或多个 <code>CBPeripheralManager</code> 对象并被蓝牙系统的相关动作唤醒过。对应的值是包含 <code>NSString</code> 对象的数组。数组中每一个字符串表示一个外围设备的恢复连接 id。</li></ul></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#75715e>// .h
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>@import CoreBluetooth;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@interface</span> <span style=color:#a6e22e>AppDelegate</span> () <span style=color:#f92672>&lt;</span>CBCentralManagerDelegate<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>readwrite</span>, <span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>strong</span>) CBCentralManager <span style=color:#f92672>*</span>centralManager;
</span></span><span style=display:flex><span><span style=color:#66d9ef>@end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// .m
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>self.centralManager <span style=color:#f92672>=</span> [[CBCentralManager alloc] initWithDelegate:self queue:nil options:<span style=color:#ae81ff>@{</span>CBCentralManagerOptionRestoreIdentifierKey:(launchOptions[UIApplicationLaunchOptionsBluetoothCentralsKey] <span style=color:#f92672>?:</span> [[NSUUID UUID] UUIDString])<span style=color:#ae81ff>}</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (self.centralManager.state <span style=color:#f92672>==</span> CBCentralManagerStatePoweredOn) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> NSString <span style=color:#f92672>*</span> <span style=color:#66d9ef>const</span> UID <span style=color:#f92672>=</span> <span style=color:#e6db74>@&#34;7C13BAA0-A5D4-4624-9397-15BF67161B1C&#34;</span>; <span style=color:#75715e>// generated with `$ uuidgen`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NSArray <span style=color:#f92672>*</span>services <span style=color:#f92672>=</span> <span style=color:#ae81ff>@[</span>[CBUUID UUIDWithString:UID]<span style=color:#ae81ff>]</span>;
</span></span><span style=display:flex><span>    NSDictionary <span style=color:#f92672>*</span>scanOptions <span style=color:#f92672>=</span> <span style=color:#ae81ff>@{</span>CBCentralManagerScanOptionAllowDuplicatesKey:<span style=color:#ae81ff>@YES</span><span style=color:#ae81ff>}</span>;
</span></span><span style=display:flex><span>    [self.centralManager scanForPeripheralsWithServices:services options:scanOptions];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><p>要搞清楚所有的启动参数确实要费点力气。幸运的是一般的应用只需要处理其中的一两种就够了。</p><p>了解所有的可能性需要从理解概念走到亲自实现的步骤上。当你了解到事情有这么多可能性的时候，下一个改变世界的想法可能就已经在脑中开始酝酿了。</p><hr><p>除非<a href=https://nshipster.cn/ target=_blank>另有声明</a>，本文采用知识共享「<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>署名-非商业性使用 3.0 中国大陆</a>」许可协议授权。</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top · 回顶部" rel=nofollow>&#127772;2013-12-16 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2025 Mattt 版权所有</a><a href=https://autoptr.top/ title="Back to Home · 回首页">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>标签:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>分类:</span><li><a class=link href=https://autoptr.top/categories/Cocoa target=_blank>Cocoa</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>