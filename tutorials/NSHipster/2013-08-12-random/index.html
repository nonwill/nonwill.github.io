<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>rand(3) / random(3) / arc4random(3) / et al.</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="rand(3) / random(3) / arc4random(3) / et al.,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="rand(3) / random(3) / arc4random(3) / et al.,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"ğŸŒœ"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>rand(3) / random(3) / arc4random(3) / et al.</span><span class=btRight><span title="Author Â· ä½œè€…" class=author>Mattt</span> <span title="Translator Â· ç¿»è¯‘" class=author>April Peng</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post Â· å…³è”æˆ–è½¬è½½å¼•ç”¨çš„æ–‡ç« " target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics Â· å›ä¸»é¢˜é¡µ">&#127793;</a></span></h1><p>æ‰€è°“çš„éšæœºæ€§åªæ˜¯æ½œåœ¨çš„å› æœå…³ç³»ã€‚</p><p>åœ¨é€šè¿‡æ•°å­¦å…¬å¼è¡¨ç¤ºç‰©è´¨ç›¸äº’ä½œç”¨çš„æœºæ¢°å®‡å®™é‡Œï¼Œç›®å‰è¿˜ä¸æ¸…æ¥šæ˜¯å¦è‡ªç„¶ä¹Ÿä¼šéšæœºçš„ç»™å…ƒç´ ç¼–ç ï¼Œæˆ–è€…æˆ–è®¸å®ƒæ˜¯äººç±»ç‹¬æœ‰çš„æ–¹å¼æ¥è°ƒå’Œä¸ç¡®å®šæ€§ã€‚</p><p>ç„¶è€Œæˆ‘ä»¬å¯ä»¥è‚¯å®šä¸€ä»¶äº‹ï¼šåœ¨ CPU å‘¨æœŸï¼Œè¿›ç¨‹å’Œçº¿ç¨‹è¿™æ ·å°é—­çš„æ•°å­—å®‡å®™ä¸­ï¼Œæ²¡æœ‰çœŸæ­£çš„éšæœºæ€§ï¼Œåªæœ‰ <em>ä¼ªéšæœºæ€§ï¼ˆpseudorandomnessï¼‰</em>ã€‚</p><p>ä¼ªéšæœºæ€§ï¼Œé€šå¸¸ä»¥éå¸¸ç±»ä¼¼äº<a href=https://en.wikipedia.org/wiki/Cryptographic_hash_function>åŠ å¯†æ•£åˆ—</a>çš„æ–¹å¼è¢«å®ç°ï¼ŒåŸºäºå½“å‰æ—¶é—´è¿”å›å€¼ä½œä¸ºç¡®å®šæ€§å‡½æ•°ï¼ˆå½“ç„¶é€šè¿‡ä¸€äº›åˆå§‹ç§å­å€¼ç»è¿‡åŠ å¯†ï¼‰ã€‚å°±åƒå“ˆå¸Œå‡½æ•°ï¼Œä¹Ÿæœ‰è®¸å¤š <acronym>PRNG</acronym>ï¼Œæˆ–è€…ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªä¸ºäº†ç‰¹å®šçš„æ€§èƒ½ç‰¹æ€§è¢«ä¼˜åŒ–ï¼šå‡åŒ€æ€§ï¼Œå‘¨æœŸæ€§ï¼Œä»¥åŠè®¡ç®—å¤æ‚åº¦ã€‚</p><p>å½“ç„¶ï¼Œå¯¹äºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ï¼Œè¿™ä¸€åˆ‡åªæ˜¯ä¸€ä¸ªå­¦æœ¯æ´»åŠ¨ã€‚è¿™ä¸æ˜¯ä¸€ç¯‡ä¸ºäº†å®£è®²éšæœºæ€§çš„å“²å­¦æ€§è´¨çš„æ›´é«˜å°šçš„ï¼Œå•°å—¦çš„è®ºæ–‡ï¼Œæˆ‘ä»¬ç”¨ FAQ çš„é£æ ¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æˆ‘ä»¬æœ¬å‘¨çš„ç›®æ ‡ï¼šæ¸…ç†æ‰€æœ‰é•¿æœŸä»¥æ¥åœ¨ Objective-C ä¸­ä¸éšæœºæœ‰å…³çš„é—®é¢˜å’Œè¯¯è§£ã€‚å¥½äº†ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å§ï¼</p><hr><h2 id=å¦‚ä½•ç”Ÿæˆä¸€ä¸ª-objective-c-çš„éšæœºæ•°>å¦‚ä½•ç”Ÿæˆä¸€ä¸ª Objective-C çš„éšæœºæ•°ï¼Ÿ</h2><p><em>tl;dr</em>: <strong>ä½¿ç”¨ <code>arc4random()</code> åŠå…¶ç›¸å…³åŠŸèƒ½</strong>ã€‚</p><p>å…·ä½“è€Œè¨€ï¼Œäº§ç”Ÿä¸€ä¸ª <code>0</code> å’Œ <code>N - 1</code> ä¹‹é—´çš„éšæœºæ•°ï¼Œä½¿ç”¨ <code>arc4random_uniform()</code>ï¼Œä»è€Œé¿å…<a href=http://eternallyconfuzzled.com/arts/jsw_art_rand.aspx>æ¨¡åå·®(modulo bias)</a>ã€‚</p><h3 id=0-åˆ°-n---1-ä¹‹é—´çš„éšæœºæ•´æ•°><code>0</code> åˆ° <code>N - 1</code> ä¹‹é—´çš„éšæœºæ•´æ•°</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSUInteger r <span style=color:#f92672>=</span> arc4random_uniform(N);
</span></span></code></pre></div><h3 id=1-åˆ°-n-ä¹‹é—´çš„éšæœºæ•´æ•°><code>1</code> åˆ° <code>N</code> ä¹‹é—´çš„éšæœºæ•´æ•°</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSUInteger r <span style=color:#f92672>=</span> arc4random_uniform(N) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span></code></pre></div><h3 id=0-åˆ°-1-ä¹‹é—´çš„éšæœºæµ®ç‚¹æ•°double><code>0</code> åˆ° <code>1</code> ä¹‹é—´çš„éšæœºæµ®ç‚¹æ•°ï¼ˆdoubleï¼‰</h3><p>å¦‚æœä½ è¦ç”Ÿæˆä¸€ä¸ªéšæœº <code>double</code> æˆ– <code>float</code>ï¼Œå¦ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©æ˜¯åŠŸèƒ½è¾ƒæ¨¡ç³Šçš„ <code>rand48</code> å®¶æ—ï¼ŒåŒ…æ‹¬ <code>drand48(3)</code>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>srand48(time(<span style=color:#ae81ff>0</span>));
</span></span><span style=display:flex><span><span style=color:#66d9ef>double</span> r <span style=color:#f92672>=</span> drand48();
</span></span></code></pre></div><blockquote><p>ä¸åƒ <code>arc4random</code> å‡½æ•°ï¼Œ <code>rand48</code> å‡½æ•°åœ¨äº§ç”Ÿéšæœºæ•°ä¹‹å‰éœ€è¦ç§å­çš„åˆå§‹å€¼ã€‚è¿™ä¸ªç§å­å‡½æ•° <code>srand48(3)</code> åº”è¯¥åªè¿è¡Œä¸€æ¬¡ã€‚</p></blockquote><h2 id=æˆ‘å¦‚ä½•ä»ä¸€ä¸ª-nsarray-é€‰æ‹©ä¸€ä¸ªéšæœºå…ƒç´ >æˆ‘å¦‚ä½•ä»ä¸€ä¸ª <code>NSArray</code> é€‰æ‹©ä¸€ä¸ªéšæœºå…ƒç´ ï¼Ÿ</h2><p>ä½¿ç”¨ <code>arc4random_uniform(3)</code> äº§ç”Ÿä¸€ä¸ªåœ¨éç©ºæ•°ç»„èŒƒå›´å†…çš„éšæœºæ•°ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#66d9ef>if</span> ([array count] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>id</span> obj <span style=color:#f92672>=</span> array[arc4random_uniform([array count])];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=æˆ‘å¦‚ä½•éšæœºæ’åºä¸€ä¸ª-nsarray>æˆ‘å¦‚ä½•éšæœºæ’åºä¸€ä¸ª <code>NSArray</code>ï¼Ÿ</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSMutableArray <span style=color:#f92672>*</span>mutableArray <span style=color:#f92672>=</span> [NSMutableArray arrayWithArray:array];
</span></span><span style=display:flex><span>NSUInteger count <span style=color:#f92672>=</span> [mutableArray count];
</span></span><span style=display:flex><span><span style=color:#75715e>// See https://en.wikipedia.org/wiki/Fisherâ€“Yates_shuffle
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (count <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (NSUInteger i <span style=color:#f92672>=</span> count <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; i <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>; <span style=color:#f92672>--</span>i) {
</span></span><span style=display:flex><span>      [mutableArray exchangeObjectAtIndex:i withObjectAtIndex:arc4random_uniform((int32_t)(i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>))];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSArray <span style=color:#f92672>*</span>randomArray <span style=color:#f92672>=</span> [NSArray arrayWithArray:mutableArray];
</span></span></code></pre></div><blockquote><p>æ­¤ä»£ç æ˜¯ä» <a href=https://github.com/mattt/TTTRandomizedEnumerator>TTTRandomizedEnumerator</a> å€Ÿè¿‡æ¥çš„ï¼Œå®ƒä¹Ÿä¸º <code>NSSet</code>ï¼Œ<code>NSOrderedSet</code>ï¼Œå’Œ <code>NSDictionary</code> æä¾›äº†éšæœºæšä¸¾ã€‚</p></blockquote><h2 id=æˆ‘å¦‚ä½•ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²>æˆ‘å¦‚ä½•ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Ÿ</h2><p>å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ç”Ÿæˆ â€œ<a href=https://en.wikipedia.org/wiki/Lorem_ipsum>lorem ipsum</a>â€ å¼çš„å¥å­ï¼Œå°è¯•ä» <a href=https://en.wikipedia.org/wiki/Text_corpus>corpus</a> æ„å»ºä¸€ä¸ª <a href=https://en.wikipedia.org/wiki/Markov_chain>Markov Chain</a>ã€‚</p><p>æˆ–è€…ï¼Œå¦‚æœä½ æ­£åœ¨å¯»æ‰¾åªæ˜¯å¾—åˆ°éšæœºå­—æ¯çš„æ–¹æ³•ï¼Œè¯·å°è¯•ä»¥ä¸‹æ–¹æ³•ä¹‹ä¸€ï¼š</p><h3 id=ç”Ÿæˆä¸€ä¸ªéšæœºçš„å°å†™-nsstring>ç”Ÿæˆä¸€ä¸ªéšæœºçš„å°å†™ <code>NSString</code></h3><p>å¦‚æœä½ æ˜¯å¯¹ä¸€ä¸ªå·²çŸ¥çš„ï¼Œè¿ç»­èŒƒå›´çš„ Unicode å­—ç¬¦åšå¤„ç†ï¼Œä¾‹å¦‚å°å†™å­—æ¯ (<code>U+0061</code> â€” <code>U+007A</code>)ï¼Œä½ å¯ä»¥ä» <code>char</code> åšä¸€ä¸ªç®€å•çš„æ¢ç®—ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSString <span style=color:#f92672>*</span>letter <span style=color:#f92672>=</span> [NSString stringWithFormat:<span style=color:#e6db74>@&#34;%c&#34;</span>, arc4random_uniform(<span style=color:#ae81ff>26</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;a&#39;</span>];
</span></span></code></pre></div><h3 id=ä»ä¸€ä¸ª-nsstring-é€‰æ‹©ä¸€ä¸ªéšæœºå­—ç¬¦>ä»ä¸€ä¸ª <code>NSString</code> é€‰æ‹©ä¸€ä¸ªéšæœºå­—ç¬¦</h3><p>å¦å¤–ï¼Œä»ä¸€ç»„ä½ é€‰æ‹©çš„å­—ç¬¦ä¸­æ¥æŒ‘é€‰éšæœºå­—æ¯çš„ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ç®€å•åœ°åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰å¯èƒ½çš„å­—æ¯çš„å­—ç¬¦ä¸²ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSString <span style=color:#f92672>*</span>vowels <span style=color:#f92672>=</span> <span style=color:#e6db74>@&#34;aeiouy&#34;</span>;
</span></span><span style=display:flex><span>NSString <span style=color:#f92672>*</span>letter <span style=color:#f92672>=</span> [vowels substringWithRange:NSMakeRange(arc4random_uniform([vowels length]), <span style=color:#ae81ff>1</span>)];
</span></span></code></pre></div><h2 id=ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-arc4random3è€Œä¸æ˜¯-rand3-æˆ–-random3>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ <code>arc4random(3)</code>ï¼Œè€Œä¸æ˜¯ <code>rand(3)</code> æˆ– <code>random(3)</code>ï¼Ÿ</h2><blockquote><p>C å‡½æ•°é€šå¸¸è¡¨ç¤ºä¸ºå¤šä¸ªå¸¦æ‹¬å·çš„ <code>3</code>ï¼Œè¯·éµä»ä»¥ä¸‹ç»„ç»‡å…¬çº¦ <a href=https://en.wikipedia.org/wiki/Man_page#Manual_sections><code>man</code> pages</a>ã€‚</p></blockquote><ul><li><code>arc4random</code> ä¸éœ€è¦åˆå§‹ç§å­ï¼ˆç”¨ <code>srand</code> æˆ– <code>srandom</code>ï¼‰ï¼Œä½¿å®ƒæ›´åŠ å®¹æ˜“ä½¿ç”¨ã€‚</li><li><code>arc4random</code> èŒƒå›´å¯è¾¾ <code>0x100000000 (4294967296)</code>ï¼Œè€Œ <code>rand</code> å’Œ <code>random</code> çš„ä¸Šé™åœ¨ <code>RAND_MAX = 0x7fffffff (2147483647)</code>ã€‚</li><li><code>rand</code> ç»å¸¸å®šæœŸè¢«å‘¨æœŸä½ä½çš„æ–¹å¼ï¼Œä½¿å…¶æ›´å¯é¢„æµ‹æ‰§è¡Œã€‚</li></ul><h2 id=ä»€ä¹ˆæ˜¯-rand3-random3-å’Œ-arc4random3ä»¥åŠå®ƒä»¬ä»å“ªé‡Œæ¥çš„>ä»€ä¹ˆæ˜¯ <code>rand(3)</code>, <code>random(3)</code>, å’Œ <code>arc4random(3)</code>ï¼Œä»¥åŠå®ƒä»¬ä»å“ªé‡Œæ¥çš„ï¼Ÿ</h2><ul><li><code>rand</code> æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ C å‡½æ•°ã€‚</li><li><code>random</code> æ˜¯<a href=http://pubs.opengroup.org/onlinepubs/009695399/functions/initstate.html>å®šä¹‰ä¸º POSIX æ ‡å‡†çš„ä¸€éƒ¨åˆ†</a>ã€‚</li><li><code>arc4random</code> æ˜¯åœ¨ BSD å’Œæ´¾ç”Ÿå¹³å°ã€‚</li></ul><hr><p>å¦‚æœä½ æœ‰å…³äº Objective-C éšæœºæ€§çš„å…¶ä»–ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶ tweet <a href=https://twitter.com/NSHipster>@NSHipster</a>ã€‚ä¸å¾€å¸¸ä¸€æ ·ï¼Œæ¬¢è¿ä»¥ <a href=https://github.com/NSHipster/articles/pulls>pull request</a> çš„å½¢å¼æäº¤æ›´æ­£ã€‚</p><hr><p>é™¤é<a href=https://nshipster.cn/ target=_blank>å¦æœ‰å£°æ˜</a>ï¼Œæœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ã€Œ<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 3.0 ä¸­å›½å¤§é™†</a>ã€è®¸å¯åè®®æˆæƒã€‚</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top Â· å›é¡¶éƒ¨" rel=nofollow>&#127772;2013-08-12 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2026 Mattt ç‰ˆæƒæ‰€æœ‰</a><a href=https://autoptr.top/ title="Back to Home Â· å›é¦–é¡µ">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>æ ‡ç­¾:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>åˆ†ç±»:</span><li><a class=link href=https://autoptr.top/categories/Objective-C target=_blank>Objective-C</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>