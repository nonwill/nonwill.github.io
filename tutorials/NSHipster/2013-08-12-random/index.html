<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>rand(3) / random(3) / arc4random(3) / et al.</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="rand(3) / random(3) / arc4random(3) / et al.,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="rand(3) / random(3) / arc4random(3) / et al.,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"🌜"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>rand(3) / random(3) / arc4random(3) / et al.</span><span class=btRight><span title="Author · 作者" class=author>Mattt</span> <span title="Translator · 翻译" class=author>April Peng</span> <a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post · 关联或转载引用的文章" target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics · 回主题页">&#127793;</a></span></h1><p>所谓的随机性只是潜在的因果关系。</p><p>在通过数学公式表示物质相互作用的机械宇宙里，目前还不清楚是否自然也会随机的给元素编码，或者或许它是人类独有的方式来调和不确定性。</p><p>然而我们可以肯定一件事：在 CPU 周期，进程和线程这样封闭的数字宇宙中，没有真正的随机性，只有 <em>伪随机性（pseudorandomness）</em>。</p><p>伪随机性，通常以非常类似于<a href=https://en.wikipedia.org/wiki/Cryptographic_hash_function>加密散列</a>的方式被实现，基于当前时间返回值作为确定性函数（当然通过一些初始种子值经过加密）。就像哈希函数，也有许多 <acronym>PRNG</acronym>，或者伪随机数生成器，其中每一个为了特定的性能特性被优化：均匀性，周期性，以及计算复杂度。</p><p>当然，对于应用程序开发人员，这一切只是一个学术活动。这不是一篇为了宣讲随机性的哲学性质的更高尚的，啰嗦的论文，我们用 FAQ 的风格来解决这个问题。</p><p>我们本周的目标：清理所有长期以来在 Objective-C 中与随机有关的问题和误解。好了，让我们来看看吧！</p><hr><h2 id=如何生成一个-objective-c-的随机数>如何生成一个 Objective-C 的随机数？</h2><p><em>tl;dr</em>: <strong>使用 <code>arc4random()</code> 及其相关功能</strong>。</p><p>具体而言，产生一个 <code>0</code> 和 <code>N - 1</code> 之间的随机数，使用 <code>arc4random_uniform()</code>，从而避免<a href=http://eternallyconfuzzled.com/arts/jsw_art_rand.aspx>模偏差(modulo bias)</a>。</p><h3 id=0-到-n---1-之间的随机整数><code>0</code> 到 <code>N - 1</code> 之间的随机整数</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSUInteger r <span style=color:#f92672>=</span> arc4random_uniform(N);
</span></span></code></pre></div><h3 id=1-到-n-之间的随机整数><code>1</code> 到 <code>N</code> 之间的随机整数</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSUInteger r <span style=color:#f92672>=</span> arc4random_uniform(N) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span></code></pre></div><h3 id=0-到-1-之间的随机浮点数double><code>0</code> 到 <code>1</code> 之间的随机浮点数（double）</h3><p>如果你要生成一个随机 <code>double</code> 或 <code>float</code>，另一个很好的选择是功能较模糊的 <code>rand48</code> 家族，包括 <code>drand48(3)</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>srand48(time(<span style=color:#ae81ff>0</span>));
</span></span><span style=display:flex><span><span style=color:#66d9ef>double</span> r <span style=color:#f92672>=</span> drand48();
</span></span></code></pre></div><blockquote><p>不像 <code>arc4random</code> 函数， <code>rand48</code> 函数在产生随机数之前需要种子的初始值。这个种子函数 <code>srand48(3)</code> 应该只运行一次。</p></blockquote><h2 id=我如何从一个-nsarray-选择一个随机元素>我如何从一个 <code>NSArray</code> 选择一个随机元素？</h2><p>使用 <code>arc4random_uniform(3)</code> 产生一个在非空数组范围内的随机数。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#66d9ef>if</span> ([array count] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>id</span> obj <span style=color:#f92672>=</span> array[arc4random_uniform([array count])];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=我如何随机排序一个-nsarray>我如何随机排序一个 <code>NSArray</code>？</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSMutableArray <span style=color:#f92672>*</span>mutableArray <span style=color:#f92672>=</span> [NSMutableArray arrayWithArray:array];
</span></span><span style=display:flex><span>NSUInteger count <span style=color:#f92672>=</span> [mutableArray count];
</span></span><span style=display:flex><span><span style=color:#75715e>// See https://en.wikipedia.org/wiki/Fisher–Yates_shuffle
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (count <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (NSUInteger i <span style=color:#f92672>=</span> count <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; i <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>; <span style=color:#f92672>--</span>i) {
</span></span><span style=display:flex><span>      [mutableArray exchangeObjectAtIndex:i withObjectAtIndex:arc4random_uniform((int32_t)(i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>))];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSArray <span style=color:#f92672>*</span>randomArray <span style=color:#f92672>=</span> [NSArray arrayWithArray:mutableArray];
</span></span></code></pre></div><blockquote><p>此代码是从 <a href=https://github.com/mattt/TTTRandomizedEnumerator>TTTRandomizedEnumerator</a> 借过来的，它也为 <code>NSSet</code>，<code>NSOrderedSet</code>，和 <code>NSDictionary</code> 提供了随机枚举。</p></blockquote><h2 id=我如何生成一个随机字符串>我如何生成一个随机字符串？</h2><p>如果你正在寻找生成 “<a href=https://en.wikipedia.org/wiki/Lorem_ipsum>lorem ipsum</a>” 式的句子，尝试从 <a href=https://en.wikipedia.org/wiki/Text_corpus>corpus</a> 构建一个 <a href=https://en.wikipedia.org/wiki/Markov_chain>Markov Chain</a>。</p><p>或者，如果你正在寻找只是得到随机字母的方法，请尝试以下方法之一：</p><h3 id=生成一个随机的小写-nsstring>生成一个随机的小写 <code>NSString</code></h3><p>如果你是对一个已知的，连续范围的 Unicode 字符做处理，例如小写字母 (<code>U+0061</code> — <code>U+007A</code>)，你可以从 <code>char</code> 做一个简单的换算：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSString <span style=color:#f92672>*</span>letter <span style=color:#f92672>=</span> [NSString stringWithFormat:<span style=color:#e6db74>@&#34;%c&#34;</span>, arc4random_uniform(<span style=color:#ae81ff>26</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;a&#39;</span>];
</span></span></code></pre></div><h3 id=从一个-nsstring-选择一个随机字符>从一个 <code>NSString</code> 选择一个随机字符</h3><p>另外，从一组你选择的字符中来挑选随机字母的一个简单的方法是简单地创建一个包含所有可能的字母的字符串：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSString <span style=color:#f92672>*</span>vowels <span style=color:#f92672>=</span> <span style=color:#e6db74>@&#34;aeiouy&#34;</span>;
</span></span><span style=display:flex><span>NSString <span style=color:#f92672>*</span>letter <span style=color:#f92672>=</span> [vowels substringWithRange:NSMakeRange(arc4random_uniform([vowels length]), <span style=color:#ae81ff>1</span>)];
</span></span></code></pre></div><h2 id=为什么要使用-arc4random3而不是-rand3-或-random3>为什么要使用 <code>arc4random(3)</code>，而不是 <code>rand(3)</code> 或 <code>random(3)</code>？</h2><blockquote><p>C 函数通常表示为多个带括号的 <code>3</code>，请遵从以下组织公约 <a href=https://en.wikipedia.org/wiki/Man_page#Manual_sections><code>man</code> pages</a>。</p></blockquote><ul><li><code>arc4random</code> 不需要初始种子（用 <code>srand</code> 或 <code>srandom</code>），使它更加容易使用。</li><li><code>arc4random</code> 范围可达 <code>0x100000000 (4294967296)</code>，而 <code>rand</code> 和 <code>random</code> 的上限在 <code>RAND_MAX = 0x7fffffff (2147483647)</code>。</li><li><code>rand</code> 经常定期被周期低位的方式，使其更可预测执行。</li></ul><h2 id=什么是-rand3-random3-和-arc4random3以及它们从哪里来的>什么是 <code>rand(3)</code>, <code>random(3)</code>, 和 <code>arc4random(3)</code>，以及它们从哪里来的？</h2><ul><li><code>rand</code> 是一个标准的 C 函数。</li><li><code>random</code> 是<a href=http://pubs.opengroup.org/onlinepubs/009695399/functions/initstate.html>定义为 POSIX 标准的一部分</a>。</li><li><code>arc4random</code> 是在 BSD 和派生平台。</li></ul><hr><p>如果你有关于 Objective-C 随机性的其他任何问题，请随时 tweet <a href=https://twitter.com/NSHipster>@NSHipster</a>。与往常一样，欢迎以 <a href=https://github.com/NSHipster/articles/pulls>pull request</a> 的形式提交更正。</p><hr><p>除非<a href=https://nshipster.cn/ target=_blank>另有声明</a>，本文采用知识共享「<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>署名-非商业性使用 3.0 中国大陆</a>」许可协议授权。</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top · 回顶部" rel=nofollow>&#127772;2013-08-12 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2025 Mattt 版权所有</a><a href=https://autoptr.top/ title="Back to Home · 回首页">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>标签:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>分类:</span><li><a class=link href=https://autoptr.top/categories/Objective-C target=_blank>Objective-C</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>