<!doctype html><html><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=.5"><title>NSValueTransformer</title>
<link rel="shortcut icon" type=image/x-icon href=/media/shortcuticon.png><meta name=keywords content="NSValueTransformer,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><meta name=description content="NSValueTransformer,macOS,C++,Cocoa,Objective-C,Swift,NSHipster"><script>if(document.domain=="autoptr.pages.dev"){var url=window.location.href,url=url.replace(/autoptr+\.pages+\.dev/g,"www.autoptr.top");window.location.href=url}</script><script src=/jscss/ajax/libs/anchor-js/4.2.0/anchor.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){anchors.options={visible:"hover",placement:"left",icon:"ğŸŒœ"},anchors.add()})</script><link rel=stylesheet href=/css/main.css><link href=/jscss/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css rel=stylesheet><script src=/jscss/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><style type=text/css>body{background-color:#fbf6ec}</style><script>top.location!=self.location&&(top.location=self.location)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?746e6e6d14d22526bf274c834750df53",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><script>window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,actualResizeHandler()},66))}actualResizeHandler();function actualResizeHandler(){/mobile/i.test(navigator.userAgent)||/android/i.test(navigator.userAgent)?document.body.classList.add("mobile"):document.body.classList.remove("mobile")}</script><a id=mysite-singlepage-top></a><div class=inner style=position:relative><div class=blog-post><h1 class=blog-title align=center><span class=btContent>NSValueTransformer</span><span class=btRight><span title="Author Â· ä½œè€…" class=author>Mattt</span> <span title="Translator Â· ç¿»è¯‘" class=author><a href=https://github.com/NSHipster/articles-zh-Hans style=color:#007cd5 title="Related or Quoted Post Â· å…³è”æˆ–è½¬è½½å¼•ç”¨çš„æ–‡ç« " target=_blank rel="nofollow noopener noreferrer">&#128681;</a><a href=/tutorials/NSHipster/ title="Back to Topics Â· å›ä¸»é¢˜é¡µ">&#127793;</a></span></h1><p>åœ¨ Foundation æ¡†æ¶çš„æ‰€æœ‰ç±»ä¸­ï¼ŒNSValueTransformer ä¹Ÿè®¸æ˜¯ä» OS X å¹³å°è¿ç§»åˆ° iOS å¹³å°è¡¨ç°æœ€å·®çš„é‚£ä¸ªã€‚</p><p>ä¸ºä»€ä¹ˆï¼Ÿå—¯ï¼Œæœ‰ä¸¤ä¸ªåŸå› ï¼š</p><p>ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯æœ€æ˜æ˜¾çš„ä¸€ä¸ªåŸå› æ˜¯ <code>NSValueTransformer</code> ä¸»è¦è¢«ç”¨äº AppKit æ¡†æ¶çš„ Cocoa binding ä¸­ã€‚å®ƒå¯ä»¥è‡ªåŠ¨åœ°æŠŠä¸€ä¸ªå±æ€§çš„å€¼è½¬æ¢ä¸ºå¦ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œè€Œä¸éœ€è¦ä¸­é—´çš„ç²˜åˆä»£ç ï¼Œæ¯”å¦‚åˆ¤æ–­ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œæˆ–è€…æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸º <code>nil</code>ã€‚è€Œ iOS å´æ²¡æœ‰ Cocoa binding ç‰¹æ€§ã€‚</p><p>ç¬¬äºŒä¸ªåŸå› å’Œ iOS æ²¡æœ‰å¤šå¤§å…³ç³»ï¼Œè€Œæ˜¯å’Œ Objective-C è¿è¡Œæ—¶æœ‰å…³ã€‚è‡ªä»æœ‰äº† blockï¼Œåœ¨å¯¹è±¡ä¹‹é—´ä¼ é€’è¡Œä¸ºå˜å¾—ç®€å•å¤šäº†â€”â€”æ¯”èµ·ç”¨ <code>NSValueTransformer</code> æˆ– <code>NSInvocation</code> ç®€å•å¤ªå¤šäº†ã€‚æ‰€ä»¥ï¼Œå³ä½¿ iOS æ˜å¤©å°±å¯ä»¥ä½¿ç”¨ Cocoa bindingï¼Œé‚£ä¹Ÿæ— æ³•ç¡®å®š <code>NSValueTransformer</code> ç°åœ¨è¿˜æ˜¯å¦ä¼šå‘æŒ¥é‚£æ ·è‡³å…³é‡è¦çš„ä½œç”¨ã€‚</p><p>ä½†æ˜¯ï¼Œä½ çŒœæ€ä¹ˆç€ï¼Ÿ<code>NSValueTransformer</code> å·²ç»æˆç†Ÿå¾ˆå¤šäº†ã€‚ç»è¿‡ä¸€äº›é›•ç¢å’Œä½¿ç”¨åœºæ™¯çš„æ”¹å˜ï¼Œä¹Ÿè®¸å®ƒèƒ½åœ¨ä½ çš„åº”ç”¨ä¸­å‘æŒ¥é‡å¤§ä½œç”¨ã€‚</p><hr><p><code>NSValueTransformer</code> æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒç”¨äºæŠŠä¸€ä¸ªå€¼è½¬æ¢ä¸ºå¦ä¸€ä¸ªå€¼ã€‚å®ƒæŒ‡å®šäº†å¯ä»¥å¤„ç†å“ªç±»è¾“å…¥ï¼Œå¹¶ä¸”åˆé€‚æ—¶ç”šè‡³æ”¯æŒåå‘çš„è½¬æ¢ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¸¸è§çš„å®ç°ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#66d9ef>@interface</span> <span style=color:#a6e22e>ClassNameTransformer</span>: <span style=color:#a6e22e>NSValueTransformer</span> {}
</span></span><span style=display:flex><span><span style=color:#66d9ef>@end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#pragma mark -
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@implementation</span> <span style=color:#a6e22e>ClassNameTransformer</span>
</span></span><span style=display:flex><span>+ (<span style=color:#66d9ef>Class</span>)<span style=color:#a6e22e>transformedValueClass</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> [NSString <span style=color:#66d9ef>class</span>];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>+ (<span style=color:#66d9ef>BOOL</span>)<span style=color:#a6e22e>allowsReverseTransformation</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> NO;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- (<span style=color:#66d9ef>id</span>)<span style=color:#a6e22e>transformedValue:</span>(<span style=color:#66d9ef>id</span>)value {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (value <span style=color:#f92672>==</span> nil) <span style=color:#f92672>?</span> nil <span style=color:#f92672>:</span> NSStringFromClass([value <span style=color:#66d9ef>class</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>@end</span>
</span></span></code></pre></div><p>æˆ‘ä»¬é€šå¸¸ä¸ä¼šç›´æ¥åˆå§‹åŒ– <code>NSValueTransformer</code>ã€‚è€Œæ˜¯ï¼Œä¸ <code>NSPersistentStore</code> å’Œ <code>NSURLProtocol</code> ç±»ä¼¼ï¼Œéœ€è¦æ³¨å†Œç›¸åº”çš„å®ç°ç±»ï¼Œç”±ç®¡ç†è€…è§’è‰²çš„å¯¹è±¡è´Ÿè´£åˆå§‹åŒ–å®ƒä»¬â€”â€”è¿™é‡Œæœ‰ç‚¹ä¸åŒçš„æ˜¯ï¼Œä½ éœ€è¦æŠŠ_å¯¹è±¡_æ³¨å†Œä¸ºä¸€ä¸ªå¸¦æœ‰æŒ‡å®šåå­—çš„å•ä¾‹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSString <span style=color:#f92672>*</span> <span style=color:#66d9ef>const</span> ClassNameTransformerName <span style=color:#f92672>=</span> <span style=color:#e6db74>@&#34;ClassNameTransformer&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Set the value transformer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>[NSValueTransformer setValueTransformer:[[ClassNameTransformer alloc] init] forName:ClassNameTransformerName];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Get the value transformer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>NSValueTransformer <span style=color:#f92672>*</span>valueTransformer <span style=color:#f92672>=</span> [NSValueTransformer valueTransformerForName:ClassNameTransformerName];
</span></span></code></pre></div><p>é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šåœ¨ <code>NSValueTransformer</code> å®ç°ç±»çš„ <code>+initialize</code> æ–¹æ³•ä¸­æ³¨å†Œå•ä¾‹å¯¹è±¡ï¼Œè¿™æ ·åœ¨éœ€è¦ç”¨å®ƒçš„æ—¶å€™å°±ä¸ç”¨å†åšåˆ«çš„ä»€ä¹ˆäº‹æƒ…äº†ã€‚</p><p>åˆ°è¿™é‡Œä½ å¯èƒ½å‘ç°äº† <code>NSValueTransformer</code> çš„ä¸€ä¸ªå¤§æ¯›ç—…ï¼šå®ƒå¤ªéš¾ç”¨äº†ï¼åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç°ä¸€å¤§æŠŠçš„æ–¹æ³•ï¼Œå£°æ˜ä¸€ä¸ªå¸¸é‡ï¼Œ_å¹¶ä¸”_è¿˜è¦åœ¨ <code>+initialize</code> æ–¹æ³•ä¸­æ³¨å†Œå®ƒï¼Ÿæˆ‘çœ‹è¿˜æ˜¯åˆ«ç”¨ç®—äº†ã€‚</p><p>åœ¨è¿™ä¸ªä½¿ç”¨ block çš„å¹´ä»£ï¼Œæˆ‘ä»¬æƒ³è¦â€”â€”ä¸å¯¹ï¼Œéœ€è¦â€”â€”ä¸€ç§ä¸€è¡Œï¼ˆå¨ï¼‰ä»£ç å°±èƒ½æå®šçš„å®ç°æ–¹å¼ã€‚</p><p><a href=https://github.com/mattt/TransformerKit/blob/master/TransformerKit/NSValueTransformer%2BTransformerKit.m#L36>ä¸€ç‚¹å„¿å…ƒç¼–ç¨‹</a>å°±å¯ä»¥è½»æ¾æå®šè¿™ä»¶äº‹æƒ…ã€‚æ³¨æ„å•¦ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>NSString <span style=color:#f92672>*</span> <span style=color:#66d9ef>const</span> TKCapitalizedStringTransformerName <span style=color:#f92672>=</span> <span style=color:#e6db74>@&#34;TKCapitalizedStringTransformerName&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[NSValueTransformer registerValueTransformerWithName:TKCapitalizedStringTransformerName
</span></span><span style=display:flex><span>           transformedValueClass:[NSString <span style=color:#66d9ef>class</span>]
</span></span><span style=display:flex><span>returningTransformedValueWithBlock:<span style=color:#f92672>^</span><span style=color:#66d9ef>id</span>(<span style=color:#66d9ef>id</span> value) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> [value capitalizedString];
</span></span><span style=display:flex><span>}];
</span></span></code></pre></div><p>æˆ‘å¹¶ä¸æ˜¯ä¸ºäº†è¿åˆè¯»è€…ä½ ï¼Œä½†æ˜¯åœ¨å†™æœ¬ç¯‡æ–‡ç« æ—¶ï¼Œæˆ‘ç‰¹åˆ«æƒ³çœ‹çœ‹æ€ä¹ˆèƒ½å¤Ÿæå‡ä½¿ç”¨ <code>NSValueTransformer</code> çš„ä½“éªŒã€‚æœ€ç»ˆçš„ç»“æœå°±æ˜¯ <a href=https://github.com/mattt/TransformerKit>TransformerKit</a>ã€‚</p><p>æ•´ä¸ªåº“çš„åŸºç¡€æ˜¯ä¸€ä¸ªä½¿ç”¨äº†ä¸€äº› Objective-C è¿è¡Œæ—¶æŠ€å·§çš„ <code>NSValueTransformer</code> categoryã€‚åŒæ—¶åŒ…å«äº†ä¸€äº›æ–¹ä¾¿çš„ä¾‹å­ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²å¤§å°å†™è½¬æ¢ï¼ˆä¾‹å¦‚ï¼Œ<code>CamelCase</code>ã€<code>llamaCase</code>ã€<code>snake_case</code> å’Œ <code>train-case</code>ï¼‰ã€‚</p><p>ç°åœ¨æœ‰äº†è¿™èº«æ¼‚äº®çš„è¡Œå¤´ï¼Œæˆ‘ä»¬è¦å¼€å§‹å¥½å¥½æƒ³æƒ³å®ƒå¯èƒ½ä¼šåœ¨å“ªé‡Œå‘æŒ¥ç”¨å¤„ï¼š</p><ul><li><code>NSValueTransformers</code> å¯ä»¥å¾ˆå¥½åœ°ç”¨äºè¡¨ç¤ºä¸€ä¸ªè½¬æ¢é“¾ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªåº”ç”¨å¯èƒ½éœ€è¦æŠŠç”¨æˆ·è¾“å…¥ç»è¿‡ä¸€ç³»åˆ—çš„è½¬æ¢ï¼ˆæ¯”å¦‚ï¼Œå»æ‰é¦–å°¾ç©ºæ ¼ï¼Œå»æ‰æ³¨éŸ³å­—ç¬¦ï¼Œç„¶åè®©é¦–å­—æ¯å¤§å†™ï¼‰åæ‰èƒ½æŠŠç»“æœå‘é€åˆ°ä¸»å¹²ç³»ç»Ÿä¸­ã€‚</li><li>ä¸ block ä¸åŒçš„æ˜¯ï¼Œ<code>NSValueTransformer</code> å°è£…äº†åå‘è½¬æ¢ã€‚æ¯”å¦‚è¯´ï¼Œä½ æƒ³è¦æŠŠ REST API ä¸­çš„é”®å€¼ä¸æ¨¡å‹å¯¹è±¡çš„å±æ€§ä¸€ä¸€å¯¹åº”ï¼›ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯ä»¥é€†å‘è½¬æ¢çš„ <code>NSValueTransformer</code> ç±»ï¼Œåˆå§‹åŒ–æ—¶æŠŠ <code>snake_case</code> è½¬æ¢ä¸º <code>llamaCase</code>ï¼Œå‘é€æ•°æ®åˆ°æœåŠ¡å™¨ç«¯æ—¶æŠŠ <code>llamaCase</code> è½¬æ¢ä¸º <code>snake_case</code>ã€‚</li><li>å¦å¤–ä¸€ä¸ªä¼˜äº block çš„åœ°æ–¹æ˜¯ï¼š<code>NSValueTransformer</code> å­ç±»å¯ä»¥æš´éœ²å‡ºæ–°çš„å±æ€§æ¥é…ç½®è½¬æ¢è¡Œä¸ºã€‚å¢åŠ æˆå‘˜å˜é‡è¿˜å¯ä»¥ç®€å•æ¸…æ¥šåœ°è®°å½•ç»“æœï¼Œæˆ–è€…ä¿å­˜ä¸€äº›è½¬æ¢è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°çš„ä¸œè¥¿ã€‚</li><li>ä¸è¦å¿˜äº†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨åœ¨ Core Data ä¸­ä½¿ç”¨ <code>NSValueTransformer</code>ï¼Œå¯ä»¥ç”¨å®ƒä»äºŒè¿›åˆ¶å­—æ®µä¸­ç¼–ç åŠè§£ç å‡ºç»„åˆæ•°æ®ã€‚è¿™äº›å¹´ä¼¼ä¹ä¸å†æµè¡Œè¿™ä¹ˆåšäº†ï¼Œä½†æ˜¯ï¼Œå¯¹äºé‚£äº›æ¨¡å‹åŒ–å¾—ä¸æ˜¯å¾ˆå¥½çš„ä¿¡æ¯ï¼ŒæŠŠç®€å•çš„æ•°æ®ç”¨è¿™ç§æ–¹å¼åºåˆ—åŒ–æ˜¯éå¸¸æœ‰æ•ˆçš„ã€‚ä½†æ˜¯ä¸è¦è¿™æ ·æŠŠå›¾ç‰‡å­˜åˆ°æ•°æ®åº“ä¸­â€”â€”é‚£å…«æˆä¸ä¼šæ˜¯ä¸ªå¥½ä¸»æ„ã€‚</li></ul><p>ä»¥åŠè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ç”¨å¤„ï¼Œå°±ä¸å†ä¸€ä¸€åˆ—ä¸¾äº†ã€‚</p><hr><p><code>NSValueTransformer</code> å¹¶æ²¡æœ‰ AppKit æ¡†æ¶çš„å°è®°ï¼Œå®ƒä¿ç•™äº† Foundation æ¡†æ¶ä¸è®¡ç®—åŸºæœ¬æ¦‚å¿µçš„çº¯æ´è”ç³»ï¼šæ¥å—è¾“å…¥ï¼Œè¿”å›è¾“å‡ºã€‚</p><p>å°½ç®¡å®ƒè¿˜ä¸æ˜¯å¾ˆæˆç†Ÿï¼Œä½†ä¸€ç‚¹æ–°é²œçš„æ”¹é€ å¯ä»¥è®© <code>NSValueTransformer</code> å›åˆ° NS-å¬‰çš®å£«ç•Œï¼ˆNSHipsterdomï¼‰çš„æœ€é«˜å®—æ—¨ï¼šé‚£äº›æˆ‘ä»¬å°šä¸çŸ¥é“æœ‰ç”¨çš„è§£å†³æ–¹æ¡ˆå…¶å®ä¸€ç›´åœ¨é‚£ç­‰å¾…ç€æˆ‘ä»¬å‘ç°ã€‚</p><hr><p>é™¤é<a href=https://nshipster.cn/ target=_blank>å¦æœ‰å£°æ˜</a>ï¼Œæœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ã€Œ<a href=https://creativecommons.org/licenses/by-nc/3.0/cn/ target=_blank>ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 3.0 ä¸­å›½å¤§é™†</a>ã€è®¸å¯åè®®æˆæƒã€‚</p><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8922574795542092 data-ad-slot=2802455178 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer><p style="margin:0 -3px"><span style="float:left;margin:0 -3px"><a href=#mysite-singlepage-top title="Back to Top Â· å›é¡¶éƒ¨" rel=nofollow>&#127772;2012-11-12 </a>&copy;</span>
<span style="float:right;margin:0 -3px"><a href=https://autoptr.top/license/ title="Copyright &copy; All rights reserved" target=_blank rel=nofollow>&copy; 2026 Mattt ç‰ˆæƒæ‰€æœ‰</a><a href=https://autoptr.top/ title="Back to Home Â· å›é¦–é¡µ">&#127771;</a></span></p><hr><hr><p style="margin:3px 5px"><ul class=tags><span>æ ‡ç­¾:</span><li><a class=link href=https://autoptr.top/tags/C++ target=_blank>C++</a></li><li><a class=link href=https://autoptr.top/tags/nshipster target=_blank>nshipster</a></li><span>&nbsp;&nbsp;</span>
<span>åˆ†ç±»:</span><li><a class=link href=https://autoptr.top/categories/Cocoa target=_blank>Cocoa</a></li><li><a class=link href=https://autoptr.top/categories/macOS target=_blank>macOS</a></li><li><a class=link href=https://autoptr.top/categories/CC++ target=_blank>CC++</a></li></ul><p style=margin-bottom:2em></p></p></footer></div><script src=/jscss/ajax/libs/jquery/3.3.1/jquery.slim.min.js></script><script src=/jscss/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-37ZP0S1L3D"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37ZP0S1L3D")</script><script src=/jscss/ajax/libs/medium-zoom/1.0.4/medium-zoom.min.js></script><script>const zoom=mediumZoom();zoom.attach("p img")</script></body></html>